import{c as q,l as pe,r as i,s as z,j as e,a as N,m as B,w as Se,D as he}from"./index-C_D-5Bfv.js";import{u as ie,T as se,g as v,h as b,k as y,l as L,R as ke,j as w,t as _e,ab as G,B as l,X as Ie,z as je,a0 as qe,ac as Ee,C as Z,ad as We,W as ze,P as Ve,$ as Oe,L as ge,S as Fe}from"./card-BIr-PJK2.js";import{L as o}from"./label-CqFCS6R-.js";import{S as _}from"./switch-B03PpzBD.js";import{S as ae}from"./slider-soslqLj5.js";import{I as V}from"./input-DSUZcGci.js";import{B as K}from"./index-BtotK06U.js";import{T as Ae,a as Te,b as O,c as F}from"./tabs-KnLULWOS.js";import{S as Be,a as Ge,b as He,c as $e,d as Ne,C as ee}from"./select-3Jn5ARjr.js";import{T as Je,a as Xe,b as ve,c as H,d as Ye,e as $}from"./table-CQA1OK80.js";import{A as re,b as te,a as Ke}from"./alert-O3FLJu-w.js";import{U as X}from"./users-7pFWpLN8.js";import{M as Pe,K as de}from"./mail-Cz09XyFe.js";import{C as Qe}from"./clock-Chbx4_2l.js";import{M as Ze,D as be}from"./permissions-Dq4AqOHE.js";import{A as oe}from"./activity-DZxii9vr.js";import{D as me}from"./database-CFHfwlHl.js";import{L as xe}from"./lock-Dz87eZuj.js";import{E as es}from"./eye-C6tgOrd-.js";import{C as J}from"./circle-check-DUwGofyK.js";import{u as ss}from"./useDeviceDetection-CShWnkOv.js";import{M as ye}from"./MobileLayout-CV04gzFk.js";import{C as as}from"./checkbox-BKYUVAI4.js";import{S as rs}from"./send-afmu6U6U.js";import"./index-APdQY6Km.js";import"./chevron-right-fj5H7AOZ.js";import"./sparkles-CBL8q4dG.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=q("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Re=q("MoonStar",[["path",{d:"M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9",key:"4ay0iu"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=q("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=q("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=q("Settings2",[["path",{d:"M20 7h-9",key:"3s1dr2"}],["path",{d:"M14 17H5",key:"gfn3mx"}],["circle",{cx:"17",cy:"17",r:"3",key:"18b49y"}],["circle",{cx:"7",cy:"7",r:"3",key:"dfmy0x"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=q("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=q("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=q("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=q("UserCog",[["circle",{cx:"18",cy:"15",r:"3",key:"gjjjvw"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M10 15H6a4 4 0 0 0-4 4v2",key:"1nfge6"}],["path",{d:"m21.7 16.4-.9-.3",key:"12j9ji"}],["path",{d:"m15.2 13.9-.9-.3",key:"1fdjdi"}],["path",{d:"m16.6 18.7.3-.9",key:"heedtr"}],["path",{d:"m19.1 12.2.3-.9",key:"1af3ki"}],["path",{d:"m19.6 18.7-.4-1",key:"1x9vze"}],["path",{d:"m16.8 12.3-.4-1",key:"vqeiwj"}],["path",{d:"m14.3 16.6 1-.4",key:"1qlj63"}],["path",{d:"m20.7 13.8 1-.4",key:"1v5t8k"}]]);function cs(){const{isAdmin:d}=ie(),{toast:C}=pe(),[S,k]=i.useState([]),[s,c]=i.useState(!0),[m,h]=i.useState(null),[u,T]=i.useState(""),[n,p]=i.useState(null),f=i.useCallback(async()=>{if(d){c(!0),p(null);try{const{data:r,error:g}=await z.from("user_roles").select("user_id, role, created_at");if(g)throw g;const{data:A,error:I}=await z.rpc("get_users_with_emails");I&&console.warn("Could not fetch user emails:",I);const M=(r||[]).map(t=>{const x=A==null?void 0:A.find(j=>j.id===t.user_id);return{id:t.user_id,email:(x==null?void 0:x.email)||`Usuario ${t.user_id.slice(0,8)}...`,role:t.role,created_at:(x==null?void 0:x.created_at)||t.created_at,last_sign_in_at:x==null?void 0:x.last_sign_in_at}});k(M)}catch(r){console.error("Error fetching users:",r),p("Error al cargar usuarios")}finally{c(!1)}}},[d]);i.useEffect(()=>{d&&f()},[d,f]);const R=async(r,g)=>{h(r);try{const{error:A}=await z.from("user_roles").update({role:g}).eq("user_id",r);if(A)throw A;k(I=>I.map(M=>M.id===r?{...M,role:g}:M)),C({title:"Rol actualizado",description:`El usuario ahora tiene el rol "${g==="admin"?"Administrador":"Usuario"}"`})}catch(A){console.error("Error updating role:",A),C({title:"Error",description:"No se pudo actualizar el rol",variant:"destructive"})}finally{h(null)}},D=S.filter(r=>r.email.toLowerCase().includes(u.toLowerCase())||r.id.toLowerCase().includes(u.toLowerCase())),E=r=>r?new Date(r).toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"}):"Nunca";return d?e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(X,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(y,{children:"Gesti√≥n de Usuarios"}),e.jsx(L,{children:"Administra los usuarios y sus roles en el sistema"})]})]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:f,disabled:s,children:[e.jsx(ke,{className:N("h-4 w-4 mr-2",s&&"animate-spin")}),"Actualizar"]})]})}),e.jsxs(w,{children:[n&&e.jsxs(re,{variant:"destructive",className:"mb-4",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(te,{children:n})]}),e.jsxs("div",{className:"relative mb-4",children:[e.jsx(_e,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(V,{placeholder:"Buscar por email o ID...",value:u,onChange:r=>T(r.target.value),className:"pl-9"})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-accent/50 border",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(X,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium",children:"Total Usuarios"})]}),e.jsx("p",{className:"text-2xl font-bold",children:S.length})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-primary/10 border border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(G,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"text-sm font-medium",children:"Administradores"})]}),e.jsx("p",{className:"text-2xl font-bold text-primary",children:S.filter(r=>r.role==="admin").length})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-blue-500/10 border border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Usuarios"})]}),e.jsx("p",{className:"text-2xl font-bold text-blue-600",children:S.filter(r=>r.role==="user").length})]})]}),s?e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx(B,{className:"h-8 w-8 animate-spin text-primary"})}):D.length===0?e.jsxs("div",{className:"text-center py-12 text-muted-foreground",children:[e.jsx(X,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),e.jsx("p",{children:u?"No se encontraron usuarios":"No hay usuarios registrados"})]}):e.jsx("div",{className:"rounded-lg border overflow-hidden overflow-x-auto",children:e.jsxs(Je,{children:[e.jsx(Xe,{children:e.jsxs(ve,{className:"bg-muted/50",children:[e.jsx(H,{children:"Usuario"}),e.jsx(H,{children:"Rol"}),e.jsx(H,{className:"hidden md:table-cell",children:"Registro"}),e.jsx(H,{className:"hidden lg:table-cell",children:"√öltimo acceso"}),e.jsx(H,{className:"text-right",children:"Cambiar Rol"})]})}),e.jsx(Ye,{children:D.map(r=>e.jsxs(ve,{children:[e.jsx($,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:N("p-1.5 rounded-full",r.role==="admin"?"bg-primary/10":"bg-blue-500/10"),children:e.jsx(Pe,{className:N("h-3.5 w-3.5",r.role==="admin"?"text-primary":"text-blue-600")})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm truncate max-w-[200px]",children:r.email}),e.jsxs("p",{className:"text-xs text-muted-foreground font-mono",children:[r.id.slice(0,8),"..."]})]})]})}),e.jsx($,{children:e.jsxs(l,{variant:r.role==="admin"?"default":"secondary",className:N(r.role==="admin"&&"bg-primary","gap-1"),children:[r.role==="admin"?e.jsx(G,{className:"h-3 w-3"}):e.jsx(Y,{className:"h-3 w-3"}),r.role==="admin"?"Administrador":"Usuario"]})}),e.jsx($,{className:"hidden md:table-cell",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground text-sm",children:[e.jsx(Ie,{className:"h-3.5 w-3.5"}),E(r.created_at)]})}),e.jsx($,{className:"hidden lg:table-cell",children:e.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground text-sm",children:[e.jsx(Qe,{className:"h-3.5 w-3.5"}),E(r.last_sign_in_at)]})}),e.jsx($,{className:"text-right",children:e.jsxs(Be,{value:r.role,onValueChange:g=>R(r.id,g),disabled:m===r.id,children:[e.jsx(Ge,{className:"w-[140px]",children:m===r.id?e.jsx(B,{className:"h-4 w-4 animate-spin"}):e.jsx(He,{})}),e.jsxs($e,{children:[e.jsx(Ne,{value:"admin",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(G,{className:"h-4 w-4 text-primary"}),"Administrador"]})}),e.jsx(Ne,{value:"user",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4"}),"Usuario"]})})]})]})})]},r.id))})]})}),e.jsx("div",{className:"mt-6 p-4 rounded-lg bg-amber-500/10 border border-amber-500/20",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(le,{className:"h-5 w-5 text-amber-600 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-sm text-amber-700 dark:text-amber-400",children:"Informaci√≥n de Seguridad"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Los roles se verifican del lado del servidor usando funciones de seguridad. Los administradores tienen acceso completo al sistema. Los usuarios tienen acceso limitado seg√∫n las pol√≠ticas configuradas."})]})]})})]})]}):e.jsxs(re,{variant:"destructive",children:[e.jsx(se,{className:"h-4 w-4"}),e.jsx(te,{children:"No tienes permisos para acceder a esta secci√≥n. Se requiere rol de administrador."})]})}function ds({children:d,requiredRole:C,fallback:S,showError:k=!0}){const{currentUserRole:s,loading:c,isAdmin:m}=ie();return c?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(B,{className:"h-6 w-6 animate-spin text-primary"})}):m?e.jsx(e.Fragment,{children:d}):s===C?e.jsx(e.Fragment,{children:d}):S?e.jsx(e.Fragment,{children:S}):k?e.jsxs(re,{variant:"destructive",className:"my-4",children:[e.jsx(ls,{className:"h-4 w-4"}),e.jsxs(te,{children:["No tienes permisos para acceder a esta secci√≥n. Se requiere rol de ",C==="admin"?"administrador":"usuario","."]})]}):null}function os(){const{currentUserRole:d,isAdmin:C,loading:S}=ie(),[k,s]=i.useState("usuarios"),[c,m]=i.useState(null),[h,u]=i.useState(!1),T=async()=>{u(!0);try{const[n,p,f,R]=await Promise.all([z.from("user_roles").select("role"),z.from("equipos").select("id",{count:"exact",head:!0}),z.from("mantenimientos_programados").select("id",{count:"exact",head:!0}),z.from("inventarios").select("id",{count:"exact",head:!0})]),D=n.data||[];m({totalUsers:D.length,adminUsers:D.filter(E=>E.role==="admin").length,regularUsers:D.filter(E=>E.role==="user").length,totalEquipos:p.count||0,totalMantenimientos:f.count||0,totalInventario:R.count||0})}catch(n){console.error("Error fetching stats:",n)}finally{u(!1)}};return i.useEffect(()=>{C&&T()},[C]),e.jsx(ds,{requiredRole:"admin",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"p-3 rounded-xl bg-gradient-to-br from-primary/20 to-primary/5 border border-primary/20",children:e.jsx(le,{className:"h-8 w-8 text-primary"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Panel de Administraci√≥n"}),e.jsx("p",{className:"text-muted-foreground",children:"Gestiona usuarios, permisos y configuraci√≥n del sistema"})]})]}),e.jsxs(l,{variant:"default",className:"gap-2 py-1.5 px-3 w-fit",children:[e.jsx(G,{className:"h-4 w-4"}),"Administrador"]})]}),c&&e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(v,{className:"border-l-4 border-l-primary",children:[e.jsxs(b,{className:"pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),"Total Usuarios"]}),e.jsx(y,{className:"text-3xl",children:c.totalUsers})]}),e.jsxs(w,{className:"text-xs text-muted-foreground",children:[c.adminUsers," admins, ",c.regularUsers," usuarios"]})]}),e.jsxs(v,{className:"border-l-4 border-l-emerald-500",children:[e.jsxs(b,{className:"pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Equipos"]}),e.jsx(y,{className:"text-3xl",children:c.totalEquipos})]}),e.jsx(w,{className:"text-xs text-muted-foreground",children:"Registrados en el sistema"})]}),e.jsxs(v,{className:"border-l-4 border-l-blue-500",children:[e.jsxs(b,{className:"pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),"Mantenimientos"]}),e.jsx(y,{className:"text-3xl",children:c.totalMantenimientos})]}),e.jsx(w,{className:"text-xs text-muted-foreground",children:"Programados activos"})]}),e.jsxs(v,{className:"border-l-4 border-l-amber-500",children:[e.jsxs(b,{className:"pb-2",children:[e.jsxs(L,{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"Inventario"]}),e.jsx(y,{className:"text-3xl",children:c.totalInventario})]}),e.jsx(w,{className:"text-xs text-muted-foreground",children:"Items en stock"})]})]}),e.jsxs(Ae,{value:k,onValueChange:s,className:"space-y-4",children:[e.jsxs(Te,{className:"grid w-full grid-cols-4 lg:w-auto lg:inline-grid",children:[e.jsxs(O,{value:"usuarios",className:"gap-2",children:[e.jsx(X,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Usuarios"})]}),e.jsxs(O,{value:"permisos",className:"gap-2",children:[e.jsx(de,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Permisos"})]}),e.jsxs(O,{value:"seguridad",className:"gap-2",children:[e.jsx(xe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Seguridad"})]}),e.jsxs(O,{value:"sistema",className:"gap-2",children:[e.jsx(oe,{className:"h-4 w-4"}),e.jsx("span",{className:"hidden sm:inline",children:"Sistema"})]})]}),e.jsx(F,{value:"usuarios",className:"space-y-4",children:e.jsx(cs,{})}),e.jsx(F,{value:"permisos",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-5 w-5 text-primary"}),"Matriz de Permisos por M√≥dulo"]}),e.jsx(L,{children:"Visualiza los permisos asignados a cada rol por m√≥dulo"})]}),e.jsxs(w,{children:[e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-2 font-semibold",children:"M√≥dulo"}),e.jsx("th",{className:"text-center p-2 font-semibold",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(G,{className:"h-4 w-4 text-primary"}),"Admin"]})}),e.jsx("th",{className:"text-center p-2 font-semibold",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-500"}),"Usuario"]})})]})}),e.jsx("tbody",{children:Ze.map(n=>{const p=be.admin[n.id]||[],f=be.user[n.id]||[];return e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsxs("td",{className:"p-2",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{className:"font-medium",children:n.name})}),e.jsx("span",{className:"text-xs text-muted-foreground",children:n.description})]}),e.jsx("td",{className:"p-2 text-center",children:e.jsxs("div",{className:"flex flex-wrap justify-center gap-1",children:[p.includes("read")&&e.jsx(l,{variant:"outline",className:"text-xs bg-emerald-500/10 text-emerald-600 border-emerald-500/30",children:"Ver"}),p.includes("write")&&e.jsx(l,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500/30",children:"Editar"}),p.includes("delete")&&e.jsx(l,{variant:"outline",className:"text-xs bg-red-500/10 text-red-600 border-red-500/30",children:"Eliminar"}),p.includes("admin")&&e.jsx(l,{variant:"outline",className:"text-xs bg-primary/10 text-primary border-primary/30",children:"Admin"})]})}),e.jsx("td",{className:"p-2 text-center",children:e.jsx("div",{className:"flex flex-wrap justify-center gap-1",children:f.length===0?e.jsx(l,{variant:"secondary",className:"text-xs",children:"Sin acceso"}):e.jsxs(e.Fragment,{children:[f.includes("read")&&e.jsx(l,{variant:"outline",className:"text-xs bg-emerald-500/10 text-emerald-600 border-emerald-500/30",children:"Ver"}),f.includes("write")&&e.jsx(l,{variant:"outline",className:"text-xs bg-blue-500/10 text-blue-600 border-blue-500/30",children:"Editar"}),f.includes("delete")&&e.jsx(l,{variant:"outline",className:"text-xs bg-red-500/10 text-red-600 border-red-500/30",children:"Eliminar"})]})})})]},n.id)})})]})}),e.jsxs(re,{className:"mt-4",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx(Ke,{children:"Nota sobre permisos"}),e.jsx(te,{children:'Los usuarios con rol "Usuario" solo pueden ver informaci√≥n. No pueden crear, editar ni eliminar registros. Solo los administradores tienen control total del sistema.'})]})]})]})}),e.jsx(F,{value:"seguridad",className:"space-y-4",children:e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-5 w-5 text-primary"}),"Configuraci√≥n de Seguridad"]}),e.jsx(L,{children:"Estado de las pol√≠ticas de seguridad y acceso al sistema"})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-semibold",children:"Estado de Seguridad"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Row Level Security (RLS)"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Activo"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Funci√≥n has_role()"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Configurada"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Autenticaci√≥n"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Email/Password"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Asignaci√≥n autom√°tica"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Trigger activo"})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Roles del Sistema"}),e.jsxs("div",{className:"grid gap-3 md:grid-cols-2",children:[e.jsxs("div",{className:"p-4 rounded-lg border bg-primary/5 border-primary/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(G,{className:"h-5 w-5 text-primary"}),e.jsx("span",{className:"font-semibold",children:"Administrador"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 ml-8",children:[e.jsx("li",{children:"‚Ä¢ Acceso completo al sistema"}),e.jsx("li",{children:"‚Ä¢ Gesti√≥n de usuarios y roles"}),e.jsx("li",{children:"‚Ä¢ Crear, editar y eliminar registros"}),e.jsx("li",{children:"‚Ä¢ Configuraci√≥n del sistema"}),e.jsx("li",{children:"‚Ä¢ Importaci√≥n/exportaci√≥n de datos"})]})]}),e.jsxs("div",{className:"p-4 rounded-lg border bg-blue-500/5 border-blue-500/20",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx(Y,{className:"h-5 w-5 text-blue-600"}),e.jsx("span",{className:"font-semibold",children:"Usuario"})]}),e.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1 ml-8",children:[e.jsx("li",{children:"‚Ä¢ Solo lectura en todos los m√≥dulos"}),e.jsx("li",{children:"‚Ä¢ Consultar equipos e inventario"}),e.jsx("li",{children:"‚Ä¢ Ver mantenimientos y planes"}),e.jsx("li",{children:"‚Ä¢ Usar asistente IA"}),e.jsx("li",{children:"‚Ä¢ Sin acceso a administraci√≥n"})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold mb-3",children:"Pol√≠ticas de Acceso (RLS)"}),e.jsx("div",{className:"p-4 rounded-lg bg-accent/50 border",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"h-5 w-5 text-muted-foreground mt-0.5"}),e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm",children:["El sistema utiliza ",e.jsx("strong",{children:"Row Level Security (RLS)"})," para proteger los datos a nivel de base de datos. Cada operaci√≥n es verificada en el servidor antes de ejecutarse."]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["La funci√≥n ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"has_role()"})," verifica roles de forma segura usando ",e.jsx("code",{className:"bg-muted px-1 rounded",children:"SECURITY DEFINER"}),"."]})]})]})})]})]})]})}),e.jsxs(F,{value:"sistema",className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(oe,{className:"h-5 w-5 text-primary"}),"Estado del Sistema"]}),e.jsxs(K,{variant:"outline",size:"sm",onClick:T,disabled:h,children:[e.jsx(ke,{className:N("h-4 w-4 mr-2",h&&"animate-spin")}),"Actualizar"]})]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Base de datos"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Conectada"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Autenticaci√≥n"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Activa"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Edge Functions"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Disponibles"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-emerald-500/10 border border-emerald-500/20",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"h-4 w-4 text-emerald-600"}),e.jsx("span",{className:"text-sm font-medium",children:"Sistema de Roles"})]}),e.jsx(l,{variant:"outline",className:"bg-emerald-500/20 text-emerald-600 border-emerald-500/30",children:"Configurado"})]})]})]}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(je,{className:"h-5 w-5 text-primary"}),"Canales de Notificaci√≥n"]})}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-accent/50 border",children:[e.jsx("span",{className:"text-sm font-medium",children:"Canal Email"}),e.jsx(l,{variant:"secondary",children:"Configurado"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-accent/50 border",children:[e.jsx("span",{className:"text-sm font-medium",children:"Canal SMS"}),e.jsx(l,{variant:"secondary",children:"Disponible"})]}),e.jsxs("div",{className:"flex items-center justify-between p-3 rounded-lg bg-accent/50 border",children:[e.jsx("span",{className:"text-sm font-medium",children:"Push Notifications"}),e.jsx(l,{variant:"secondary",children:"Activo"})]})]})]})]}),e.jsxs(v,{children:[e.jsx(b,{children:e.jsxs(y,{className:"flex items-center gap-2 text-lg",children:[e.jsx(qe,{className:"h-5 w-5 text-primary"}),"Informaci√≥n del Sistema"]})}),e.jsx(w,{children:e.jsxs("div",{className:"grid gap-4 md:grid-cols-3",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Versi√≥n"}),e.jsx("p",{className:"font-semibold",children:"1.0.0"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Entorno"}),e.jsx("p",{className:"font-semibold",children:"Producci√≥n"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-muted/50",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Backend"}),e.jsx("p",{className:"font-semibold",children:"Lovable Cloud"})]})]})})]})]})]})]})})}function ms(){return e.jsx(os,{})}const Ce=[{id:"mantenimiento",label:"Mantenimientos",icon:ze,description:"Alertas de servicios pr√≥ximos y vencidos"},{id:"stock",label:"Stock bajo",icon:Ve,description:"Alertas cuando el inventario est√° bajo"},{id:"sistema",label:"Sistema",icon:Oe,description:"Actualizaciones y avisos del sistema"}];function xs(){const{config:d,loading:C,saving:S,updateConfig:k}=Se(),[s,c]=i.useState(d),{permission:m,supported:h,requestPermission:u,addNotification:T}=Ee(),{toast:n}=pe(),[p,f]=i.useState(!0),[R,D]=i.useState(!0),[E,r]=i.useState(!1),[g,A]=i.useState(!1),[I,M]=i.useState(!1),[t,x]=i.useState(()=>{const a=localStorage.getItem("notification-types-enabled");return a?JSON.parse(a):["mantenimiento","stock","sistema"]});i.useEffect(()=>{c(d)},[d]),i.useEffect(()=>{localStorage.setItem("notification-types-enabled",JSON.stringify(t))},[t]);const j=a=>{const P={...s,...a};c(P),k(P)},fe=a=>{x(P=>P.includes(a)?P.filter(W=>W!==a):[...P,a])},De=async a=>{if(!a){j({notificarDispositivo:!1});return}if(!h){n({title:"No disponible",description:"Este navegador no soporta notificaciones push.",variant:"destructive"}),j({notificarDispositivo:!1});return}if(m==="denied"){n({title:"Permiso bloqueado",description:"Habilita las notificaciones en la configuraci√≥n del navegador.",variant:"destructive"}),j({notificarDispositivo:!1});return}if(m==="default"&&!await u()){j({notificarDispositivo:!1});return}j({notificarDispositivo:!0})},Me=async()=>{if(!h||m!=="granted"){n({title:"Activa las notificaciones primero",variant:"destructive"});return}M(!0),await new Promise(a=>setTimeout(a,500)),T({title:"üîî Notificaci√≥n de prueba",body:"Las notificaciones push est√°n funcionando.",type:"success"}),M(!1),n({title:"‚úÖ Notificaci√≥n enviada"})},Ue=()=>{k(he),c(he),x(["mantenimiento","stock","sistema"]),n({title:"Configuraci√≥n restaurada"})},ne=a=>!a||/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a),ce=a=>!a||/^\+?[\d\s-]{10,}$/.test(a),U=a=>a==="email"?s.notificarEmail?!s.correoNotificaciones||!ne(s.correoNotificaciones)?{status:"warning",label:"Sin configurar",color:"text-amber-500"}:{status:"active",label:"Activo",color:"text-emerald-500"}:{status:"disabled",label:"Desactivado",color:"text-muted-foreground"}:a==="whatsapp"?s.notificarWhatsapp?!s.telefonoWhatsapp||!ce(s.telefonoWhatsapp)?{status:"warning",label:"Sin configurar",color:"text-amber-500"}:{status:"active",label:"Activo",color:"text-emerald-500"}:{status:"disabled",label:"Desactivado",color:"text-muted-foreground"}:h?m==="denied"?{status:"error",label:"Bloqueado",color:"text-destructive"}:s.notificarDispositivo?m!=="granted"?{status:"warning",label:"Sin permiso",color:"text-amber-500"}:{status:"active",label:"Activo",color:"text-emerald-500"}:{status:"disabled",label:"Desactivado",color:"text-muted-foreground"}:{status:"error",label:"No soportado",color:"text-destructive"},Q=({status:a})=>a==="active"?e.jsx(J,{className:"h-3.5 w-3.5 text-emerald-500"}):a==="warning"?e.jsx(se,{className:"h-3.5 w-3.5 text-amber-500"}):a==="error"?e.jsx(ts,{className:"h-3.5 w-3.5 text-destructive"}):e.jsx("div",{className:"h-3.5 w-3.5 rounded-full bg-muted-foreground/30"});return C?e.jsx(ye,{title:"Configuraciones",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(B,{className:"h-6 w-6 animate-spin text-primary"})})}):e.jsx(ye,{title:"Configuraciones",children:e.jsxs("div",{className:"space-y-4 pb-24",children:[e.jsxs("div",{className:"glass-panel rounded-2xl p-4 border border-border/40 shadow-premium",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(le,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Estado de Canales"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Resumen de notificaciones"})]})]}),e.jsx("div",{className:"grid grid-cols-3 gap-2",children:["email","whatsapp","push"].map(a=>{const{status:P,label:W,color:Le}=U(a);return e.jsxs("div",{className:"flex flex-col items-center p-2 rounded-lg bg-accent/30",children:[e.jsx(Q,{status:P}),e.jsx("span",{className:"text-[10px] font-medium mt-1 capitalize",children:a==="push"?"Push":a}),e.jsx("span",{className:N("text-[9px]",Le),children:W})]},a)})})]}),e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden border border-border/40 shadow-premium",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer active:bg-accent/50",onClick:()=>f(!p),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(ue,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Reglas de alertas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Umbrales de mantenimiento"})]})]}),p?e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"})]}),p&&e.jsxs("div",{className:"px-4 pb-4 space-y-6 animate-fade-in",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold mb-2 block",children:"Alerta cr√≠tica"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ae,{className:"flex-1",value:[s.alertaCritica],min:5,max:100,step:5,onValueChange:([a])=>j({alertaCritica:a})}),e.jsx(l,{variant:"destructive",className:"text-base font-bold min-w-[60px] text-center",children:s.alertaCritica})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Equipos con ",s.alertaCritica," o menos horas/km se marcar√°n en rojo"]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold mb-2 block",children:"Alerta preventiva"}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx(ae,{className:"flex-1",value:[s.alertaPreventiva],min:10,max:200,step:10,onValueChange:([a])=>j({alertaPreventiva:a})}),e.jsx(l,{className:"bg-amber-500 text-base font-bold min-w-[60px] text-center",children:s.alertaPreventiva})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Se marcar√°n en amarillo cuando resten ",s.alertaPreventiva," horas/km"]})]})]})]}),e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden border border-border/40 shadow-premium",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer active:bg-accent/50",onClick:()=>D(!R),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(je,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Canales de notificaci√≥n"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Email, WhatsApp, Push"})]})]}),R?e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"})]}),R&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"space-y-3 p-3 rounded-xl bg-accent/20 border border-border/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(Pe,{className:"h-4 w-4 text-blue-600"})}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold block",children:"Email"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{status:U("email").status}),e.jsx("span",{className:N("text-xs",U("email").color),children:U("email").label})]})]})]}),e.jsx(_,{checked:s.notificarEmail,onCheckedChange:a=>j({notificarEmail:a}),className:"scale-110"})]}),s.notificarEmail&&e.jsxs("div",{className:"space-y-2 animate-fade-in",children:[e.jsx(V,{placeholder:"alertas@empresa.com",value:s.correoNotificaciones,onChange:a=>j({correoNotificaciones:a.target.value}),className:N("h-10",!ne(s.correoNotificaciones)&&s.correoNotificaciones&&"border-destructive")}),!ne(s.correoNotificaciones)&&s.correoNotificaciones&&e.jsx("p",{className:"text-xs text-destructive",children:"Email inv√°lido"})]})]}),e.jsxs("div",{className:"space-y-3 p-3 rounded-xl bg-accent/20 border border-border/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-green-500/10",children:e.jsx(We,{className:"h-4 w-4 text-green-600"})}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold block",children:"WhatsApp"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{status:U("whatsapp").status}),e.jsx("span",{className:N("text-xs",U("whatsapp").color),children:U("whatsapp").label})]})]})]}),e.jsx(_,{checked:s.notificarWhatsapp,onCheckedChange:a=>j({notificarWhatsapp:a}),className:"scale-110"})]}),s.notificarWhatsapp&&e.jsxs("div",{className:"space-y-2 animate-fade-in",children:[e.jsx(V,{placeholder:"+1 809 000 0000",value:s.telefonoWhatsapp,onChange:a=>j({telefonoWhatsapp:a.target.value}),className:N("h-10",!ce(s.telefonoWhatsapp)&&s.telefonoWhatsapp&&"border-destructive")}),!ce(s.telefonoWhatsapp)&&s.telefonoWhatsapp&&e.jsx("p",{className:"text-xs text-destructive",children:"Tel√©fono inv√°lido"})]})]}),e.jsxs("div",{className:"space-y-3 p-3 rounded-xl bg-accent/20 border border-border/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-purple-500/10",children:e.jsx(ns,{className:"h-4 w-4 text-purple-600"})}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold block",children:"Push (Dispositivo)"}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(Q,{status:U("push").status}),e.jsx("span",{className:N("text-xs",U("push").color),children:U("push").label})]})]})]}),e.jsx(_,{checked:s.notificarDispositivo,onCheckedChange:De,className:"scale-110",disabled:!h})]}),s.notificarDispositivo&&m==="granted"&&e.jsxs(K,{variant:"outline",size:"sm",className:"w-full h-9 gap-2",onClick:Me,disabled:I,children:[I?e.jsx(B,{className:"h-4 w-4 animate-spin"}):e.jsx(rs,{className:"h-4 w-4"}),"Enviar prueba"]})]}),e.jsxs("div",{className:"pt-2",children:[e.jsx(o,{className:"text-xs font-semibold text-muted-foreground uppercase tracking-wider block mb-2",children:"Correo de soporte"}),e.jsx(V,{placeholder:"soporte@empresa.com",value:s.correoSoporte,onChange:a=>j({correoSoporte:a.target.value}),className:"h-10"})]}),S&&e.jsxs("div",{className:"flex items-center justify-center gap-2 py-2",children:[e.jsx(B,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("p",{className:"text-xs text-primary",children:"Guardando..."})]})]})]}),e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden border border-border/40 shadow-premium",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer active:bg-accent/50",onClick:()=>r(!E),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(se,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Tipos de alertas"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Qu√© notificaciones recibir"})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(l,{variant:"secondary",className:"text-xs",children:[t.length,"/",Ce.length]}),E?e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"})]})]}),E&&e.jsx("div",{className:"px-4 pb-4 space-y-3 animate-fade-in",children:Ce.map(a=>{const P=a.icon,W=t.includes(a.id);return e.jsxs("div",{className:N("flex items-center gap-3 p-3 rounded-xl border transition-all cursor-pointer",W?"bg-primary/5 border-primary/20":"bg-accent/20 border-border/30"),onClick:()=>fe(a.id),children:[e.jsx(as,{checked:W,onCheckedChange:()=>fe(a.id),className:"h-5 w-5"}),e.jsx("div",{className:N("p-2 rounded-lg",W?"bg-primary/10":"bg-muted"),children:e.jsx(P,{className:N("h-4 w-4",W?"text-primary":"text-muted-foreground")})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:a.label}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.description})]})]},a.id)})})]}),e.jsxs("div",{className:"glass-panel rounded-2xl overflow-hidden border border-border/40 shadow-premium",children:[e.jsxs("div",{className:"flex items-center justify-between p-4 cursor-pointer active:bg-accent/50",onClick:()=>A(!g),children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-primary/10",children:e.jsx(Re,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Apariencia"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Tema y preferencias"})]})]}),g?e.jsx(ee,{className:"h-5 w-5 text-muted-foreground"}):e.jsx(Z,{className:"h-5 w-5 text-muted-foreground"})]}),g&&e.jsxs("div",{className:"px-4 pb-4 space-y-4 animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{className:"text-sm font-semibold block",children:"Modo oscuro autom√°tico"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Seg√∫n preferencias del sistema"})]}),e.jsx(_,{checked:s.modoOscuroAutomatico,onCheckedChange:a=>j({modoOscuroAutomatico:a}),className:"scale-110"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(o,{className:"text-sm font-semibold block",children:"Permitir importaciones"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Subir archivos JSON"})]}),e.jsx(_,{checked:s.permitirImportaciones,onCheckedChange:a=>j({permitirImportaciones:a}),className:"scale-110"})]})]})]}),e.jsxs(K,{variant:"outline",className:"w-full h-12 gap-2 text-base font-semibold border-2 active:scale-95 transition-all",onClick:Ue,children:[e.jsx(is,{className:"h-5 w-5"}),"Restaurar valores por defecto"]}),e.jsx("p",{className:"text-center text-xs text-muted-foreground py-4",children:"ALITO Mantenimiento v1.0"})]})})}function zs(){const{config:d,loading:C,saving:S,updateConfig:k}=Se(),[s,c]=i.useState(d),m=i.useRef(s),h=i.useRef(),{permission:u,supported:T,requestPermission:n}=Ee(),{toast:p}=pe(),{isMobile:f}=ss(),{isAdmin:R}=ie(),[D,E]=i.useState("general");i.useEffect(()=>{c(d),m.current=d},[d]),i.useEffect(()=>()=>{h.current&&window.clearTimeout(h.current)},[]);const r=t=>{const x={...m.current,...t};m.current=x,c(x),h.current&&window.clearTimeout(h.current),h.current=window.setTimeout(()=>{k(x)},400)},g=i.useMemo(()=>({critica:s.alertaCritica,preventiva:s.alertaPreventiva}),[s.alertaCritica,s.alertaPreventiva]),A=()=>{k(he)},I=i.useMemo(()=>T?u==="granted"?"Permiso concedido. Recibir√°s alertas directamente en este dispositivo.":u==="denied"?"El navegador est√° bloqueando las notificaciones. Act√≠valas en la configuraci√≥n del sitio para recibir alertas.":"Solicitaremos permiso del navegador cuando actives esta opci√≥n.":"Tu navegador no soporta notificaciones push.",[u,T]),M=async t=>{if(!t){r({notificarDispositivo:!1});return}if(!T){p({title:"No disponible",description:"Este navegador no soporta notificaciones push.",variant:"destructive"}),r({notificarDispositivo:!1});return}if(u==="denied"){p({title:"Permiso bloqueado",description:"Habilita las notificaciones del navegador para recibir alertas en este equipo.",variant:"destructive"}),r({notificarDispositivo:!1});return}if(u==="default"&&!await n()){r({notificarDispositivo:!1});return}r({notificarDispositivo:!0})};return C?f?e.jsx("div",{className:"flex h-screen flex-col bg-background",children:e.jsx("div",{className:"flex items-center justify-center flex-1",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cargando preferencias..."})})}):e.jsx(ge,{title:"Preferencias y automatizaciones",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"text-sm text-muted-foreground",children:"Cargando preferencias..."})})}):f?e.jsx(xs,{}):e.jsx(ge,{title:"Preferencias y automatizaciones",children:e.jsxs(Ae,{value:D,onValueChange:E,className:"space-y-6",children:[e.jsxs(Te,{className:"grid w-full grid-cols-2 lg:w-auto lg:inline-grid",children:[e.jsxs(O,{value:"general",className:"gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),e.jsx("span",{children:"General"})]}),R&&e.jsxs(O,{value:"admin",className:"gap-2",children:[e.jsx(le,{className:"h-4 w-4"}),e.jsx("span",{children:"Administraci√≥n"})]})]}),e.jsxs(F,{value:"general",className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-5 w-5 text-primary"})," Reglas de alertas"]}),e.jsx(L,{children:"Ajusta los umbrales para resaltar mantenimientos prioritarios."})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:"Alerta cr√≠tica (horas/km restantes)"}),e.jsx(ae,{className:"mt-4",value:[s.alertaCritica],min:5,max:100,step:5,onValueChange:([t])=>r({alertaCritica:t})}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Se resaltar√°n en rojo los equipos con ",s.alertaCritica," o menos horas/km restantes."]})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-medium",children:"Alerta preventiva (horas/km restantes)"}),e.jsx(ae,{className:"mt-4",value:[s.alertaPreventiva],min:10,max:200,step:10,onValueChange:([t])=>r({alertaPreventiva:t})}),e.jsxs("p",{className:"mt-2 text-sm text-muted-foreground",children:["Los mantenimientos se marcar√°n en amarillo cuando resten ",s.alertaPreventiva," horas/km."]})]}),e.jsxs("div",{className:"flex items-center gap-3 rounded-md border p-3",children:[e.jsx(l,{variant:"secondary",children:"Resumen"}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Cr√≠tica: <= ",g.critica," horas/km"]}),e.jsxs("p",{children:["Preventiva: <= ",g.preventiva," horas/km"]})]})]})]})]}),e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-primary"})," Notificaciones autom√°ticas"]}),e.jsx(L,{children:"Define a qui√©n avisar cuando se alcance un umbral."})]}),e.jsxs(w,{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Enviar correo electr√≥nico"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Notifica al responsable asignado del equipo."})]}),e.jsx(_,{checked:s.notificarEmail,onCheckedChange:t=>r({notificarEmail:t})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Enviar alerta por WhatsApp"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ideal para avisos r√°pidos al supervisor."})]}),e.jsx(_,{checked:s.notificarWhatsapp,onCheckedChange:t=>r({notificarWhatsapp:t})})]}),e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Notificaciones en este dispositivo"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Recibe alertas incluso cuando la app est√° en segundo plano (requiere permiso)."}),e.jsxs("div",{className:"mt-2 flex flex-col gap-1",children:[e.jsx("p",{className:`text-xs ${!T||u==="denied"?"text-destructive":"text-green-600"}`,children:I}),e.jsx("p",{className:"text-[10px] text-muted-foreground italic",children:"* Al activar, aceptas recibir notificaciones seg√∫n nuestra pol√≠tica de privacidad."})]})]}),e.jsx(_,{checked:s.notificarDispositivo,onCheckedChange:t=>void M(t)})]}),e.jsx(Fe,{}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Correo de soporte"}),e.jsx(V,{placeholder:"soporte@empresa.com",value:s.correoSoporte,onChange:t=>r({correoSoporte:t.target.value})}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Se usar√° como remitente en las notificaciones autom√°ticas."})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Correo para notificaciones"}),e.jsx(V,{placeholder:"alertas@empresa.com",value:s.correoNotificaciones,onChange:t=>r({correoNotificaciones:t.target.value})}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Si est√° presente y el canal est√° habilitado, se enviar√°n correos con alertas importantes."})]}),e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Tel√©fono WhatsApp"}),e.jsx(V,{placeholder:"+1 809 000 0000",value:s.telefonoWhatsapp,onChange:t=>r({telefonoWhatsapp:t.target.value})}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground",children:"Incluye el c√≥digo de pa√≠s para recibir avisos en tu m√≥vil."})]}),S&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Guardando cambios..."})]})]})]}),e.jsxs(v,{children:[e.jsxs(b,{children:[e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 text-primary"})," Preferencias de apariencia"]}),e.jsx(L,{children:"Elige c√≥mo debe comportarse el modo oscuro del panel."})]}),e.jsxs(w,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Activar modo oscuro autom√°ticamente"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Si est√° activo, el sistema respetar√° las preferencias del dispositivo del usuario."})]}),e.jsx(_,{checked:s.modoOscuroAutomatico,onCheckedChange:t=>r({modoOscuroAutomatico:t})})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx(o,{className:"text-sm font-semibold",children:"Permitir importaciones manuales"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Controla si los usuarios pueden subir archivos JSON desde cualquier m√≥dulo."})]}),e.jsx(_,{checked:s.permitirImportaciones,onCheckedChange:t=>r({permitirImportaciones:t})})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(K,{variant:"outline",onClick:A,children:"Restaurar valores por defecto"})})]})]})]}),R&&e.jsx(F,{value:"admin",children:e.jsx(ms,{})})]})})}export{zs as default};
