import{c as ge,r as c,j as e,a as Z,T as oe,d as ce,e as de,f as me,b as Re}from"./index-C_D-5Bfv.js";import{D as Ue,n as Ne,o as He,p as Ge,q as Qe,u as Te,a as Ae,r as ze,b as Fe,c as Ie,d as Oe,e as Le,B as $,s as qe,t as he,f as ae,g as H,i as V,L as we,h as G,j as ye,v as Ce,l as J,k as W,T as Ye}from"./card-BIr-PJK2.js";import{T as Ze,a as _e,b as Se,c as L,d as Ke,e as q}from"./table-CQA1OK80.js";import{B as p}from"./index-BtotK06U.js";import{I as B}from"./input-DSUZcGci.js";import{S as xe,a as ue,b as pe,c as fe,d as Q}from"./select-3Jn5ARjr.js";import{S as Xe}from"./slider-soslqLj5.js";import{L as D}from"./label-CqFCS6R-.js";import{S as Je}from"./switch-B03PpzBD.js";import{T as We}from"./textarea-BSj91dWz.js";import{S as De}from"./square-pen-B3pUQB5y.js";import{P as Be}from"./plus-Cjn5SSed.js";import{Z as ea,a as aa,E as sa}from"./EquipoLink-CSkpzgUp.js";import{h as ra,c as Ee,a as ta,b as la,i as ia,g as na,M as oa}from"./permissions-Dq4AqOHE.js";import{F as ke}from"./filter-ldW4984T.js";import{L as se}from"./lock-Dz87eZuj.js";import{S as ca}from"./sparkles-CBL8q4dG.js";import{E as Me}from"./EquipoDetalleUnificado-BkhxSrqD.js";import{u as da}from"./useDeviceDetection-CShWnkOv.js";import{M as ma}from"./MobileLayout-CV04gzFk.js";import{M as ne,a as ha}from"./MobileCard-DMSzGukU.js";import{D as xa,a as ua,E as pa,b as fa,c as ee}from"./dropdown-menu-DmUKo3Zs.js";import{L as ja}from"./list-filter-CnSSRe_v.js";import{E as ga}from"./eye-C6tgOrd-.js";import{T as va}from"./trending-up-Hw4Rtp_f.js";import"./useHistorial-CCPwivlN.js";import"./tabs-KnLULWOS.js";import"./index-APdQY6Km.js";import"./accordion-CavA7SNR.js";import"./useCaterpillarData-DbqCupgf.js";import"./caterpillarMaintenance-Dg_xV4Xi.js";import"./maintenanceUtils-fNWGA9SH.js";import"./usePlanes-D-d8Ujwc.js";import"./format-B1dMESlT.js";import"./activity-DZxii9vr.js";import"./chevron-right-fj5H7AOZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ba=ge("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Na=ge("PowerOff",[["path",{d:"M18.36 6.64A9 9 0 0 1 20.77 15",key:"dxknvb"}],["path",{d:"M6.16 6.16a9 9 0 1 0 12.68 12.68",key:"1x7qb5"}],["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wa=ge("Power",[["path",{d:"M12 2v10",key:"mnfbl"}],["path",{d:"M18.4 6.6a9 9 0 1 1-12.77.04",key:"obofu9"}]]),ya=["Vehículo transporte","Excavadora","Minicargadores","Retropalas","Camiones","Rodillos","Telehandler","Miniretro","Vehículo personal"];function je({equipo:t,onSave:y,trigger:S,open:k,onOpenChange:h,onSubmit:b,initialData:C}){const[f,w]=c.useState(!1),R=k!==void 0?k:f,N=h||w,r=C||t,[l,n]=c.useState({ficha:(r==null?void 0:r.ficha)||"",nombre:(r==null?void 0:r.nombre)||"",marca:(r==null?void 0:r.marca)||"",modelo:(r==null?void 0:r.modelo)||"",numeroSerie:(r==null?void 0:r.numeroSerie)||"",placa:(r==null?void 0:r.placa)||"",categoria:(r==null?void 0:r.categoria)||"",activo:(r==null?void 0:r.activo)??!0,motivoInactividad:(r==null?void 0:r.motivoInactividad)||""});c.useEffect(()=>{const s=C||t;s&&n({ficha:s.ficha||"",nombre:s.nombre||"",marca:s.marca||"",modelo:s.modelo||"",numeroSerie:s.numeroSerie||"",placa:s.placa||"",categoria:s.categoria||"",activo:s.activo??!0,motivoInactividad:s.motivoInactividad||""})},[C,t]);const A=async()=>{const s={...l,motivoInactividad:l.activo?null:l.motivoInactividad.trim()||null},i=r?{...s,id:r.id}:s;b?await b(i):y&&y(i),N(!1)};return e.jsxs(Ue,{open:R,onOpenChange:N,children:[S&&e.jsx(Ne,{asChild:!0,children:S}),!S&&e.jsx(Ne,{asChild:!0,children:e.jsxs(p,{children:[r?e.jsx(De,{className:"w-4 h-4 mr-2"}):e.jsx(Be,{className:"w-4 h-4 mr-2"}),r?"Editar":"Agregar Equipo"]})}),e.jsxs(He,{className:"w-full max-w-2xl",children:[e.jsx(Ge,{children:e.jsx(Qe,{children:r?"Editar Equipo":"Agregar Nuevo Equipo"})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 py-4 md:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx(D,{htmlFor:"ficha",children:"Ficha"}),e.jsx(B,{id:"ficha",value:l.ficha,onChange:s=>n({...l,ficha:s.target.value}),placeholder:"AC-001"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"nombre",children:"Nombre"}),e.jsx(B,{id:"nombre",value:l.nombre,onChange:s=>n({...l,nombre:s.target.value}),placeholder:"HILUX 2021"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"marca",children:"Marca"}),e.jsx(B,{id:"marca",value:l.marca,onChange:s=>n({...l,marca:s.target.value}),placeholder:"TOYOTA"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"modelo",children:"Modelo"}),e.jsx(B,{id:"modelo",value:l.modelo,onChange:s=>n({...l,modelo:s.target.value}),placeholder:"2021"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"numeroSerie",children:"Número de Serie"}),e.jsx(B,{id:"numeroSerie",value:l.numeroSerie,onChange:s=>n({...l,numeroSerie:s.target.value}),placeholder:"123456789"})]}),e.jsxs("div",{children:[e.jsx(D,{htmlFor:"placa",children:"Placa"}),e.jsx(B,{id:"placa",value:l.placa,onChange:s=>n({...l,placa:s.target.value}),placeholder:"ABC-123"})]}),e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(D,{htmlFor:"categoria",children:"Categoría"}),e.jsxs(xe,{value:l.categoria,onValueChange:s=>n({...l,categoria:s}),children:[e.jsx(ue,{className:"w-full",children:e.jsx(pe,{placeholder:"Seleccionar categoría"})}),e.jsx(fe,{children:ya.map(s=>e.jsx(Q,{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 md:col-span-2",children:[e.jsx(Je,{id:"activo",checked:l.activo,onCheckedChange:s=>n({...l,activo:s})}),e.jsx(D,{htmlFor:"activo",children:"Equipo activo"})]}),!l.activo&&e.jsxs("div",{className:"md:col-span-2",children:[e.jsx(D,{htmlFor:"motivoInactividad",children:"Motivo de Inactividad"}),e.jsx(We,{id:"motivoInactividad",value:l.motivoInactividad,onChange:s=>n({...l,motivoInactividad:s.target.value}),placeholder:"Motivo por el cual está inactivo..."})]})]}),e.jsxs("div",{className:"flex flex-col-reverse gap-2 sm:flex-row sm:justify-end sm:space-x-2",children:[e.jsx(p,{variant:"outline",onClick:()=>N(!1),className:"w-full sm:w-auto",children:"Cancelar"}),e.jsx(p,{onClick:A,className:"w-full sm:w-auto",children:"Guardar"})]})]})]})}function Pe(){const{currentUserRole:t,isAdmin:y,loading:S}=Te();return{...c.useMemo(()=>({has:(h,b)=>ra(t,h,b),canAccess:h=>Ee(t,h),canEdit:h=>ta(t,h),canDelete:h=>la(t,h),isModuleAdmin:h=>ia(t,h),getPermissions:h=>na(t,h),accessibleModules:oa.filter(h=>Ee(t,h.id)),isGlobalAdmin:y,role:t}),[t,y]),loading:S}}const Ca={transporte:["camion","camiones","volquete","dump truck","haul truck"],camiones:["camion","camiones","volquete","haul truck"],excavadora:["excavadora","excavadoras"],excavacion:["excavadora","excavadoras","zanjadora"],carga:["cargador","cargadores","loader"],minicargadores:["minicargador","minicargadores","skid steer"],retroexcavadora:["retroexcavadora","retroexcavadoras","retropala","backhoe"],retropalas:["retropala","retropalas","retroexcavadora"],miniexcavadora:["mini excavadora","miniexcavadora","mini retro"],compactador:["rodillo","rodillos","compactador","compactadora"],rodillos:["rodillo","rodillos","compactador"]},T=t=>t.toLowerCase().normalize("NFD").replace(/[^a-z0-9\s-]/g," ").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g," ").trim();function Sa({equipos:t,onEdit:y,onDelete:S,onVerDetalle:k}){const[h,b]=c.useState(""),[C,f]=c.useState(""),[w,R]=c.useState("all"),[N,r]=c.useState("all"),[l,n]=c.useState(1),{canEdit:A,canDelete:s}=Pe(),i=A("equipos"),v=s("equipos"),u=c.useMemo(()=>[...new Set(t.map(a=>a.categoria))],[t]),z=c.useMemo(()=>[...new Set(t.map(a=>a.marca))],[t]),F=c.useMemo(()=>u.map(a=>{const j=T(a),o=Ca[j]??[],g=new Set([j,...o.map(I=>T(I))]);return{categoria:a,tokens:g}}),[u]),M=c.useMemo(()=>{const a=T(C);if(!a)return{predicate:null,tags:[]};const j=[],o=[],g=[],I=new Set,X=new Set,re={};let te=null;const Ve=d=>{const m=T(d),x=F.find(({tokens:O})=>Array.from(O).some(E=>m.includes(E)||E.includes(m)));return x==null?void 0:x.categoria},le=d=>{const m=T(d);return z.find(O=>{const E=T(O);return E.includes(m)||m.includes(E)})??d.trim()};F.forEach(({categoria:d,tokens:m})=>{Array.from(m).some(x=>a.includes(x))&&X.add(d)});const $e=/no\s+(?:son|sean)\s+([a-z0-9\s]+)/g;let ve;for(;(ve=$e.exec(a))!==null;){const d=ve[1].trim();if(!d)continue;const m=le(d),x=T(m);o.includes(x)||(o.push(x),j.push(`Excluir marca: ${m}`))}[...a.matchAll(/solo\s+(?:los|las)?\s*([a-z0-9\s]+)/g)].forEach(d=>{const m=d[1],x=Ve(m);if(x)I.add(x),j.push(`Solo categorÃ­a: ${x}`),X.add(x);else{const O=le(m),E=T(O);g.includes(E)||(g.push(E),j.push(`Incluir marca: ${O}`))}}),[...a.matchAll(/que\s+sean\s+([a-z0-9\s]+)/g)].forEach(d=>{const m=le(d[1]),x=T(m);g.includes(x)||(g.push(x),j.push(`Solo marca: ${m}`))});const be=a.match(/superan\s+la\s+ficha\s+([a-z0-9-]+)/);if(be){const d=be[1].toUpperCase();X.size>0?X.forEach(m=>{re[m]={...re[m]??{},fichaMin:d},j.push(`Ficha > ${d} en ${m}`)}):(te=d,j.push(`Ficha > ${d}`))}return{predicate:d=>{var E;const m=T(d.marca);if(o.some(ie=>m.includes(ie))||g.length&&!g.some(ie=>m.includes(ie))||I.size>0&&!I.has(d.categoria))return!1;const x=re[d.categoria],O=((E=d.ficha)==null?void 0:E.toUpperCase())??"";return!(x!=null&&x.fichaMin&&O<=x.fichaMin||te&&O<=te)},tags:j}},[C,F,z]),P=a=>Math.min(1.4,Math.max(.8,Number(a.toFixed(2)))),U=a=>{a.length&&n(P(a[0]))},_=a=>{n(j=>P(j+a))},K=t.filter(a=>{const j=Object.values(a).join(" ").toLowerCase().includes(h.toLowerCase()),o=w==="all"||a.categoria===w,g=N==="all"||N==="activo"&&a.activo||N==="inactivo"&&!a.activo,I=M.predicate?M.predicate(a):!0;return j&&o&&g&&I}).sort((a,j)=>a.ficha.localeCompare(j.ficha,"es",{numeric:!0,sensitivity:"base"})),Y=()=>e.jsxs("div",{className:"flex w-full flex-col gap-4 sm:flex-row sm:flex-wrap sm:items-start",children:[e.jsxs("div",{className:"w-full space-y-3 sm:max-w-md",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(B,{placeholder:"Buscar equipos...",value:h,onChange:a=>b(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"relative",children:[e.jsx(ca,{className:"pointer-events-none absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-primary"}),e.jsx(B,{placeholder:'Búsqueda inteligente (ej. "equipos que no son Caterpillar y camiones con ficha > AC-44")',value:C,onChange:a=>f(a.target.value),className:"pl-10 text-sm","aria-label":"Búsqueda inteligente con IA"})]}),M.tags.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2",children:M.tags.map(a=>e.jsx($,{variant:"outline",className:"border-primary/40 bg-primary/5 text-xs font-medium text-primary",children:a},a))})]}),e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center",children:[e.jsxs(xe,{value:w,onValueChange:R,children:[e.jsxs(ue,{className:"w-full sm:w-[200px]",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),e.jsx(pe,{placeholder:"CategorÃ­a"})]}),e.jsxs(fe,{children:[e.jsx(Q,{value:"all",children:"Todas las categorías"}),u.map(a=>e.jsx(Q,{value:a,children:a},a))]})]}),e.jsxs(xe,{value:N,onValueChange:r,children:[e.jsx(ue,{className:"w-full sm:w-[150px]",children:e.jsx(pe,{placeholder:"Estado"})}),e.jsxs(fe,{children:[e.jsx(Q,{value:"all",children:"Todos"}),e.jsx(Q,{value:"activo",children:"Activos"}),e.jsx(Q,{value:"inactivo",children:"Inactivos"})]})]})]})]});return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs(Ae,{children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:hidden",children:[e.jsx("span",{className:"text-sm font-semibold text-primary",children:"Filtros"}),e.jsx(ze,{asChild:!0,children:e.jsxs(p,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(ke,{className:"h-4 w-4"}),"Ajustar filtros"]})})]}),e.jsx("div",{className:"hidden w-full sm:block",children:Y()}),e.jsxs(Fe,{side:"bottom",className:"sm:hidden",children:[e.jsxs(Ie,{className:"text-left",children:[e.jsx(Oe,{children:"Filtros y búsqueda"}),e.jsx(Le,{children:"Refina la tabla para encontrar el equipo que necesitas."})]}),e.jsx("div",{className:"mt-6 space-y-4",children:Y()})]})]}),e.jsxs("div",{className:"flex flex-col gap-2 sm:flex-row sm:items-center sm:gap-3",children:[e.jsx("span",{className:"text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"Zoom"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(p,{type:"button",size:"icon",variant:"outline",onClick:()=>_(-.1),"aria-label":"Reducir zoom de la tabla",children:e.jsx(ea,{className:"h-4 w-4"})}),e.jsx(Xe,{value:[l],min:.8,max:1.4,step:.05,onValueChange:U,className:"w-32 sm:w-40","aria-label":"Control de zoom"}),e.jsx(p,{type:"button",size:"icon",variant:"outline",onClick:()=>_(.1),"aria-label":"Aumentar zoom de la tabla",children:e.jsx(aa,{className:"h-4 w-4"})}),e.jsxs("span",{className:"w-12 text-center text-sm font-medium text-muted-foreground",children:[Math.round(l*100),"%"]})]})]})]})}),e.jsx("div",{className:"rounded-2xl border border-border/70 bg-card/80 p-2 shadow-lg ring-1 ring-primary/5 dark:border-slate-800 dark:bg-slate-950/40 sm:p-4",children:e.jsx("div",{className:Z("overflow-x-auto",l>1?"pb-4":void 0),style:{touchAction:"pan-y pinch-zoom"},children:e.jsx("div",{className:"rounded-xl bg-background/80 p-2 shadow-inner dark:bg-slate-900/70",children:e.jsx("div",{className:"origin-top-left",style:{transform:`scale(${l})`,transformOrigin:"top left",width:`${100/l}%`},children:e.jsxs(Ze,{className:"min-w-[1100px]",children:[e.jsx(_e,{children:e.jsxs(Se,{children:[e.jsx(L,{children:"Ficha"}),e.jsx(L,{children:"Nombre"}),e.jsx(L,{children:"Marca"}),e.jsx(L,{children:"Modelo"}),e.jsx(L,{children:"N° Serie"}),e.jsx(L,{children:"Categoría"}),e.jsx(L,{children:"Placa"}),e.jsx(L,{children:"Estado"}),e.jsx(L,{children:"Acciones"})]})}),e.jsx(Ke,{children:K.map(a=>e.jsxs(Se,{children:[e.jsx(q,{className:"font-medium",children:a.ficha}),e.jsx(q,{children:e.jsx(sa,{ficha:a.ficha,variant:"link",className:"p-0 h-auto font-normal hover:underline",children:a.nombre})}),e.jsx(q,{children:a.marca}),e.jsx(q,{children:a.modelo}),e.jsx(q,{children:a.numeroSerie}),e.jsx(q,{children:a.categoria}),e.jsx(q,{children:a.placa}),e.jsx(q,{children:e.jsx($,{variant:a.activo?"default":"secondary",children:a.activo?"Activo":"Inactivo"})}),e.jsx(q,{children:e.jsxs("div",{className:"flex space-x-2",children:[k&&e.jsx(p,{variant:"default",size:"sm",onClick:()=>k(a.ficha),children:"Ver Detalle"}),i?e.jsx(je,{equipo:a,onSave:y,trigger:e.jsx(p,{variant:"outline",size:"sm",children:e.jsx(De,{className:"w-4 h-4"})})}):e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(p,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:e.jsx(se,{className:"w-4 h-4"})})}),e.jsx(me,{children:e.jsx("p",{children:"Solo administradores pueden editar"})})]})}),v?e.jsx(p,{variant:"outline",size:"sm",onClick:()=>S(a.id),className:"text-destructive hover:text-destructive-foreground hover:bg-destructive",children:e.jsx(qe,{className:"w-4 h-4"})}):e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsx(p,{variant:"outline",size:"sm",disabled:!0,className:"opacity-50",children:e.jsx(se,{className:"w-4 h-4"})})}),e.jsx(me,{children:e.jsx("p",{children:"Solo administradores pueden eliminar"})})]})})]})})]},a.id))})]})})})})}),K.length===0&&e.jsx("div",{className:"py-8 text-center text-muted-foreground",children:"No se encontraron equipos que coincidan con los filtros seleccionados."})]})}function Ea({equipos:t,onVerDetalle:y,onEdit:S,onDelete:k,onAdd:h}){const[b,C]=c.useState(""),[f,w]=c.useState("all"),[R,N]=c.useState(!1),{currentUserRole:r}=Te(),l=r==="admin",n=c.useMemo(()=>({total:t.length,activos:t.filter(i=>i.activo).length,inactivos:t.filter(i=>!i.activo).length}),[t]),A=c.useMemo(()=>{let i=t;if(f==="active"?i=i.filter(v=>v.activo):f==="inactive"&&(i=i.filter(v=>!v.activo)),b.trim()){const v=b.toLowerCase();i=i.filter(u=>{var z,F,M,P,U;return((z=u.ficha)==null?void 0:z.toLowerCase().includes(v))||((F=u.nombre)==null?void 0:F.toLowerCase().includes(v))||((M=u.marca)==null?void 0:M.toLowerCase().includes(v))||((P=u.modelo)==null?void 0:P.toLowerCase().includes(v))||((U=u.placa)==null?void 0:U.toLowerCase().includes(v))})}return i},[t,f,b]),s=i=>e.jsx(ae,{className:"h-5 w-5"});return e.jsxs(ma,{title:"Equipos",headerActions:e.jsxs(Ae,{open:R,onOpenChange:N,children:[e.jsx(ze,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-primary/10 active:scale-95 transition-all",children:e.jsx(ja,{className:"h-5 w-5"})})}),e.jsxs(Fe,{side:"bottom",className:"h-[400px] rounded-t-[2rem] border-t-0 bg-background/95 backdrop-blur-xl",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted"}),e.jsxs(Ie,{className:"mt-4",children:[e.jsx(Oe,{className:"text-center text-xl font-bold",children:"Filtros"}),e.jsx(Le,{className:"text-center",children:"Organiza tu vista de equipos"})]}),e.jsxs("div",{className:"mt-8 space-y-3 px-4",children:[e.jsxs(p,{variant:f==="all"?"default":"outline",className:Z("w-full justify-start gap-3 h-14 text-base rounded-xl transition-all",f==="all"&&"bg-primary shadow-lg shadow-primary/25"),onClick:()=>{w("all"),N(!1)},children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-background/20",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsx("span",{children:"Todos los equipos"}),e.jsx($,{variant:"secondary",className:"bg-background/20 text-foreground",children:n.total})]})]}),e.jsxs(p,{variant:f==="active"?"default":"outline",className:Z("w-full justify-start gap-3 h-14 text-base rounded-xl transition-all",f==="active"&&"bg-emerald-600 hover:bg-emerald-700 shadow-lg shadow-emerald-600/25 border-emerald-600"),onClick:()=>{w("active"),N(!1)},children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-background/20",children:e.jsx(wa,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsx("span",{children:"Equipos Activos"}),e.jsx($,{variant:"secondary",className:"bg-background/20 text-foreground",children:n.activos})]})]}),e.jsxs(p,{variant:f==="inactive"?"default":"outline",className:Z("w-full justify-start gap-3 h-14 text-base rounded-xl transition-all",f==="inactive"&&"bg-slate-600 hover:bg-slate-700 shadow-lg shadow-slate-600/25 border-slate-600"),onClick:()=>{w("inactive"),N(!1)},children:[e.jsx("div",{className:"flex h-8 w-8 items-center justify-center rounded-full bg-background/20",children:e.jsx(Na,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex flex-1 items-center justify-between",children:[e.jsx("span",{children:"Equipos Inactivos"}),e.jsx($,{variant:"secondary",className:"bg-background/20 text-foreground",children:n.inactivos})]})]})]})]})]}),children:[e.jsxs("div",{className:"space-y-6 pb-24",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[e.jsxs(ne,{variant:"glass",className:"p-3 text-center bg-primary/5 border-primary/10",children:[e.jsx("p",{className:"text-2xl font-bold text-primary",children:n.total}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-muted-foreground font-semibold",children:"Total"})]}),e.jsxs(ne,{variant:"glass",className:"p-3 text-center bg-emerald-500/5 border-emerald-500/10",children:[e.jsx("p",{className:"text-2xl font-bold text-emerald-600 dark:text-emerald-400",children:n.activos}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-muted-foreground font-semibold",children:"Activos"})]}),e.jsxs(ne,{variant:"glass",className:"p-3 text-center bg-slate-500/5 border-slate-500/10",children:[e.jsx("p",{className:"text-2xl font-bold text-slate-500 dark:text-slate-400",children:n.inactivos}),e.jsx("p",{className:"text-[10px] uppercase tracking-wider text-muted-foreground font-semibold",children:"Inactivos"})]})]}),e.jsxs("div",{className:"sticky top-0 z-20 -mx-4 px-4 py-2 bg-background/80 backdrop-blur-xl border-b border-border/50",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(B,{placeholder:"Buscar por ficha, nombre, placa...",value:b,onChange:i=>C(i.target.value),className:"pl-9 bg-muted/50 border-0 focus-visible:ring-1 focus-visible:ring-primary/50 h-10 rounded-xl"})]}),f!=="all"&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 animate-in slide-in-from-top-2 fade-in",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"Filtrando por:"}),e.jsxs($,{variant:"secondary",className:"gap-1 pl-1 pr-2 h-6",children:[e.jsx("div",{className:Z("h-1.5 w-1.5 rounded-full",f==="active"?"bg-emerald-500":"bg-slate-500")}),f==="active"?"Activos":"Inactivos",e.jsx("button",{onClick:()=>w("all"),className:"ml-1 hover:text-foreground",children:"×"})]})]})]}),A.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 text-center animate-in fade-in zoom-in-95 duration-300",children:[e.jsx("div",{className:"h-24 w-24 rounded-full bg-muted/50 flex items-center justify-center mb-4",children:e.jsx(he,{className:"h-10 w-10 text-muted-foreground/50"})}),e.jsx("h3",{className:"text-lg font-semibold",children:"No se encontraron equipos"}),e.jsx("p",{className:"mt-2 text-sm text-muted-foreground max-w-[250px]",children:b?"Intenta con otros términos de búsqueda":"No hay equipos en esta categoría"}),b&&e.jsx(p,{variant:"link",onClick:()=>C(""),className:"mt-2",children:"Limpiar búsqueda"})]}):e.jsx("div",{className:"space-y-3",children:A.map((i,v)=>e.jsxs("div",{className:"relative group animate-in slide-in-from-bottom-4 fade-in fill-mode-backwards",style:{animationDelay:`${v*.05}s`},children:[e.jsx(ha,{title:i.ficha||"Sin ficha",subtitle:i.nombre||"Sin nombre",meta:`${i.marca||""} ${i.modelo||""}`.trim()||"Sin marca/modelo",icon:s(i.categoria),className:"bg-card/50 backdrop-blur-sm border-border/50 hover:bg-accent/50 transition-all",badge:i.activo?e.jsx($,{variant:"outline",className:"text-[10px] h-5 border-emerald-500/30 text-emerald-600 bg-emerald-500/5",children:"Activo"}):e.jsx($,{variant:"outline",className:"text-[10px] h-5 border-slate-500/30 text-slate-600 bg-slate-500/5",children:"Inactivo"}),onClick:()=>y(i.ficha||"")}),e.jsxs(xa,{children:[e.jsx(ua,{asChild:!0,children:e.jsx(p,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 h-8 w-8 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-opacity focus:opacity-100 active:opacity-100 data-[state=open]:opacity-100",onClick:u=>u.stopPropagation(),children:e.jsx(pa,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs(fa,{align:"end",className:"w-48 rounded-xl",children:[e.jsxs(ee,{onClick:u=>{u.stopPropagation(),y(i.ficha||"")},className:"gap-2 py-2.5",children:[e.jsx(ga,{className:"h-4 w-4 text-primary"}),"Ver detalle"]}),l?e.jsxs(e.Fragment,{children:[e.jsxs(ee,{onClick:u=>{u.stopPropagation(),S(i)},className:"gap-2 py-2.5",children:[e.jsx(ba,{className:"h-4 w-4"}),"Editar"]}),e.jsxs(ee,{onClick:u=>{u.stopPropagation(),k(i.id)},className:"gap-2 py-2.5 text-destructive focus:text-destructive focus:bg-destructive/10",children:[e.jsx(qe,{className:"h-4 w-4"}),"Eliminar"]})]}):e.jsxs(ee,{disabled:!0,className:"gap-2 py-2.5 text-muted-foreground",children:[e.jsx(se,{className:"h-4 w-4"}),"Solo lectura"]})]})]})]},i.id))})]}),l&&e.jsx(p,{className:"fixed bottom-24 right-4 z-50 h-14 w-14 min-h-[var(--touch-target-large)] rounded-full shadow-lg shadow-primary/30 bg-primary hover:bg-primary/90 hover:scale-105 active:scale-95 transition-all duration-300",size:"icon",onClick:h,children:e.jsx(Be,{className:"h-7 w-7 text-primary-foreground"})})]})}function hs(){const{data:t,loading:y,createEquipo:S,updateEquipo:k,deleteEquipo:h}=Re(),{isMobile:b}=da(),{canEdit:C}=Pe(),f=C("equipos"),[w,R]=c.useState(null),[N,r]=c.useState(!1),[l,n]=c.useState(!1),[A,s]=c.useState(null),[i,v]=c.useState(!1),[u,z]=c.useState(null),F=o=>{R(o),r(!0)},M=async o=>{await S(o)},P=async o=>{const{id:g,...I}=o;await k(g,I),z(null),v(!1)},U=async o=>{s(o),n(!0)},_=()=>{z(null),v(!0)},K=o=>{z(o),v(!0)},Y=async()=>{A!==null&&(await h(A),s(null)),n(!1)};if(y)return b?e.jsx("div",{className:"flex h-screen flex-col bg-background p-4",children:e.jsx("div",{className:"space-y-2",children:Array.from({length:6}).map((o,g)=>e.jsx(H,{className:"p-3",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(V,{className:"h-10 w-10 rounded-lg"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx(V,{className:"h-4 w-24"}),e.jsx(V,{className:"h-3 w-32"})]})]})},g))})}):e.jsx(we,{title:"Gestión de Equipos",children:e.jsxs("div",{className:"space-y-6 lg:space-y-8",children:[e.jsx("section",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:Array.from({length:3}).map((o,g)=>e.jsx(H,{children:e.jsxs(G,{className:"pb-3",children:[e.jsx(V,{className:"h-4 w-24"}),e.jsx(V,{className:"h-10 w-16"})]})},g))}),e.jsxs(H,{children:[e.jsxs(G,{children:[e.jsx(V,{className:"h-6 w-48"}),e.jsx(V,{className:"h-4 w-64"})]}),e.jsx(ye,{children:e.jsx("div",{className:"space-y-3",children:Array.from({length:5}).map((o,g)=>e.jsx(V,{className:"h-16 w-full"},g))})})]})]})});const a=t.equipos.filter(o=>o.activo).length,j=t.equipos.filter(o=>!o.activo).length;return b?e.jsxs(e.Fragment,{children:[e.jsx(Ea,{equipos:t.equipos,onVerDetalle:F,onEdit:K,onDelete:U,onAdd:_}),e.jsx(Me,{ficha:w||"",open:N,onOpenChange:r}),i&&e.jsx(je,{equipo:u||void 0,onSave:u?P:M}),e.jsx(Ce,{open:l,onOpenChange:n,onConfirm:Y,title:"¿Eliminar equipo?",description:"Esta acción no se puede deshacer. El equipo será eliminado permanentemente."})]}):e.jsxs(we,{title:"Gestión de Equipos",children:[e.jsxs("div",{className:"space-y-6 lg:space-y-8",children:[e.jsxs("section",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3",children:[e.jsxs(H,{className:"group relative overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-xl border-l-4 border-l-primary sm:col-span-2 lg:col-span-1",children:[e.jsx("div",{className:"absolute right-0 top-0 h-full w-24 bg-primary/5 transform skew-x-12 translate-x-8"}),e.jsxs(G,{className:"relative pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-sm font-medium",children:"Total de Equipos"}),e.jsx("div",{className:"rounded-full bg-primary/10 p-2 transition-transform group-hover:scale-110",children:e.jsx(ae,{className:"h-5 w-5 text-primary"})})]}),e.jsx(W,{className:"text-4xl font-bold tracking-tight text-primary",children:t.equipos.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Maquinaria registrada"})]})]}),e.jsxs(H,{className:"group relative overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-xl border-l-4 border-l-emerald-500 sm:col-span-1",children:[e.jsx("div",{className:"absolute right-0 top-0 h-full w-24 bg-emerald-500/5 transform skew-x-12 translate-x-8"}),e.jsxs(G,{className:"relative pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-sm font-medium",children:"Equipos Activos"}),e.jsx("div",{className:"rounded-full bg-emerald-500/10 p-2 transition-transform group-hover:scale-110",children:e.jsx(va,{className:"h-5 w-5 text-emerald-600"})})]}),e.jsx(W,{className:"text-4xl font-bold tracking-tight text-emerald-600",children:a}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"En operación"})]})]}),e.jsxs(H,{className:"group relative overflow-hidden transition-all duration-300 hover:scale-105 hover:shadow-xl border-l-4 border-l-amber-500 sm:col-span-1",children:[e.jsx("div",{className:"absolute right-0 top-0 h-full w-24 bg-amber-500/5 transform skew-x-12 translate-x-8"}),e.jsxs(G,{className:"relative pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(J,{className:"text-sm font-medium",children:"Equipos Inactivos"}),e.jsx("div",{className:"rounded-full bg-amber-500/10 p-2 transition-transform group-hover:scale-110",children:e.jsx(Ye,{className:"h-5 w-5 text-amber-600"})})]}),e.jsx(W,{className:"text-4xl font-bold tracking-tight text-amber-600",children:j}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Fuera de servicio"})]})]})]}),e.jsxs(H,{className:"overflow-hidden shadow-lg border-t-4 border-t-primary/30",children:[e.jsx(G,{className:"bg-gradient-to-r from-primary/5 via-transparent to-transparent",children:e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs(W,{className:"flex items-center gap-2.5 text-xl font-bold tracking-tight",children:[e.jsx("div",{className:"rounded-lg bg-primary/10 p-2",children:e.jsx(ae,{className:"h-5 w-5 text-primary"})}),"Catálogo de Equipos y Maquinaria"]}),e.jsx(J,{className:"text-sm",children:"Administra tu inventario completo de equipos, maquinaria y vehículos"})]}),f?e.jsx(je,{onSave:M}):e.jsx(oe,{children:e.jsxs(ce,{children:[e.jsx(de,{asChild:!0,children:e.jsxs(p,{variant:"outline",disabled:!0,className:"gap-2 opacity-50",children:[e.jsx(se,{className:"h-4 w-4"}),"Agregar Equipo"]})}),e.jsx(me,{children:e.jsx("p",{children:"Solo administradores pueden agregar equipos"})})]})})]})}),e.jsx(ye,{className:"px-0 sm:px-6 pb-6",children:e.jsx(Sa,{equipos:t.equipos,onEdit:P,onDelete:U,onVerDetalle:F})})]}),e.jsx(Me,{ficha:w,open:N,onOpenChange:r})]}),e.jsx(Ce,{open:l,onOpenChange:n,onConfirm:Y,title:"Eliminar equipo",description:"¿Está seguro de que desea eliminar este equipo? Esta acción no se puede deshacer.",confirmText:"Eliminar",cancelText:"Cancelar",variant:"destructive"})]})}export{hs as default};
