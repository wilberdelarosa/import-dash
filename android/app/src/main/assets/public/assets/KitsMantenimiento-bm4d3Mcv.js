import{r,j as e,X as Be}from"./index-C_D-5Bfv.js";import{L as Q,P as B,D as Y,n as Oe,o as G,p as ee,q as se,F as ae,G as ie,g as m,j as x,h as j,k as g,t as te,_ as Re,W as re,l as ce,B as f,s as le}from"./card-BIr-PJK2.js";import{u as He}from"./useKits-BJbO5bSf.js";import{B as o}from"./index-BtotK06U.js";import{I as h}from"./input-DSUZcGci.js";import{L as l}from"./label-CqFCS6R-.js";import{T as ne}from"./textarea-BSj91dWz.js";import{S as oe}from"./switch-B03PpzBD.js";import{S as de,a as me,b as xe,c as he,d as M}from"./select-3Jn5ARjr.js";import{T as Ve,a as $e,b as ue,c as y,d as Ue,e as S}from"./table-CQA1OK80.js";import{C as je}from"./chevron-right-fj5H7AOZ.js";import{P as O}from"./plus-Cjn5SSed.js";import{L as ge,F as qe}from"./layers-DNNiWFAp.js";import{P as pe}from"./pencil-CnmjDfEJ.js";const We=["Filtro","Aceite","Lubricante","Repuesto","Consumible","Otro"];function ns(){const{kits:n,loading:ve,createKit:fe,updateKit:Ne,deleteKit:be,createPieza:Ce,updatePieza:we,deletePieza:ye}=He(),[Se,N]=r.useState(!1),[Pe,b]=r.useState(!1),[P,R]=r.useState(null),[F,H]=r.useState(null),[V,D]=r.useState(null),[k,$]=r.useState("index"),[z,U]=r.useState(null),[K,Fe]=r.useState(""),[_,ze]=r.useState("todos"),[T,Ke]=r.useState("todos"),[E,_e]=r.useState(!1);r.useMemo(()=>{const s={};return n.forEach(a=>{const t=a.marca||"Sin marca";s[t]||(s[t]=[]),s[t].push(a)}),s},[n]);const q=r.useMemo(()=>{const s={};return n.forEach(a=>{const t=a.categoria||"Sin categoría";s[t]||(s[t]=[]),s[t].push(a)}),s},[n]),C=r.useMemo(()=>{let s=n;if(K){const a=K.toLowerCase();s=s.filter(t=>{var w;const I=t.nombre.toLowerCase().includes(a),v=t.codigo.toLowerCase().includes(a),L=(w=t.piezas)==null?void 0:w.some(J=>J.numero_parte.toLowerCase().includes(a)||J.descripcion.toLowerCase().includes(a));return I||v||L})}return _!=="todos"&&(s=s.filter(a=>(a.categoria||"Sin categoría")===_)),T!=="todos"&&(s=s.filter(a=>(a.marca||"Sin marca")===T)),E||(s=s.filter(a=>a.activo)),s},[n,K,_,T,E]),Te=r.useMemo(()=>{const s={};return C.forEach(a=>{const t=a.marca||"Sin marca";s[t]||(s[t]=[]),s[t].push(a)}),s},[C]),W=r.useMemo(()=>{const s=new Set(n.map(a=>a.categoria||"Sin categoría"));return Array.from(s).sort()},[n]),X=r.useMemo(()=>{const s=new Set(n.map(a=>a.marca||"Sin marca"));return Array.from(s).sort()},[n]),d=r.useMemo(()=>({total:n.length,activos:n.filter(s=>s.activo).length,inactivos:n.filter(s=>!s.activo).length,totalPiezas:n.reduce((s,a)=>{var t;return s+(((t=a.piezas)==null?void 0:t.length)||0)},0),porCategoria:Object.entries(q).map(([s,a])=>({categoria:s,cantidad:a.length})).sort((s,a)=>a.cantidad-s.cantidad)}),[n,q]),[c,u]=r.useState({nombre:"",codigo:"",descripcion:"",marca:"",modelo_aplicable:"",categoria:"",activo:!0}),[i,p]=r.useState({numero_parte:"",descripcion:"",tipo:"",cantidad:"1",unidad:"unidad",notas:""}),Me=async()=>{if(!(!c.nombre||!c.codigo))try{P?await Ne(P.id,c):await fe(c),N(!1),Z()}catch(s){console.error(s)}},De=async()=>{if(!(!i.numero_parte||!i.descripcion||!i.tipo||!V))try{const s={kit_id:V,numero_parte:i.numero_parte,descripcion:i.descripcion,tipo:i.tipo,cantidad:parseInt(i.cantidad)||1,unidad:i.unidad||"unidad",notas:i.notas||null};F?await we(F.id,s):await Ce(s),b(!1),A()}catch(s){console.error(s)}},Z=()=>{u({nombre:"",codigo:"",descripcion:"",marca:"",modelo_aplicable:"",categoria:"",activo:!0}),R(null)},A=()=>{p({numero_parte:"",descripcion:"",tipo:"",cantidad:"1",unidad:"unidad",notas:""}),H(null),D(null)},ke=s=>{R(s),u({nombre:s.nombre,codigo:s.codigo,descripcion:s.descripcion||"",marca:s.marca||"",modelo_aplicable:s.modelo_aplicable||"",categoria:s.categoria||"",activo:s.activo}),N(!0)},Ee=s=>{H(s),D(s.kit_id),p({numero_parte:s.numero_parte,descripcion:s.descripcion,tipo:s.tipo,cantidad:s.cantidad.toString(),unidad:s.unidad,notas:s.notas||""}),b(!0)},Ae=async s=>{confirm("¿Eliminar este kit? Se eliminarán todas sus piezas.")&&await be(s)},Ie=async s=>{confirm("¿Eliminar esta pieza?")&&await ye(s)},Le=s=>{A(),D(s),b(!0)};return ve?e.jsx(Q,{title:"Kits de Mantenimiento",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):e.jsx(Q,{title:"Kits de Mantenimiento",children:e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-8",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(B,{className:"w-8 h-8"}),"Kits de Mantenimiento"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:k==="index"?"Resumen de kits organizados por marca":z?`Kits de ${z}`:"Gestiona kits con números de parte y repuestos"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[k==="details"&&e.jsxs(o,{variant:"outline",onClick:()=>{$("index"),U(null)},children:[e.jsx(je,{className:"w-4 h-4 mr-2 rotate-180"}),"Volver al índice"]}),e.jsxs(Y,{open:Se,onOpenChange:s=>{N(s),s||Z()},children:[e.jsx(Oe,{asChild:!0,children:e.jsxs(o,{children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Nuevo Kit"]})}),e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsx(se,{children:P?"Editar Kit":"Crear Kit de Mantenimiento"}),e.jsx(ae,{children:"Define un kit con sus piezas y números de parte"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"nombre",children:"Nombre del Kit *"}),e.jsx(h,{id:"nombre",value:c.nombre,onChange:s=>u({...c,nombre:s.target.value}),placeholder:"Kit PM2 CAT 320"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"codigo",children:"Código *"}),e.jsx(h,{id:"codigo",value:c.codigo,onChange:s=>u({...c,codigo:s.target.value}),placeholder:"KIT-PM2-320"})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"marca",children:"Marca"}),e.jsx(h,{id:"marca",value:c.marca,onChange:s=>u({...c,marca:s.target.value}),placeholder:"Caterpillar"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"modelo_aplicable",children:"Modelo"}),e.jsx(h,{id:"modelo_aplicable",value:c.modelo_aplicable,onChange:s=>u({...c,modelo_aplicable:s.target.value}),placeholder:"320 GC"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"categoria",children:"Categoría"}),e.jsx(h,{id:"categoria",value:c.categoria,onChange:s=>u({...c,categoria:s.target.value}),placeholder:"Excavadora"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"descripcion",children:"Descripción"}),e.jsx(ne,{id:"descripcion",value:c.descripcion,onChange:s=>u({...c,descripcion:s.target.value}),placeholder:"Descripción del kit..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(oe,{checked:c.activo,onCheckedChange:s=>u({...c,activo:s})}),e.jsx(l,{children:"Kit activo"})]})]}),e.jsxs(ie,{children:[e.jsx(o,{variant:"outline",onClick:()=>N(!1),children:"Cancelar"}),e.jsx(o,{onClick:Me,children:P?"Actualizar":"Crear"})]})]})]})]})]}),n.length===0?e.jsx(m,{children:e.jsxs(x,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(B,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"No hay kits de mantenimiento"}),e.jsxs(o,{onClick:()=>N(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Crear Primer Kit"]})]})}):k==="index"?e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(te,{className:"w-5 h-5"}),"Búsqueda y Filtros"]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(l,{htmlFor:"search-kits",children:"Buscar kits"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(h,{id:"search-kits",type:"search",placeholder:"Buscar por nombre, código, piezas...",className:"pl-8",value:K,onChange:s=>Fe(s.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"filtro-categoria-kit",children:"Categoría"}),e.jsxs(de,{value:_,onValueChange:ze,children:[e.jsx(me,{id:"filtro-categoria-kit",children:e.jsx(xe,{placeholder:"Todas las categorías"})}),e.jsxs(he,{children:[e.jsx(M,{value:"todos",children:"Todas las categorías"}),W.map(s=>e.jsx(M,{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"filtro-marca-kit",children:"Marca"}),e.jsxs(de,{value:T,onValueChange:Ke,children:[e.jsx(me,{id:"filtro-marca-kit",children:e.jsx(xe,{placeholder:"Todas las marcas"})}),e.jsxs(he,{children:[e.jsx(M,{value:"todos",children:"Todas las marcas"}),X.map(s=>e.jsx(M,{value:s,children:s},s))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[e.jsx(oe,{id:"mostrar-inactivos-kits",checked:E,onCheckedChange:_e}),e.jsx(l,{htmlFor:"mostrar-inactivos-kits",className:"cursor-pointer",children:"Mostrar kits inactivos"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-5",children:[e.jsxs(m,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Re,{className:"w-4 h-4 text-blue-500"}),"Total Kits"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:C.length!==d.total&&`${C.length} filtrados`})]})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(B,{className:"w-4 h-4 text-green-500"}),"Activos"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:d.activos}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(d.activos/d.total*100).toFixed(1),"% del total"]})]})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Be,{className:"w-4 h-4 text-gray-500"}),"Inactivos"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:d.inactivos}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(d.inactivos/d.total*100).toFixed(1),"% del total"]})]})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(re,{className:"w-4 h-4 text-orange-500"}),"Total Piezas"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:d.totalPiezas}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["En ",d.total," kits"]})]})]}),e.jsxs(m,{children:[e.jsx(j,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ge,{className:"w-4 h-4 text-purple-500"}),"Categorías"]})}),e.jsxs(x,{children:[e.jsx("div",{className:"text-2xl font-bold",children:W.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[X.length," marcas"]})]})]})]}),e.jsxs(m,{children:[e.jsxs(j,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ge,{className:"w-6 h-6"}),"Resumen de Kits por Marca"]}),e.jsx(ce,{children:"Haz clic en una marca para ver sus kits detallados"})]}),e.jsx(x,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Object.entries(Te).map(([s,a])=>{const t=a.filter(v=>v.activo).length,I=a.reduce((v,L)=>{var w;return v+(((w=L.piezas)==null?void 0:w.length)||0)},0);return e.jsxs(m,{className:"group cursor-pointer transition-all duration-300 hover:shadow-xl hover:scale-105 hover:border-primary/50",onClick:()=>{U(s),$("details")},children:[e.jsx(j,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2 text-lg",children:[e.jsx(qe,{className:"w-5 h-5 text-primary transition-transform group-hover:scale-110"}),s]}),e.jsx(je,{className:"w-5 h-5 text-muted-foreground transition-transform group-hover:translate-x-1"})]})}),e.jsx(x,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Total kits:"}),e.jsx(f,{variant:"secondary",className:"group-hover:bg-primary/20",children:a.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Activos:"}),e.jsx(f,{variant:"default",className:"group-hover:bg-primary",children:t})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Total piezas:"}),e.jsx(f,{variant:"outline",className:"group-hover:border-primary",children:I})]}),e.jsx("div",{className:"pt-2 border-t mt-3",children:e.jsxs("p",{className:"text-xs text-muted-foreground group-hover:text-foreground/80 transition-colors line-clamp-2",children:[a.slice(0,3).map(v=>v.codigo).join(", "),a.length>3&&"..."]})})]})})]},s)})})})]})]}):e.jsx("div",{className:"grid gap-6",children:C.filter(s=>!z||(s.marca||"Sin marca")===z).map(s=>e.jsxs(m,{children:[e.jsx(j,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[s.nombre,e.jsx(f,{variant:"secondary",children:s.codigo}),!s.activo&&e.jsx(f,{variant:"outline",children:"Inactivo"})]}),e.jsxs(ce,{children:[s.marca&&`${s.marca}`,s.modelo_aplicable&&` • ${s.modelo_aplicable}`,s.categoria&&` • ${s.categoria}`]}),s.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:s.descripcion})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>ke(s),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>Ae(s.id),children:e.jsx(le,{className:"w-4 h-4"})})]})]})}),e.jsxs(x,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(re,{className:"w-5 h-5"}),"Piezas del Kit"]}),e.jsxs(o,{size:"sm",onClick:()=>Le(s.id),children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),"Agregar Pieza"]})]}),s.piezas.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay piezas en este kit"}):e.jsxs(Ve,{children:[e.jsx($e,{children:e.jsxs(ue,{children:[e.jsx(y,{children:"N° Parte"}),e.jsx(y,{children:"Descripción"}),e.jsx(y,{children:"Tipo"}),e.jsx(y,{children:"Cantidad"}),e.jsx(y,{className:"text-right",children:"Acciones"})]})}),e.jsx(Ue,{children:s.piezas.map(a=>e.jsxs(ue,{children:[e.jsx(S,{children:e.jsx("code",{className:"text-xs bg-muted px-1 py-0.5 rounded",children:a.numero_parte})}),e.jsx(S,{children:a.descripcion}),e.jsx(S,{children:e.jsx(f,{variant:"outline",children:a.tipo})}),e.jsxs(S,{children:[a.cantidad," ",a.unidad]}),e.jsxs(S,{className:"text-right",children:[e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>Ee(a),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(o,{size:"sm",variant:"ghost",onClick:()=>Ie(a.id),children:e.jsx(le,{className:"w-4 h-4"})})]})]},a.id))})]})]})]},s.id))}),e.jsx(Y,{open:Pe,onOpenChange:s=>{b(s),s||A()},children:e.jsxs(G,{className:"max-w-2xl",children:[e.jsxs(ee,{children:[e.jsx(se,{children:F?"Editar Pieza":"Nueva Pieza"}),e.jsx(ae,{children:"Agrega un repuesto o pieza al kit"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"numero_parte",children:"Número de Parte *"}),e.jsx(h,{id:"numero_parte",value:i.numero_parte,onChange:s=>p({...i,numero_parte:s.target.value}),placeholder:"322-3155"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"tipo",children:"Tipo *"}),e.jsxs("select",{id:"tipo",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:i.tipo,onChange:s=>p({...i,tipo:s.target.value}),children:[e.jsx("option",{value:"",children:"Seleccionar..."}),We.map(s=>e.jsx("option",{value:s,children:s},s))]})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"descripcion_pieza",children:"Descripción *"}),e.jsx(h,{id:"descripcion_pieza",value:i.descripcion,onChange:s=>p({...i,descripcion:s.target.value}),placeholder:"Filtro de aceite de motor"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(l,{htmlFor:"cantidad",children:"Cantidad *"}),e.jsx(h,{id:"cantidad",type:"number",value:i.cantidad,onChange:s=>p({...i,cantidad:s.target.value}),placeholder:"1"})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"unidad",children:"Unidad"}),e.jsx(h,{id:"unidad",value:i.unidad,onChange:s=>p({...i,unidad:s.target.value}),placeholder:"unidad"})]})]}),e.jsxs("div",{children:[e.jsx(l,{htmlFor:"notas_pieza",children:"Notas"}),e.jsx(ne,{id:"notas_pieza",value:i.notas,onChange:s=>p({...i,notas:s.target.value}),placeholder:"Notas adicionales..."})]})]}),e.jsxs(ie,{children:[e.jsx(o,{variant:"outline",onClick:()=>b(!1),children:"Cancelar"}),e.jsx(o,{onClick:De,children:F?"Actualizar":"Agregar"})]})]})})]})})}export{ns as default};
