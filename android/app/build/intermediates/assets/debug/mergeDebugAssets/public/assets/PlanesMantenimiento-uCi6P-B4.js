import{l as Pa,r,j as e,X as Ee}from"./index-C_D-5Bfv.js";import{L as Ae,A as Ke,D as X,n as Ma,o as Y,p as Z,q as J,F as W,G,g as x,j as u,h as p,k as g,t as Oe,_ as Sa,l as xe,B as w,P as $e,s as Le}from"./card-BIr-PJK2.js";import{u as Ia}from"./usePlanes-D-d8Ujwc.js";import{u as ka}from"./useKits-BJbO5bSf.js";import{B as l}from"./index-BtotK06U.js";import{I as v}from"./input-DSUZcGci.js";import{L as o}from"./label-CqFCS6R-.js";import{T as ue}from"./textarea-BSj91dWz.js";import{S as Re}from"./switch-B03PpzBD.js";import{S as ee,a as ae,b as se,c as re,d as P}from"./select-3Jn5ARjr.js";import{T as Fa,a as Da,b as Ve,c as M,d as _a,e as S}from"./table-CQA1OK80.js";import{a as Ta,g as za}from"./caterpillarMaintenance-Dg_xV4Xi.js";import{C as Be}from"./chevron-right-fj5H7AOZ.js";import{P as te}from"./plus-Cjn5SSed.js";import{S as Ea}from"./sparkles-CBL8q4dG.js";import{C as He}from"./clock-Chbx4_2l.js";import{F as qe,L as Aa}from"./layers-DNNiWFAp.js";import{P as Ue}from"./pencil-CnmjDfEJ.js";function as(){const{toast:I}=Pa(),{planes:c,loading:Qe,createPlan:je,updatePlan:Xe,deletePlan:Ye,createIntervalo:pe,updateIntervalo:Ze,deleteIntervalo:Je,linkKitToInterval:ge,unlinkKitFromInterval:We}=Ia(),{kits:z,createKit:Ge,createPieza:ea}=ka(),[aa,k]=r.useState(!1),[sa,F]=r.useState(!1),[ra,E]=r.useState(!1),[ta,A]=r.useState(!1),[K,ve]=r.useState(null),[O,fe]=r.useState(null),[Ne,ie]=r.useState(null),[d,le]=r.useState(null),[$,L]=r.useState(""),[m,oe]=r.useState(""),[be,Ce]=r.useState(!1),ia=r.useMemo(()=>Ta(),[]),[ne,we]=r.useState("index"),[R,ye]=r.useState(null),[V,la]=r.useState(""),[B,oa]=r.useState("todos"),[H,na]=r.useState("todos"),[ce,ca]=r.useState(!1),de=r.useMemo(()=>{const a=z.filter(s=>s.activo);return d?a.filter(s=>!(d.planMarca&&s.marca&&s.marca!==d.planMarca||d.planModelo&&s.modelo_aplicable&&s.modelo_aplicable!==d.planModelo)):a},[z,d]),Pe=r.useMemo(()=>{const a={};return c.forEach(s=>{a[s.marca]||(a[s.marca]=[]),a[s.marca].push(s)}),a},[c]),da=r.useMemo(()=>{const a={};return z.forEach(s=>{const t=s.marca||"Sin marca";a[t]||(a[t]=[]),a[t].push(s)}),a},[z]),D=r.useMemo(()=>{let a=c;if(V){const s=V.toLowerCase();a=a.filter(t=>{var h;return t.nombre.toLowerCase().includes(s)||t.marca.toLowerCase().includes(s)||((h=t.modelo)==null?void 0:h.toLowerCase().includes(s))||t.categoria.toLowerCase().includes(s)})}return B!=="todos"&&(a=a.filter(s=>s.marca===B)),H!=="todos"&&(a=a.filter(s=>s.categoria===H)),ce||(a=a.filter(s=>s.activo)),a},[c,V,B,H,ce]),ma=r.useMemo(()=>{const a={};return D.forEach(s=>{a[s.marca]||(a[s.marca]=[]),a[s.marca].push(s)}),a},[D]),Me=r.useMemo(()=>{const a=new Set(c.map(s=>s.marca));return Array.from(a).sort()},[c]),Se=r.useMemo(()=>{const a=new Set(c.map(s=>s.categoria));return Array.from(a).sort()},[c]),f=r.useMemo(()=>({total:c.length,activos:c.filter(a=>a.activo).length,inactivos:c.filter(a=>!a.activo).length,porMarca:Object.entries(Pe).map(([a,s])=>({marca:a,cantidad:s.length})).sort((a,s)=>s.cantidad-a.cantidad)}),[c,Pe]),[n,N]=r.useState({nombre:"",marca:"",modelo:"",categoria:"",descripcion:"",activo:!0}),[i,b]=r.useState({codigo:"",nombre:"",horas_intervalo:"",descripcion:"",tareas:"",orden:""}),ha=async()=>{if(!(!n.nombre||!n.marca||!n.categoria))try{K?await Xe(K.id,n):await je(n),k(!1),Ie()}catch(a){console.error(a)}},xa=async()=>{if(!(!i.codigo||!i.nombre||!i.horas_intervalo||!Ne))try{const a=i.tareas.split(`
`).filter(t=>t.trim()),s={plan_id:Ne,codigo:i.codigo,nombre:i.nombre,horas_intervalo:parseInt(i.horas_intervalo),descripcion:i.descripcion||null,tareas:a,orden:parseInt(i.orden)||0};O?await Ze(O.id,s):await pe(s),F(!1),me()}catch(a){console.error(a)}},Ie=()=>{N({nombre:"",marca:"",modelo:"",categoria:"",descripcion:"",activo:!0}),ve(null)},me=()=>{b({codigo:"",nombre:"",horas_intervalo:"",descripcion:"",tareas:"",orden:""}),fe(null),ie(null)},ua=a=>{ve(a),N({nombre:a.nombre,marca:a.marca,modelo:a.modelo||"",categoria:a.categoria,descripcion:a.descripcion||"",activo:a.activo}),k(!0)},ja=a=>{fe(a),ie(a.plan_id),b({codigo:a.codigo,nombre:a.nombre,horas_intervalo:a.horas_intervalo.toString(),descripcion:a.descripcion||"",tareas:a.tareas.join(`
`),orden:a.orden.toString()}),F(!0)},pa=async a=>{confirm("Eliminar este plan? Se eliminaran todos sus intervalos.")&&await Ye(a)},ga=async a=>{confirm("Eliminar este intervalo?")&&await Je(a)},va=(a,s)=>{le({planMarca:a.marca,planModelo:a.modelo,intervalo:s}),L(""),E(!0)},fa=async()=>{if(!(!d||!$))try{await ge(d.intervalo.id,Number($)),E(!1),le(null),L("")}catch(a){console.error(a)}},Na=async a=>{try{await We(a)}catch(s){console.error(s)}},ba=async()=>{var t,h,C,y,q,U;if(!m){I({title:"Selecciona un modelo",description:"Elige un modelo Caterpillar antes de importar la plantilla.",variant:"destructive"});return}if(c.find(_=>(_.modelo??"").toLowerCase()===m.toLowerCase())){I({title:"Plan ya registrado",description:`Ya existe un plan para ${m}. Eliminalo o editalo antes de importar nuevamente.`,variant:"destructive"});return}const s=za(m);if(!s){I({title:"Plantilla no disponible",description:"No se encontro informacion para el modelo seleccionado.",variant:"destructive"});return}Ce(!0);try{const _={nombre:`Plan ${((t=s.modelo)==null?void 0:t.modelo)??m}`,marca:"Caterpillar",modelo:((h=s.modelo)==null?void 0:h.modelo)??m,categoria:((C=s.modelo)==null?void 0:C.categoria)??"Maquinaria",descripcion:((y=s.modelo)==null?void 0:y.notas)??`Plan automatico basado en intervalos Caterpillar para ${m}`,activo:!0},ke=await je(_);if(!ke)throw new Error("No se pudo crear el plan");const Fe=Number(ke.id);if(Number.isNaN(Fe))throw new Error("El identificador del plan generado no es numerico");for(const j of s.intervalos){const wa=s.tareasPorIntervalo[j.codigo]??[],De=await pe({plan_id:Fe,codigo:j.codigo,nombre:j.nombre,horas_intervalo:j.horas_intervalo,descripcion:j.descripcion,tareas:wa,orden:j.horas_intervalo}),_e=s.piezasPorIntervalo[j.codigo]??[];if(!De)continue;const Te=Number(De.id);if(Number.isNaN(Te)||_e.length===0)continue;const Q=((q=s.modelo)==null?void 0:q.modelo)??m,ya=`CAT-${Q}-${j.codigo}`.toUpperCase(),ze=await Ge({nombre:`Kit ${j.codigo} - ${Q}`,codigo:ya.replace(/[^A-Z0-9]+/g,"-"),descripcion:`Kit Caterpillar ${j.codigo} para ${Q}`,marca:"Caterpillar",modelo_aplicable:Q,categoria:((U=s.modelo)==null?void 0:U.categoria)??"Maquinaria",activo:!0});if(!ze)continue;const he=Number(ze.id);if(!Number.isNaN(he)){for(const T of _e)await ea({kit_id:he,numero_parte:T.pieza.numero_parte,descripcion:T.pieza.descripcion,tipo:T.pieza.tipo||"Repuesto",cantidad:Number(T.cantidad??0),unidad:"pieza",notas:T.notas});await ge(Te,he)}}I({title:"Plan importado",description:`Se genero el plan y kits para ${m}.`}),A(!1),oe("")}catch(_){console.error(_),I({title:"Error al importar",description:"Ocurrio un problema creando el plan y los kits.",variant:"destructive"})}finally{Ce(!1)}},Ca=a=>{me(),ie(a),F(!0)};return Qe?e.jsx(Ae,{title:"Planes de Mantenimiento",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary"})})}):e.jsx(Ae,{title:"Planes de Mantenimiento",children:e.jsxs("div",{className:"container mx-auto py-8 px-4",children:[e.jsxs("div",{className:"flex items-start justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-3xl font-bold flex items-center gap-2",children:[e.jsx(Ke,{className:"w-8 h-8"}),"Planes de Mantenimiento"]}),e.jsx("p",{className:"text-muted-foreground mt-1",children:ne==="index"?"Resumen de planes y kits organizados por marca":R?`Planes de ${R}`:"Define planes con intervalos PM para cada marca y modelo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[ne==="details"&&e.jsxs(l,{variant:"outline",onClick:()=>{we("index"),ye(null)},children:[e.jsx(Be,{className:"w-4 h-4 mr-2 rotate-180"}),"Volver al índice"]}),e.jsxs(X,{open:aa,onOpenChange:a=>{k(a),a||Ie()},children:[e.jsx(Ma,{asChild:!0,children:e.jsxs(l,{children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Nuevo Plan"]})}),e.jsxs(Y,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsx(J,{children:K?"Editar Plan":"Crear Plan de Mantenimiento"}),e.jsx(W,{children:"Define un plan reutilizable para equipos"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nombre",children:"Nombre del Plan *"}),e.jsx(v,{id:"nombre",value:n.nombre,onChange:a=>N({...n,nombre:a.target.value}),placeholder:"Plan CAT 320 Standard"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"marca",children:"Marca *"}),e.jsx(v,{id:"marca",value:n.marca,onChange:a=>N({...n,marca:a.target.value}),placeholder:"Caterpillar"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"modelo",children:"Modelo"}),e.jsx(v,{id:"modelo",value:n.modelo,onChange:a=>N({...n,modelo:a.target.value}),placeholder:"320 GC"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"categoria",children:"Categoria *"}),e.jsx(v,{id:"categoria",value:n.categoria,onChange:a=>N({...n,categoria:a.target.value}),placeholder:"Excavadora"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"descripcion",children:"Descripcion"}),e.jsx(ue,{id:"descripcion",value:n.descripcion,onChange:a=>N({...n,descripcion:a.target.value}),placeholder:"Descripcion del plan..."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Re,{checked:n.activo,onCheckedChange:a=>N({...n,activo:a})}),e.jsx(o,{children:"Plan activo"})]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>k(!1),children:"Cancelar"}),e.jsx(l,{onClick:ha,children:K?"Actualizar":"Crear"})]})]})]}),e.jsxs(l,{variant:"outline",className:"gap-2",onClick:()=>A(!0),children:[e.jsx(Ea,{className:"w-4 h-4"}),"Plantilla Caterpillar"]})]})]}),c.length===0?e.jsx(x,{children:e.jsxs(u,{className:"flex flex-col items-center justify-center py-12",children:[e.jsx(Ke,{className:"w-16 h-16 text-muted-foreground mb-4"}),e.jsx("p",{className:"text-lg text-muted-foreground mb-4",children:"No hay planes de mantenimiento"}),e.jsxs(l,{onClick:()=>k(!0),children:[e.jsx(te,{className:"w-4 h-4 mr-2"}),"Crear Primer Plan"]})]})}):ne==="index"?e.jsxs("div",{className:"grid gap-6",children:[e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Oe,{className:"w-5 h-5"}),"Búsqueda y Filtros"]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx(o,{htmlFor:"search",children:"Buscar planes"}),e.jsxs("div",{className:"relative",children:[e.jsx(Oe,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),e.jsx(v,{id:"search",type:"search",placeholder:"Buscar por nombre, marca, modelo...",className:"pl-8",value:V,onChange:a=>la(a.target.value)})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"filtro-marca",children:"Marca"}),e.jsxs(ee,{value:B,onValueChange:oa,children:[e.jsx(ae,{id:"filtro-marca",children:e.jsx(se,{placeholder:"Todas las marcas"})}),e.jsxs(re,{children:[e.jsx(P,{value:"todos",children:"Todas las marcas"}),Me.map(a=>e.jsx(P,{value:a,children:a},a))]})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"filtro-categoria",children:"Categoría"}),e.jsxs(ee,{value:H,onValueChange:na,children:[e.jsx(ae,{id:"filtro-categoria",children:e.jsx(se,{placeholder:"Todas las categorías"})}),e.jsxs(re,{children:[e.jsx(P,{value:"todos",children:"Todas las categorías"}),Se.map(a=>e.jsx(P,{value:a,children:a},a))]})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 mt-4 pt-4 border-t",children:[e.jsx(Re,{id:"mostrar-inactivos",checked:ce,onCheckedChange:ca}),e.jsx(o,{htmlFor:"mostrar-inactivos",className:"cursor-pointer",children:"Mostrar planes inactivos"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-4",children:[e.jsxs(x,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Sa,{className:"w-4 h-4 text-blue-500"}),"Total Planes"]})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:f.total}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:D.length!==f.total&&`${D.length} filtrados`})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(He,{className:"w-4 h-4 text-green-500"}),"Activos"]})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f.activos}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(f.activos/f.total*100).toFixed(1),"% del total"]})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-gray-500"}),"Inactivos"]})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-gray-600",children:f.inactivos}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[(f.inactivos/f.total*100).toFixed(1),"% del total"]})]})]}),e.jsxs(x,{children:[e.jsx(p,{className:"pb-3",children:e.jsxs(g,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(qe,{className:"w-4 h-4 text-purple-500"}),"Marcas"]})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:Me.length}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[Se.length," categorías"]})]})]})]}),e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(Aa,{className:"w-6 h-6"}),"Resumen de Planes por Marca"]}),e.jsx(xe,{children:"Haz clic en una marca para ver sus planes detallados"})]}),e.jsx(u,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Object.entries(ma).map(([a,s])=>{const t=s.reduce((C,y)=>C+y.intervalos.length,0),h=s.reduce((C,y)=>C+y.intervalos.reduce((q,U)=>q+U.kits.length,0),0);return e.jsxs(x,{className:"group cursor-pointer transition-all duration-300 hover:shadow-xl hover:scale-105 hover:border-primary/50",onClick:()=>{ye(a),we("details")},children:[e.jsx(p,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2 text-lg",children:[e.jsx(qe,{className:"w-5 h-5 text-primary transition-transform group-hover:scale-110"}),a]}),e.jsx(Be,{className:"w-5 h-5 text-muted-foreground transition-transform group-hover:translate-x-1"})]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Planes:"}),e.jsx(w,{variant:"secondary",className:"group-hover:bg-primary/20",children:s.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Intervalos PM:"}),e.jsx(w,{variant:"outline",className:"group-hover:border-primary",children:t})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Kits asociados:"}),e.jsx(w,{variant:"outline",className:"group-hover:border-primary",children:h})]}),e.jsx("div",{className:"pt-2 border-t mt-3",children:e.jsxs("p",{className:"text-xs text-muted-foreground group-hover:text-foreground/80 transition-colors",children:["Modelos: ",[...new Set(s.map(C=>C.modelo).filter(Boolean))].join(", ")||"Varios"]})})]})})]},a)})})})]}),e.jsxs(x,{children:[e.jsxs(p,{children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx($e,{className:"w-6 h-6"}),"Resumen de Kits por Marca"]}),e.jsx(xe,{children:"Visualización rápida de kits disponibles organizados por marca"})]}),e.jsx(u,{children:e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:Object.entries(da).map(([a,s])=>{const t=s.filter(h=>h.activo).length;return e.jsxs(x,{className:"group transition-all duration-300 hover:shadow-xl hover:scale-105 hover:border-primary/50",children:[e.jsx(p,{className:"pb-3",children:e.jsxs(g,{className:"flex items-center gap-2 text-lg",children:[e.jsx($e,{className:"w-5 h-5 text-primary transition-transform group-hover:scale-110"}),a]})}),e.jsx(u,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground group-hover:text-foreground transition-colors",children:"Total kits:"}),e.jsx(w,{variant:"secondary",className:"group-hover:bg-primary/20",children:s.length})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsx("span",{className:"text-muted-foreground",children:"Activos:"}),e.jsx(w,{variant:"default",children:t})]}),e.jsx("div",{className:"pt-2 border-t mt-3",children:e.jsxs("p",{className:"text-xs text-muted-foreground line-clamp-2",children:[s.slice(0,3).map(h=>h.codigo).join(", "),s.length>3&&"..."]})})]})})]},a)})})})]})]}):e.jsx("div",{className:"grid gap-6",children:D.filter(a=>!R||a.marca===R).map(a=>e.jsxs(x,{children:[e.jsx(p,{children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[a.nombre,!a.activo&&e.jsx(w,{variant:"secondary",children:"Inactivo"})]}),e.jsxs(xe,{children:[a.marca," ",a.modelo&&` ${a.modelo}`,"  ",a.categoria]}),a.descripcion&&e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:a.descripcion})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>ua(a),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>pa(a.id),children:e.jsx(Le,{className:"w-4 h-4"})})]})]})}),e.jsxs(u,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h3",{className:"font-semibold flex items-center gap-2",children:[e.jsx(He,{className:"w-5 h-5"}),"Intervalos de Mantenimiento"]}),e.jsxs(l,{size:"sm",onClick:()=>Ca(a.id),children:[e.jsx(te,{className:"w-4 h-4 mr-1"}),"Agregar Intervalo"]})]}),a.intervalos.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay intervalos definidos"}):e.jsxs(Fa,{children:[e.jsx(Da,{children:e.jsxs(Ve,{children:[e.jsx(M,{children:"Codigo"}),e.jsx(M,{children:"Nombre"}),e.jsx(M,{children:"Horas"}),e.jsx(M,{children:"Tareas"}),e.jsx(M,{children:"Kits asignados"}),e.jsx(M,{className:"text-right",children:"Acciones"})]})}),e.jsx(_a,{children:a.intervalos.sort((s,t)=>s.orden-t.orden).map(s=>e.jsxs(Ve,{children:[e.jsx(S,{children:e.jsx(w,{children:s.codigo})}),e.jsx(S,{children:s.nombre}),e.jsxs(S,{children:[s.horas_intervalo,"h"]}),e.jsx(S,{children:s.tareas.length>0?e.jsxs("span",{className:"text-sm",children:[s.tareas.length," tareas"]}):e.jsx("span",{className:"text-sm text-muted-foreground",children:"Sin tareas"})}),e.jsxs(S,{children:[e.jsx("div",{className:"flex flex-wrap gap-2",children:s.kits.length===0?e.jsx("span",{className:"text-xs text-muted-foreground",children:"Sin kits asociados"}):s.kits.map(t=>e.jsxs("div",{className:"flex items-center gap-1 rounded-full border px-2 py-1 text-xs",children:[e.jsx("span",{className:"font-medium",children:t.kit.codigo}),e.jsx("button",{type:"button",className:"text-muted-foreground transition hover:text-destructive",onClick:()=>Na(t.id),title:"Quitar kit",children:e.jsx(Ee,{className:"h-3 w-3"})})]},t.id))}),e.jsxs(l,{size:"sm",variant:"ghost",className:"mt-2",onClick:()=>va(a,s),children:[e.jsx(te,{className:"mr-1 h-3 w-3"}),"Asignar kit"]})]}),e.jsxs(S,{className:"text-right",children:[e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>ja(s),children:e.jsx(Ue,{className:"w-4 h-4"})}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>ga(s.id),children:e.jsx(Le,{className:"w-4 h-4"})})]})]},s.id))})]})]})]},a.id))}),e.jsx(X,{open:sa,onOpenChange:a=>{F(a),a||me()},children:e.jsxs(Y,{className:"max-w-2xl",children:[e.jsxs(Z,{children:[e.jsx(J,{children:O?"Editar Intervalo":"Nuevo Intervalo"}),e.jsx(W,{children:"Define un intervalo de mantenimiento (PM1, PM2, etc.)"})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"codigo",children:"Codigo *"}),e.jsx(v,{id:"codigo",value:i.codigo,onChange:a=>b({...i,codigo:a.target.value}),placeholder:"PM1"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"horas_intervalo",children:"Horas *"}),e.jsx(v,{id:"horas_intervalo",type:"number",value:i.horas_intervalo,onChange:a=>b({...i,horas_intervalo:a.target.value}),placeholder:"250"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"nombre_intervalo",children:"Nombre *"}),e.jsx(v,{id:"nombre_intervalo",value:i.nombre,onChange:a=>b({...i,nombre:a.target.value}),placeholder:"Servicio basico 250h"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"descripcion_intervalo",children:"Descripcion"}),e.jsx(ue,{id:"descripcion_intervalo",value:i.descripcion,onChange:a=>b({...i,descripcion:a.target.value}),placeholder:"Descripcion del intervalo..."})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"tareas",children:"Tareas (una por linea)"}),e.jsx(ue,{id:"tareas",value:i.tareas,onChange:a=>b({...i,tareas:a.target.value}),placeholder:`Cambio de aceite
Cambio de filtros
Inspeccion general`,rows:5})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"orden",children:"Orden"}),e.jsx(v,{id:"orden",type:"number",value:i.orden,onChange:a=>b({...i,orden:a.target.value}),placeholder:"0"})]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>F(!1),children:"Cancelar"}),e.jsx(l,{onClick:xa,children:O?"Actualizar":"Crear"})]})]})}),e.jsx(X,{open:ra,onOpenChange:a=>{E(a),a||(le(null),L(""))},children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Asignar kit al intervalo"}),e.jsx(W,{children:"Vuelve reutilizable cada PM vinculando un kit predefinido para el intervalo seleccionado."})]}),d&&e.jsxs("div",{className:"space-y-1 rounded-md border bg-muted/30 p-3 text-sm",children:[e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Plan:"})," ",d.planMarca,d.planModelo?` - ${d.planModelo}`:""]}),e.jsxs("p",{children:[e.jsx("span",{className:"font-semibold",children:"Intervalo:"})," ",d.intervalo.codigo," - ",d.intervalo.nombre]})]}),de.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay kits activos que coincidan con la marca o modelo del plan. Crea uno nuevo o activa un kit existente."}):e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"kitSelect",children:"Selecciona un kit"}),e.jsxs(ee,{value:$,onValueChange:L,children:[e.jsx(ae,{id:"kitSelect",children:e.jsx(se,{placeholder:"Elige un kit disponible"})}),e.jsx(re,{children:de.map(a=>e.jsxs(P,{value:String(a.id),children:[a.codigo," - ",a.nombre,a.modelo_aplicable?` (${a.modelo_aplicable})`:""]},a.id))})]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>E(!1),children:"Cancelar"}),e.jsx(l,{onClick:fa,disabled:!$||de.length===0,children:"Asignar kit"})]})]})}),e.jsx(X,{open:ta,onOpenChange:a=>{A(a),a||oe("")},children:e.jsxs(Y,{children:[e.jsxs(Z,{children:[e.jsx(J,{children:"Importar plantilla Caterpillar"}),e.jsx(W,{children:"Genera automaticamente el plan (PM1-PM4) y los kits con filtros oficiales para tu modelo."})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(o,{htmlFor:"cat-model-select",children:"Modelo Caterpillar"}),e.jsxs(ee,{value:m,onValueChange:oe,children:[e.jsx(ae,{id:"cat-model-select",children:e.jsx(se,{placeholder:"Selecciona un modelo disponible"})}),e.jsx(re,{className:"max-h-64",children:ia.map(a=>{var s;return e.jsxs(P,{value:a.modelo,children:[a.modelo,(s=a.aliases)!=null&&s.length?` (${a.aliases.slice(0,2).join(", ")})`:""]},a.modelo)})})]})]}),e.jsxs(G,{children:[e.jsx(l,{variant:"outline",onClick:()=>A(!1),children:"Cancelar"}),e.jsx(l,{onClick:ba,disabled:!m||be,children:be?"Importando...":"Importar"})]})]})})]})})}export{as as default};
