import{c as Y,b as Te,r as n,j as e,a as J,X as _e}from"./index-C_D-5Bfv.js";import{m as ne,t as Ae,B as R,C as qe,a as ue,b as pe,c as fe,d as ge,e as be,w as je,x as Ge,L as We,g as Ne,h as ve,k as ye,l as Ce,j as ke,S as Se}from"./card-BIr-PJK2.js";import{B as j}from"./index-BtotK06U.js";import{C as M}from"./checkbox-BKYUVAI4.js";import{I as Ie}from"./input-DSUZcGci.js";import{L as I}from"./label-CqFCS6R-.js";import{C as Xe,S as Re,a as Fe,b as Oe,c as De,d as $e}from"./select-3Jn5ARjr.js";import{T as Ze,a as Je,b as we,c as Me,d as Qe,e as Le}from"./table-CQA1OK80.js";import{A as Ye,a as es,b as ss}from"./alert-O3FLJu-w.js";import{f as Ue}from"./maintenanceUtils-fNWGA9SH.js";import{g as Be}from"./caterpillarMaintenance-Dg_xV4Xi.js";import{u as as}from"./useDeviceDetection-CShWnkOv.js";import{M as rs}from"./MobileLayout-CV04gzFk.js";import{M as G}from"./MobileCard-DMSzGukU.js";import{F as ce}from"./filter-ldW4984T.js";import{S as Q}from"./sparkles-CBL8q4dG.js";import{D as oe}from"./download-CzgKvGv0.js";import"./chevron-right-fj5H7AOZ.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=Y("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Y("LayoutTemplate",[["rect",{width:"18",height:"7",x:"3",y:"3",rx:"1",key:"f1a2em"}],["rect",{width:"9",height:"7",x:"3",y:"14",rx:"1",key:"jqznyg"}],["rect",{width:"5",height:"7",x:"16",y:"14",rx:"1",key:"q5h2i8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=Y("Palette",[["circle",{cx:"13.5",cy:"6.5",r:".5",fill:"currentColor",key:"1okk4w"}],["circle",{cx:"17.5",cy:"10.5",r:".5",fill:"currentColor",key:"f64h9f"}],["circle",{cx:"8.5",cy:"7.5",r:".5",fill:"currentColor",key:"fotxhn"}],["circle",{cx:"6.5",cy:"12.5",r:".5",fill:"currentColor",key:"qy21gx"}],["path",{d:"M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z",key:"12rzf8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=Y("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]),cs=["ficha","nombre","modelo","categoria","estadoMantenimiento"],os=t=>{var f;if(!t)return"";const c=(f=t.tipoMantenimiento)==null?void 0:f.match(/(PM\d)/i);return c!=null&&c[1]?c[1].toUpperCase():t.frecuencia?t.frecuencia<=250?"PM1":t.frecuencia<=500?"PM2":t.frecuencia<=1e3?"PM3":t.frecuencia<=2e3?"PM4":"":""},is=[{key:"ficha",label:"Ficha"},{key:"nombre",label:"Nombre"},{key:"marca",label:"Marca"},{key:"modelo",label:"Modelo"},{key:"categoria",label:"Categoría"},{key:"estadoMantenimiento",label:"Estado Mant."},{key:"proximoIntervalo",label:"Próximo PM"},{key:"kitRecomendado",label:"Kit Rec."}],ze={emerald:{name:"Esmeralda",class:"bg-emerald-50 dark:bg-emerald-950/20"},amber:{name:"Ámbar",class:"bg-amber-50 dark:bg-amber-950/20"},sky:{name:"Cielo",class:"bg-sky-50 dark:bg-sky-950/20"},slate:{name:"Grafito",class:" bg-slate-100 dark:bg-slate-900/20"}};function ds(){const{data:t}=Te(),[c,f]=n.useState(""),[i,ee]=n.useState(cs),[N,K]=n.useState([]),[L,se]=n.useState([]),[P,ae]=n.useState("emerald"),[F,re]=n.useState(null),[W,H]=n.useState(!1),[C,k]=n.useState(!1),X=n.useMemo(()=>t.equipos.map(a=>{var U,Z;const m=t.mantenimientosProgramados.filter(A=>A.ficha===a.ficha).sort((A,B)=>A.horasKmRestante-B.horasKmRestante)[0],E=(m==null?void 0:m.horasKmActuales)??null,w=os(m),T=((U=a.marca)==null?void 0:U.toLowerCase())??"",g=T.includes("cat")||T.includes("caterpillar")?Be(a.modelo??""):null,$=w&&((Z=g==null?void 0:g.piezasPorIntervalo)!=null&&Z[w])?g.piezasPorIntervalo[w]:[],_=m?Ue(m.horasKmRestante,"h/km"):"Sin programa";return{...a,horasKmActualesLabel:E!=null?`${E} h/km`:"Sin dato",estadoMantenimiento:_,proximoIntervalo:w||"N/A",kitRecomendado:$.length?$.map(A=>`${A.pieza.numero_parte}`).join(", "):"Sin kit"}}),[t.equipos,t.mantenimientosProgramados]),te=n.useMemo(()=>Array.from(new Set(t.equipos.map(a=>a.categoria).filter(Boolean))).sort(),[t.equipos]),z=n.useMemo(()=>X.filter(a=>{if(N.length>0&&!N.includes(a.categoria))return!1;if(c){const o=c.toLowerCase();if(![a.nombre,a.ficha,a.modelo,a.categoria,a.estadoMantenimiento].filter(Boolean).join(" ").toLowerCase().includes(o))return!1}return!0}),[X,N,c]),S=z.filter(a=>L.includes(a.ficha)),O=a=>{ee(o=>o.includes(a)?o.filter(m=>m!==a):[...o,a])},D=a=>{K(o=>o.includes(a)?o.filter(m=>m!==a):[...o,a])},x=a=>{se(o=>o.includes(a)?o.filter(m=>m!==a):[...o,a])},V=()=>{const a=S.length>0?S:z;if(a.length===0||i.length===0)return;const o=i.join(","),m=a.map($=>i.map(_=>{const U=$[_]??"";return`"${String(U).replace(/"/g,'""')}"`}).join(",")),E=[o,...m].join(`
`),w=new Blob([E],{type:"text/csv;charset=utf-8;"}),T=URL.createObjectURL(w),g=document.createElement("a");g.href=T,g.setAttribute("download","lista-personalizada.csv"),document.body.appendChild(g),g.click(),document.body.removeChild(g),URL.revokeObjectURL(T)};return e.jsxs(rs,{title:"Listas Personalizadas",headerActions:e.jsx("div",{className:"flex gap-2",children:e.jsxs(j,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full relative",onClick:()=>H(!0),children:[e.jsx(ce,{className:"h-5 w-5"}),(N.length>0||c)&&e.jsx("div",{className:"absolute -top-1 -right-1 h-5 w-5 rounded-full bg-primary text-[10px] font-bold text-primary-foreground flex items-center justify-center",children:N.length+(c?1:0)})]})}),children:[e.jsxs("div",{className:"space-y-4 pb-20",children:[e.jsx(G,{variant:"glass",className:"p-4 border-primary/30 bg-primary/5",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Q,{className:"h-5 w-5 text-primary flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Listas Dinámicas"}),e.jsx("p",{className:"text-xs text-muted-foreground leading-relaxed",children:"Personaliza columnas y filtros para crear listados exportables a Excel"})]})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(j,{variant:"outline",className:"gap-2",onClick:()=>k(!0),children:[e.jsx(ne,{className:"h-4 w-4"}),"Columnas (",i.length,")"]}),e.jsxs(j,{variant:"outline",className:"gap-2",onClick:V,disabled:i.length===0,children:[e.jsx(oe,{className:"h-4 w-4"}),"Exportar"]})]}),e.jsxs("div",{className:"relative",children:[e.jsx(Ae,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(Ie,{placeholder:"Buscar equipos...",value:c,onChange:a=>f(a.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[e.jsxs(G,{variant:"compact",className:"text-center",children:[e.jsx("p",{className:"text-xl font-bold",children:z.length}),e.jsx("p",{className:"text-[0.65rem] text-muted-foreground",children:"Equipos"})]}),e.jsxs(G,{variant:"compact",className:"text-center border-primary/30",children:[e.jsx("p",{className:"text-xl font-bold text-primary",children:L.length}),e.jsx("p",{className:"text-[0.65rem] text-muted-foreground",children:"Selec."})]}),e.jsxs(G,{variant:"compact",className:"text-center border-emerald-500/30",children:[e.jsx("p",{className:"text-xl font-bold text-emerald-600",children:i.length}),e.jsx("p",{className:"text-[0.65rem] text-muted-foreground",children:"Columnas"})]})]}),z.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(ts,{className:"h-12 w-12 mx-auto text-muted-foreground mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground",children:"No hay equipos que mostrar"}),e.jsx(j,{variant:"outline",size:"sm",className:"mt-4",onClick:()=>{f(""),K([])},children:"Limpiar filtros"})]}):e.jsx("div",{className:"space-y-2",children:z.map(a=>{const o=L.includes(a.ficha),m=F===a.id;return e.jsx(G,{className:J("p-0 overflow-hidden transition-all",o&&"ring-2 ring-primary/30 border-primary/50"),children:e.jsxs("div",{className:"p-3 space-y-3",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(M,{checked:o,onCheckedChange:()=>x(a.ficha),className:"mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-bold text-sm truncate",children:a.nombre}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:a.ficha}),e.jsx(R,{variant:"outline",className:"text-xs",children:a.categoria})]})]}),e.jsx(j,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0 flex-shrink-0",onClick:()=>re(m?null:a.id),children:m?e.jsx(Xe,{className:"h-4 w-4"}):e.jsx(qe,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Modelo:"}),e.jsx("p",{className:"font-medium truncate",children:a.modelo})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Estado:"}),e.jsx("p",{className:"font-medium truncate",children:a.estadoMantenimiento})]})]}),m&&e.jsxs("div",{className:J("pt-3 border-t border-border/50 space-y-2 text-xs animate-in slide-in-from-top-2",ze[P].class),children:[i.includes("marca")&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Marca:"}),e.jsx("span",{className:"font-medium",children:a.marca})]}),i.includes("proximoIntervalo")&&e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-muted-foreground",children:"Próximo PM:"}),e.jsx("span",{className:"font-medium",children:a.proximoIntervalo})]}),i.includes("kitRecomendado")&&e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground block mb-1",children:"Kit recomendado:"}),e.jsx("p",{className:"font-medium text-[0.65rem] leading-relaxed",children:a.kitRecomendado})]})]})]})},a.id)})})]}),e.jsx(ue,{open:W,onOpenChange:H,children:e.jsxs(pe,{side:"bottom",className:"h-[70vh] rounded-t-[2rem] border-t-0",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted mb-4"}),e.jsxs(fe,{children:[e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"h-5 w-5"}),"Filtros"]}),e.jsx(be,{children:"Personaliza qué equipos mostrar"})]}),e.jsx(je,{className:"h-[calc(70vh-120px)] mt-6",children:e.jsxs("div",{className:"space-y-4 pr-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Categorías"}),e.jsx("div",{className:"space-y-2",children:te.map(a=>e.jsxs("label",{className:"flex items-center gap-2 rounded-lg border border-border/60 p-3 text-sm",children:[e.jsx(M,{checked:N.includes(a),onCheckedChange:()=>D(a)}),e.jsx("span",{children:a})]},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium",children:"Tema de color"}),e.jsxs(Re,{value:P,onValueChange:a=>ae(a),children:[e.jsx(Fe,{children:e.jsx(Oe,{})}),e.jsx(De,{children:Object.entries(ze).map(([a,o])=>e.jsx($e,{value:a,children:o.name},a))})]})]})]})}),e.jsxs("div",{className:"pt-4 border-t flex gap-2",children:[e.jsxs(j,{variant:"outline",className:"flex-1",onClick:()=>{K([]),f("")},children:[e.jsx(_e,{className:"h-4 w-4 mr-2"}),"Limpiar"]}),e.jsx(j,{className:"flex-1",onClick:()=>H(!1),children:"Aplicar"})]})]})}),e.jsx(ue,{open:C,onOpenChange:k,children:e.jsxs(pe,{side:"bottom",className:"h-[70vh] rounded-t-[2rem] border-t-0",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted mb-4"}),e.jsxs(fe,{children:[e.jsxs(ge,{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"h-5 w-5"}),"Columnas Visibles"]}),e.jsx(be,{children:"Selecciona qué datos mostrar y exportar"})]}),e.jsx(je,{className:"h-[calc(70vh-120px)] mt-6",children:e.jsx("div",{className:"space-y-2 pr-4",children:is.map(a=>e.jsxs("label",{className:J("flex items-center gap-3 rounded-lg border p-3 text-sm transition-colors",i.includes(a.key)?"border-primary/50 bg-primary/5":"border-border/60"),children:[e.jsx(M,{checked:i.includes(a.key),onCheckedChange:()=>O(a.key)}),e.jsx("span",{className:"font-medium",children:a.label}),i.includes(a.key)&&e.jsx(Ge,{className:"h-4 w-4 ml-auto text-primary"})]},a.key))})}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(j,{className:"w-full",onClick:()=>k(!1),children:"Listo"})})]})})]})}const ms=["ficha","nombre","modelo","categoria","estadoMantenimiento","kitRecomendado"],Ee={emerald:{name:"Esmeralda",header:"bg-emerald-50 text-emerald-800",badge:"border-emerald-200 bg-emerald-50 text-emerald-700",rowHover:"hover:bg-emerald-50/60"},amber:{name:"Ámbar",header:"bg-amber-50 text-amber-800",badge:"border-amber-200 bg-amber-50 text-amber-700",rowHover:"hover:bg-amber-50/60"},sky:{name:"Cielo",header:"bg-sky-50 text-sky-800",badge:"border-sky-200 bg-sky-50 text-sky-700",rowHover:"hover:bg-sky-50/60"},slate:{name:"Grafito",header:"bg-slate-900 text-slate-50 dark:bg-slate-800 dark:text-slate-100",badge:"border-slate-300 bg-slate-800 text-slate-100 dark:border-slate-600",rowHover:"hover:bg-slate-800/60 dark:hover:bg-slate-700/50"}},hs=t=>{var f;if(!t)return"";const c=(f=t.tipoMantenimiento)==null?void 0:f.match(/(PM\d)/i);return c!=null&&c[1]?c[1].toUpperCase():t.frecuencia?t.frecuencia<=250?"PM1":t.frecuencia<=500?"PM2":t.frecuencia<=1e3?"PM3":t.frecuencia<=2e3?"PM4":"":""},xs=()=>[{key:"ficha",label:"Ficha",description:"Identificador interno del equipo.",accessor:t=>t.ficha},{key:"nombre",label:"Nombre",description:"Nombre comercial o alias operativo.",accessor:t=>t.nombre},{key:"marca",label:"Marca",description:"Fabricante registrado del equipo.",accessor:t=>t.marca},{key:"modelo",label:"Modelo",description:"Modelo exacto según ficha técnica.",accessor:t=>t.modelo},{key:"numeroSerie",label:"N° de serie",description:"Número de serie físico reportado en la placa.",accessor:t=>t.numeroSerie},{key:"categoria",label:"Categoría",description:"Categoría operativa utilizada para agrupar el equipo.",accessor:t=>t.categoria},{key:"placa",label:"Placa",description:"Placa o código de activo fijo.",accessor:t=>t.placa},{key:"horasKmActualesLabel",label:"Lectura actual",description:"Lectura de horas o kilómetros registrada en el último mantenimiento programado.",accessor:t=>t.horasKmActualesLabel},{key:"estadoMantenimiento",label:"Estado de mantenimiento",description:"Situación del mantenimiento (al día, próximo o vencido).",accessor:t=>t.estadoMantenimiento},{key:"proximoIntervalo",label:"Intervalo próximo",description:"Intervalo PM asociado al próximo servicio.",accessor:t=>t.proximoIntervalo},{key:"proximoIntervaloDescripcion",label:"Descripción del intervalo",description:"Resumen de las tareas sugeridas por Caterpillar.",accessor:t=>t.proximoIntervaloDescripcion},{key:"kitRecomendado",label:"Kit recomendado",description:"Filtros y repuestos sugeridos para la intervención.",accessor:t=>t.kitRecomendado},{key:"tareasClave",label:"Tareas clave",description:"Actividades críticas incluidas en el kit.",accessor:t=>t.tareasClave}];function Ts(){const{isMobile:t}=as(),{data:c}=Te(),f=n.useMemo(()=>xs(),[]),[i,ee]=n.useState(ms),[N,K]=n.useState([]),[L,se]=n.useState([]),[P,ae]=n.useState([]),[F,re]=n.useState(""),[W,H]=n.useState("emerald"),[C,k]=n.useState([]),X=n.useMemo(()=>Array.from(new Set(c.equipos.map(s=>s.categoria).filter(s=>!!s))).sort(),[c.equipos]),te=n.useMemo(()=>Array.from(new Set(c.equipos.map(s=>s.marca).filter(s=>!!s))).sort(),[c.equipos]),z=n.useMemo(()=>Array.from(new Set(c.equipos.map(s=>s.modelo).filter(s=>!!s))).sort(),[c.equipos]),S=n.useMemo(()=>f.reduce((s,r)=>(s[r.key]=r,s),{}),[f]),O=n.useMemo(()=>{const s=new Map,r=l=>l?(s.has(l)||s.set(l,Be(l)),s.get(l)??null):null;return c.equipos.map(l=>{var ie,de,me,he,xe;const p=c.mantenimientosProgramados.filter(y=>y.ficha===l.ficha).sort((y,Ve)=>y.horasKmRestante-Ve.horasKmRestante)[0],h=(p==null?void 0:p.horasKmActuales)??null,d=hs(p),b=((ie=l.marca)==null?void 0:ie.toLowerCase())??"",u=b.includes("cat")||b.includes("caterpillar")?r(l.modelo??""):null,le=d&&((de=u==null?void 0:u.piezasPorIntervalo)!=null&&de[d])?u.piezasPorIntervalo[d]:[],q=d&&((me=u==null?void 0:u.tareasPorIntervalo)!=null&&me[d])?u.tareasPorIntervalo[d]:[],He=p?Ue(p.horasKmRestante,"horas/km"):"Sin programacion activa";return{...l,horasKmActualesLabel:h!=null?`${h} horas/km`:"Sin dato",estadoMantenimiento:He,proximoIntervalo:d||"No asignado",proximoIntervaloDescripcion:d&&((xe=(he=u==null?void 0:u.intervalos)==null?void 0:he.find(y=>y.codigo===d))!=null&&xe.descripcion)?u.intervalos.find(y=>y.codigo===d).descripcion:"Sin detalle disponible para el modelo registrado.",kitRecomendado:le.length?le.map(y=>`${y.pieza.numero_parte} — ${y.pieza.descripcion}`).join(` 
`):"No hay kit sugerido para este modelo.",tareasClave:q.length?q.join(` 
`):"Sin tareas recomendadas en el catalogo."}})},[c.equipos,c.mantenimientosProgramados]),D=n.useMemo(()=>O.reduce((s,r)=>(s.set(r.ficha,r),s),new Map),[O]);n.useEffect(()=>{k(s=>s.filter(r=>D.has(r)))},[D]);const x=n.useMemo(()=>O.filter(s=>{if(N.length>0&&!N.includes(s.categoria)||L.length>0&&!L.includes(s.marca)||P.length>0&&!P.includes(s.modelo))return!1;if(F){const r=F.toLowerCase();if(![s.nombre,s.ficha,s.modelo,s.categoria,s.marca,s.numeroSerie,s.placa,s.estadoMantenimiento].filter(Boolean).join(" ").toLowerCase().includes(r))return!1}return!0}),[O,N,L,P,F]),V=n.useMemo(()=>{const s=new Set(x.map(r=>r.ficha));return C.filter(r=>s.has(r))},[x,C]),a=V.length,o=n.useMemo(()=>x.filter(s=>C.includes(s.ficha)),[x,C]),m=n.useMemo(()=>{const s=new Map;return C.forEach(r=>{const l=D.get(r);if(!l)return;const v=s.get(l.categoria)??{count:0,categoria:l.categoria};v.count+=1,s.set(l.categoria,v)}),Array.from(s.values())},[C,D]),E=s=>{k(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},w=s=>{k(s?r=>{const l=new Set(r);return x.forEach(v=>l.add(v.ficha)),Array.from(l)}:r=>r.filter(l=>!V.includes(l)))},T=()=>{k(s=>s.filter(r=>!V.includes(r)))},g=s=>{ee(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},$=s=>{K(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},_=s=>{se(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},U=s=>{ae(r=>r.includes(s)?r.filter(l=>l!==s):[...r,s])},Z=()=>{const s=o.length>0?o:x;if(s.length===0||i.length===0)return;const r=i.map(b=>{var u;return((u=S[b])==null?void 0:u.label)??b}),l=s.map(b=>i.map(u=>{var q;return`"${(((q=S[u])==null?void 0:q.accessor(b))??"").replace(/"/g,'""')}"`}).join(",")),v=[r.join(","),...l].join(`
`),p=new Blob([v],{type:"text/csv;charset=utf-8;"}),h=URL.createObjectURL(p),d=document.createElement("a");d.href=h,d.setAttribute("download","lista-personalizada.csv"),document.body.appendChild(d),d.click(),document.body.removeChild(d),URL.revokeObjectURL(h)},A=()=>{const s=o.length>0?o:x;if(s.length===0||i.length===0)return;const r=i.map(h=>{var d;return((d=S[h])==null?void 0:d.label)??h}),l=s.map(h=>i.map(d=>{var b;return`<td style="padding:8px;border:1px solid #ddd;font-size:12px;">${((b=S[d])==null?void 0:b.accessor(h).replace(/\n/g,"<br/>"))??""}</td>`}).join("")),v=`
      <html>
        <head>
          <title>Lista personalizada</title>
          <style>
            body { font-family: 'Inter', system-ui, sans-serif; padding: 24px; color: #111827; }
            table { border-collapse: collapse; width: 100%; }
            th { background: #0f172a; color: white; padding: 10px; text-align: left; font-size: 13px; }
            td { vertical-align: top; }
          </style>
        </head>
        <body>
          <h2>Lista personalizada de equipos</h2>
          <table>
            <thead>
              <tr>${r.map(h=>`<th>${h}</th>`).join("")}</tr>
            </thead>
            <tbody>
              ${l.map(h=>`<tr>${h}</tr>`).join("")}
            </tbody>
          </table>
        </body>
      </html>
    `,p=window.open("","_blank");p&&(p.document.write(v),p.document.close(),p.focus(),p.print())},B=Ee[W],Ke=x.length===0?!1:a===x.length?!0:a>0?"indeterminate":!1;return t?e.jsx(ds,{}):e.jsx(We,{title:"Listas personalizadas",children:e.jsxs("div",{className:"space-y-6 lg:space-y-8",children:[e.jsxs(Ye,{className:"border-primary/40 bg-primary/5",children:[e.jsx(Q,{className:"h-4 w-4"}),e.jsx(es,{children:"Nuevas vistas dinámicas"}),e.jsx(ss,{children:"Selecciona las columnas, categorías y estilos visuales para generar listados a medida. Desde aquí puedes exportar las vistas a CSV (Excel) o imprimirlas en PDF para compartir con tu equipo."})]}),e.jsxs("section",{className:"grid gap-4 xl:grid-cols-[380px_1fr]",children:[e.jsxs(Ne,{className:"border border-border/60 bg-card/90",children:[e.jsxs(ve,{children:[e.jsxs(ye,{className:"flex items-center gap-2 text-lg",children:[e.jsx(Pe,{className:"h-5 w-5"})," Configura tu lista"]}),e.jsx(Ce,{children:"Define qué información necesitas antes de generar la tabla."})]}),e.jsxs(ke,{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Ae,{className:"h-4 w-4"})," Búsqueda rápida"]}),e.jsx(Ie,{placeholder:"Filtra por nombre, ficha, modelo o estado...",value:F,onChange:s=>re(s.target.value)})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(ce,{className:"h-4 w-4"})," Categorías"]}),e.jsx("div",{className:"grid grid-cols-1 gap-2 sm:grid-cols-2",children:X.map(s=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-border/60 p-2 text-sm",children:[e.jsx(M,{checked:N.includes(s),onCheckedChange:()=>$(s)}),e.jsx("span",{children:s})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(ns,{className:"h-4 w-4"})," Marcas"]}),e.jsx("div",{className:"grid max-h-[220px] grid-cols-1 gap-2 overflow-y-auto sm:grid-cols-2",children:te.map(s=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-border/60 p-2 text-sm",children:[e.jsx(M,{checked:L.includes(s),onCheckedChange:()=>_(s)}),e.jsx("span",{children:s})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Pe,{className:"h-4 w-4"})," Modelos"]}),e.jsx("div",{className:"grid max-h-[220px] grid-cols-1 gap-2 overflow-y-auto sm:grid-cols-2",children:z.map(s=>e.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-border/60 p-2 text-sm",children:[e.jsx(M,{checked:P.includes(s),onCheckedChange:()=>U(s)}),e.jsx("span",{children:s})]},s))})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(ne,{className:"h-4 w-4"})," Selección manual de fichas"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Marca fichas específicas para exportar listas enfocadas o preparar rutas por categoría."}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(j,{type:"button",size:"sm",variant:"outline",onClick:()=>w(!0),disabled:x.length===0,children:["Seleccionar todo (",x.length,")"]}),e.jsx(j,{type:"button",size:"sm",variant:"ghost",onClick:T,disabled:a===0,children:"Limpiar selección"}),e.jsxs(R,{variant:"secondary",className:"text-xs",children:[a," en esta vista"]})]}),m.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:m.map(({categoria:s,count:r})=>e.jsxs(R,{variant:"outline",className:"border-dashed text-xs",children:[s,": ",r]},s))}):e.jsx("p",{className:"text-[11px] text-muted-foreground",children:"No hay fichas marcadas todavía. Usa la columna de selección en la tabla para comenzar."}),e.jsx("p",{className:"text-[11px] text-muted-foreground",children:o.length>0?"Las exportaciones y reportes usarán solamente las fichas marcadas en esta vista.":"Si no seleccionas fichas, exportaremos todos los equipos filtrados."})]}),e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(ls,{className:"h-4 w-4"})," Estilo de tabla"]}),e.jsxs(Re,{value:W,onValueChange:s=>H(s),children:[e.jsx(Fe,{className:"w-full",children:e.jsx(Oe,{placeholder:"Selecciona un tema"})}),e.jsx(De,{children:Object.entries(Ee).map(([s,r])=>e.jsx($e,{value:s,children:r.name},s))})]})]}),e.jsx(Se,{}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(I,{className:"flex items-center gap-2 text-sm font-semibold",children:[e.jsx(Q,{className:"h-4 w-4"})," Columnas mostradas"]}),e.jsx("div",{className:"grid max-h-[280px] grid-cols-1 gap-2 overflow-y-auto border border-border/60 p-2 sm:grid-cols-2",children:f.map(s=>e.jsxs("label",{className:"flex items-start gap-2 rounded-md bg-muted/40 p-2 text-xs",children:[e.jsx(M,{checked:i.includes(s.key),onCheckedChange:()=>g(s.key)}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("span",{className:"font-medium",children:s.label}),e.jsx("p",{className:"text-muted-foreground leading-snug",children:s.description})]})]},s.key))})]})]})]}),e.jsxs(Ne,{className:"border border-border/60 bg-card/90",children:[e.jsxs(ve,{className:"flex flex-col gap-3 md:flex-row md:items-center md:justify-between",children:[e.jsxs("div",{children:[e.jsx(ye,{className:"text-lg",children:"Previsualización"}),e.jsxs(Ce,{children:[x.length," equipo",x.length===1?"":"s"," coinciden con los filtros aplicados."]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-2 text-xs text-muted-foreground",children:[e.jsxs(R,{variant:"outline",children:["Columnas: ",i.length]}),e.jsxs(R,{variant:"outline",children:["Fichas marcadas: ",a]}),e.jsxs(R,{variant:"outline",children:["Tema: ",B.name]})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsxs(j,{variant:"outline",size:"sm",onClick:A,disabled:i.length===0,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Exportar PDF"]}),e.jsxs(j,{size:"sm",onClick:Z,disabled:i.length===0,children:[e.jsx(oe,{className:"mr-2 h-4 w-4"})," Exportar Excel (CSV)"]})]})]}),e.jsx(ke,{className:"overflow-hidden",children:x.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center gap-2 rounded-lg border border-dashed border-border/60 py-16 text-center",children:[e.jsx(Q,{className:"h-8 w-8 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ajusta los filtros o las columnas para ver resultados."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs(Ze,{children:[e.jsx(Je,{children:e.jsxs(we,{className:B.header,children:[e.jsx(Me,{className:"w-12",children:e.jsx(M,{"aria-label":"Seleccionar todos los equipos visibles",checked:Ke,onCheckedChange:s=>w(!!s)})}),i.map(s=>{var r;return e.jsx(Me,{className:"text-xs font-semibold uppercase tracking-wide",children:((r=S[s])==null?void 0:r.label)??s},s)})]})}),e.jsx(Qe,{children:x.map(s=>{const r=C.includes(s.ficha);return e.jsxs(we,{className:J(`${B.rowHover} transition-colors`,r&&"ring-1 ring-primary/40 bg-primary/5 dark:bg-primary/10"),children:[e.jsx(Le,{className:"align-top",children:e.jsx(M,{checked:r,onCheckedChange:()=>E(s.ficha),"aria-label":`Seleccionar ${s.ficha}`})}),i.map(l=>{var h;const p=(((h=S[l])==null?void 0:h.accessor(s))??"").split(`
`);return e.jsx(Le,{className:"align-top text-sm",children:p.map((d,b)=>e.jsx("span",{className:"block",children:l==="estadoMantenimiento"?e.jsx(R,{variant:"outline",className:`${B.badge} text-xs font-medium`,children:d}):d},b))},`${s.id}-${l}`)})]},s.id)})})]})})})]})]})]})})}export{Ts as default};
