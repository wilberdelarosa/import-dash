import{c as U,r as c,j as e,a as w,s as fe,l as qe,m as me,b as Ue,w as Be,L as _e}from"./index-C_D-5Bfv.js";import{E as Fe}from"./jspdf.es.min-03oR84lN.js";import{autoTable as He}from"./jspdf.plugin.autotable-bUJAAMeG.js";import{B as I,$ as Ke,R as Ce,w as $e,af as ee,ag as se,C as We,a as Ee,b as Me,c as Ae,d as Te,e as De,g as R,h as L,k as O,l as P,j as q,ad as de,m as Ie,L as Ve,T as Ge,S as Qe,ah as Ye,H as Je,A as Xe,W as Ze}from"./card-BIr-PJK2.js";import{T as pe}from"./textarea-BSj91dWz.js";import{B as k}from"./index-BtotK06U.js";import{u as es}from"./useDeviceDetection-CShWnkOv.js";import{M as ss}from"./MobileLayout-CV04gzFk.js";import{M as J}from"./MobileCard-DMSzGukU.js";import{D as as,a as rs,E as ts,b as os,c as ce}from"./dropdown-menu-DmUKo3Zs.js";import{D as ns}from"./download-CzgKvGv0.js";import{S as T}from"./sparkles-CBL8q4dG.js";import{S as ls}from"./send-afmu6U6U.js";import{A as je,a as ye,b as ve}from"./alert-O3FLJu-w.js";import"./chevron-right-fj5H7AOZ.js";import"./index-APdQY6Km.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ne=U("CircleStop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=U("Copy",[["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const we=U("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ke=U("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=U("PanelLeftClose",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m16 15-3-3 3-3",key:"14y99z"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K=U("PanelLeftOpen",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"m14 9 3 3-3 3",key:"8010ee"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=U("SendHorizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=U("UserRound",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);function ds({onSend:a,className:t,placeholder:x="Pregunta sobre tu flota, solicita análisis o información específica..."}){const[h,b]=c.useState(""),o=c.useRef(null),[n,m]=c.useState(!1),[i,d]=c.useState(24);c.useEffect(()=>{const u=o.current;if(!u)return;(()=>{u.style.height="auto",u.style.height=`${Math.min(u.scrollHeight,160)}px`})()},[h]),c.useEffect(()=>{try{const u=navigator.userAgent||"",N=/Android/i.test(u),y=typeof window<"u"&&window.innerWidth<=640;N?m(!0):y&&d(90)}catch{}},[]);const g=async u=>{if(u.key==="Enter"&&!u.shiftKey){u.preventDefault();const N=h.trim();if(!N)return;await a(N),b("")}};return e.jsx("div",{className:w("fixed left-1/2 z-50 w-full max-w-3xl -translate-x-1/2 rounded-xl px-4",t),style:n?{top:72}:{bottom:i},children:e.jsx("div",{className:"relative mx-auto w-full",children:e.jsxs("div",{className:"flex items-end gap-3",children:[e.jsx(pe,{ref:o,value:h,onChange:u=>b(u.target.value),onKeyDown:g,placeholder:x,className:"min-h-[56px] max-h-[160px] resize-none rounded-2xl border border-border/40 bg-gradient-to-br from-background via-background/98 to-muted/5 px-4 py-3.5 text-sm leading-relaxed shadow-xl backdrop-blur-sm focus-visible:border-primary/40"}),e.jsx(k,{size:"sm",onClick:async()=>{const u=h.trim();u&&(await a(u),b(""))},className:"h-12 w-12 shrink-0 rounded-xl","aria-label":"Enviar consulta",children:e.jsx(Z,{className:"h-4 w-4"})})]})})})}async function cs({messages:a,signal:t,temperature:x=.2,maxTokens:h=1024}){var i,d;const{data:{session:b}}=await fe.auth.getSession();if(!b)throw new Error("No estás autenticado. Por favor inicia sesión.");const{data:o,error:n}=await fe.functions.invoke("ai-chat",{body:{messages:a}});if(n)throw new Error(n.message||"Error al consultar el asistente de IA");if(!o||!o.choices||!o.choices[0])throw new Error("Respuesta inválida del asistente de IA");const m=(d=(i=o.choices[0].message)==null?void 0:i.content)==null?void 0:d.trim();if(!m)throw new Error("La respuesta del asistente no contenía texto utilizable");return{content:m,model:o.model??"unknown",usage:o.usage??null}}const xe="chatbot-conversation-history",ms=()=>{try{const a=localStorage.getItem(xe);if(a)return JSON.parse(a)}catch(a){console.error("Error loading chat history:",a)}return[]},us=a=>{try{localStorage.setItem(xe,JSON.stringify(a))}catch(t){console.error("Error saving chat history:",t)}},V=()=>typeof crypto<"u"&&"randomUUID"in crypto?crypto.randomUUID():Math.random().toString(36).slice(2),ps=a=>a?{promptTokens:a.prompt_tokens??0,completionTokens:a.completion_tokens??0,totalTokens:a.total_tokens??0}:null;function xs({systemPrompt:a,initialAssistantMessage:t}){const[x,h]=c.useState(()=>{const C=ms();return C.length>0?C:t?[{id:V(),role:"assistant",content:t,createdAt:new Date().toISOString()}]:[]}),[b,o]=c.useState(!1),[n,m]=c.useState(null),[i,d]=c.useState(null),[g,u]=c.useState(null),N=c.useRef(null),y=c.useRef(a),r=c.useRef(x);c.useEffect(()=>{y.current=a},[a]),c.useEffect(()=>{r.current=x,x.length>0&&us(x)},[x]),c.useEffect(()=>{if(!(!t||r.current.some(v=>v.role==="user"))){if(r.current.length===0){const v={id:V(),role:"assistant",content:t,createdAt:new Date().toISOString()};r.current=[v],h([v]);return}if(r.current.length===1&&r.current[0].role==="assistant"){const v=r.current[0];if(v.content!==t){const E={...v,content:t};r.current=[E],h([E])}}}},[t]);const p=c.useCallback(()=>{var C;(C=N.current)==null||C.abort(),N.current=null,o(!1)},[]),D=c.useCallback(()=>{if(p(),m(null),u(null),d(null),localStorage.removeItem(xe),!t){r.current=[],h([]);return}const C={id:V(),role:"assistant",content:t,createdAt:new Date().toISOString()};r.current=[C],h([C])},[t,p]),_=c.useCallback(async C=>{var B;const v=C.trim();if(!v)return;m(null),o(!0);const E={id:V(),role:"user",content:v,createdAt:new Date().toISOString()},l=[...r.current,E];r.current=l,h(l),(B=N.current)==null||B.abort();const S=new AbortController;N.current=S;const z=[{role:"system",content:y.current},...l.map($=>({role:$.role,content:$.content}))];try{const $=await cs({messages:z,signal:S.signal}),W={id:V(),role:"assistant",content:$.content,createdAt:new Date().toISOString(),model:$.model},F=[...r.current,W];r.current=F,h(F),d($.model),u(ps($.usage))}catch($){if($ instanceof DOMException&&$.name==="AbortError")return;const W=$ instanceof Error?$.message:"Ocurrió un error desconocido al consultar el asistente.";m(W)}finally{o(!1)}},[]);return c.useMemo(()=>({messages:x,isLoading:b,error:n,activeModel:i,usage:g,sendMessage:_,stop:p,reset:D}),[x,b,n,i,g,_,p,D])}function ze({content:a}){const t=()=>{const o=a.split(`
`),n=[];let m=[],i=[],d=0;const g=()=>{m.length>0&&(n.push(x(m,d)),m=[])},u=()=>{i.length>0&&(n.push(h(i,d)),i=[])};return o.forEach(N=>{const y=N.trim();if(!y){g(),u(),d++;return}if(y.startsWith("|")&&y.endsWith("|")){u(),m.push(N),d++;return}if(y.startsWith("- ")||y.startsWith("* ")){g(),i.push(y.slice(2)),d++;return}g(),u(),y.startsWith("###")?n.push(e.jsx("h4",{className:"text-sm font-semibold text-primary mt-3 first:mt-0",children:y.replace(/^###\s*/,"")},`h3-${d}`)):y.startsWith("##")?n.push(e.jsx("h3",{className:"text-base font-semibold text-primary mt-3 first:mt-0",children:y.replace(/^##\s*/,"")},`h2-${d}`)):y.startsWith("#")?n.push(e.jsx("h2",{className:"text-lg font-semibold text-primary mt-3 first:mt-0",children:y.replace(/^#\s*/,"")},`h1-${d}`)):n.push(e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:b(y)},`p-${d}`)),d++}),g(),u(),n},x=(o,n)=>{if(o.length<2)return null;const m=o[0].split("|").slice(1,-1).map(g=>g.trim()),d=o.slice(2).map(g=>g.split("|").slice(1,-1).map(u=>u.trim()));return e.jsx(hs,{headers:m,rows:d},`table-${n}`)},h=(o,n)=>e.jsx("ul",{className:"space-y-1.5 text-sm text-foreground my-2",children:o.map((m,i)=>e.jsxs("li",{className:"flex items-start gap-2",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 rounded-full bg-primary shrink-0"}),e.jsx("span",{className:"leading-relaxed",children:b(m)})]},`list-item-${n}-${i}`))},`list-${n}`),b=o=>{const n=[],m=/(\*\*[^*]+\*\*|`[^`]+`)/g;let i=0,d;for(;(d=m.exec(o))!==null;){const[g]=d,u=d.index;u>i&&n.push(o.slice(i,u)),g.startsWith("**")?n.push(e.jsx("span",{className:"font-semibold text-primary",children:g.replace(/\*\*/g,"")},`${u}-bold`)):g.startsWith("`")&&n.push(e.jsx("code",{className:"rounded bg-muted/50 px-1 py-0.5 font-mono text-xs text-primary dark:bg-muted/30",children:g.replace(/`/g,"")},`${u}-code`)),i=u+g.length}return i<o.length&&n.push(o.slice(i)),n.length>0?n:o};return e.jsx("div",{className:"space-y-2 text-sm leading-relaxed text-foreground",children:t()})}function hs({headers:a,rows:t}){const[x,h]=c.useState(0),b=n=>{const m=n.target;h(m.scrollLeft)},o=x>0;return e.jsxs("div",{className:"my-3 relative group",children:[e.jsx("div",{className:"absolute -left-1 top-0 bottom-0 w-6 bg-gradient-to-r from-background to-transparent z-10 pointer-events-none opacity-0 group-hover:opacity-100 transition-opacity",style:{display:o?"block":"none"}}),e.jsx("div",{className:"absolute -right-1 top-0 bottom-0 w-6 bg-gradient-to-l from-background to-transparent z-10 pointer-events-none"}),e.jsx("div",{className:"sm:hidden flex items-center justify-between mb-2 px-1",children:e.jsx("span",{className:"text-[0.65rem] text-muted-foreground",children:"Desliza para ver más →"})}),e.jsx("div",{id:"table-scroll-container",className:"overflow-x-auto rounded-lg border border-border/60 bg-card/50 backdrop-blur-sm scrollbar-thin scrollbar-thumb-primary/20 scrollbar-track-transparent",onScroll:b,children:e.jsxs("table",{className:"w-full border-collapse text-xs sm:text-sm",children:[e.jsx("thead",{children:e.jsx("tr",{className:"bg-primary/5 dark:bg-primary/10",children:a.map((n,m)=>e.jsx("th",{className:"border-b border-border/60 px-2 sm:px-3 py-2 text-left font-semibold text-foreground whitespace-nowrap",children:n},`header-${m}`))})}),e.jsx("tbody",{children:t.map((n,m)=>e.jsx("tr",{className:w("transition-colors",m%2===0?"bg-transparent":"bg-muted/20"),children:n.map((i,d)=>e.jsx("td",{className:"border-b border-border/30 px-2 sm:px-3 py-2 text-foreground",children:i},`cell-${m}-${d}`))},`row-${m}`))})]})}),e.jsxs("div",{className:"flex items-center justify-between mt-1.5 px-1",children:[e.jsxs("span",{className:"text-[0.6rem] text-muted-foreground",children:[t.length," ",t.length===1?"registro":"registros"]}),e.jsxs("span",{className:"text-[0.6rem] text-muted-foreground",children:[a.length," columnas"]})]})]})}const bs=["¿Cuántos equipos tengo activos?","Mostrar mantenimientos vencidos","Resumen del inventario","Próximos mantenimientos"];function gs({messages:a,isLoading:t,onSendMessage:x,onClearChat:h,activeModel:b,context:o,onExportConversation:n}){const{toast:m}=qe(),[i,d]=c.useState(""),[g,u]=c.useState(!1),[N,y]=c.useState(!1),r=c.useRef(null),p=c.useRef(null);c.useEffect(()=>{var l;(l=p.current)==null||l.scrollIntoView({behavior:"smooth"})},[a]);const D=()=>{!i.trim()||t||(x(i.trim()),d(""))},_=l=>{t||x(l)},C=l=>{l.key==="Enter"&&!l.shiftKey&&(l.preventDefault(),D())},v=async l=>{try{await navigator.clipboard.writeText(l),m({title:"Copiado",description:"Mensaje copiado al portapapeles"})}catch{m({title:"Error",description:"No se pudo copiar el mensaje",variant:"destructive"})}},E=()=>{n&&n()};return e.jsxs(e.Fragment,{children:[e.jsx(ss,{title:"Asistente IA",showBottomNav:!0,headerActions:e.jsxs("div",{className:"flex items-center gap-2",children:[b&&e.jsx(I,{variant:"outline",className:"text-[0.65rem] px-2 py-0.5 h-6 border-primary/30 text-primary bg-primary/5",children:b.split("-").slice(0,2).join("-")}),e.jsxs(as,{children:[e.jsx(rs,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-primary/10",children:e.jsx(ts,{className:"h-5 w-5"})})}),e.jsxs(os,{align:"end",className:"w-48",children:[e.jsxs(ce,{onClick:()=>y(!0),className:"gap-2",children:[e.jsx(Ke,{className:"h-4 w-4"}),"Ver contexto"]}),n&&a.length>0&&e.jsxs(ce,{onClick:E,className:"gap-2",children:[e.jsx(ns,{className:"h-4 w-4"}),"Exportar conversación"]}),a.length>0&&e.jsxs(ce,{onClick:h,className:"gap-2 text-destructive focus:text-destructive",children:[e.jsx(Ce,{className:"h-4 w-4"}),"Limpiar chat"]})]})]})]}),children:e.jsxs("div",{className:"flex flex-col h-[calc(100vh-9rem)] -mx-4 -mt-4",children:[e.jsx($e,{ref:r,className:"flex-1 px-4 pt-4",onScroll:l=>{const S=l.target,z=S.scrollHeight-S.scrollTop-S.clientHeight<100;u(!z)},children:e.jsxs("div",{className:"space-y-4 pb-4",children:[a.length===0&&e.jsxs(J,{variant:"glass",className:"p-6 text-center border-primary/20 shadow-premium relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 w-32 h-32 bg-primary/5 rounded-full blur-3xl"}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"mx-auto mb-4 h-16 w-16 rounded-full bg-gradient-premium flex items-center justify-center shadow-lg shadow-primary/30",children:e.jsx(T,{className:"h-8 w-8 text-primary-foreground"})}),e.jsx("h2",{className:"text-xl font-bold text-foreground/90 mb-2",children:"¡Hola! Soy tu Asistente IA"}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:"Puedo ayudarte con información sobre equipos, mantenimientos, inventario y más."})]})]}),a.length===0&&e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-xs font-semibold text-muted-foreground px-1 uppercase tracking-wider",children:"Consultas rápidas"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:bs.map((l,S)=>e.jsx(k,{variant:"outline",className:"h-auto p-3 text-xs text-left justify-start whitespace-normal bg-card/50 backdrop-blur-sm hover:bg-primary/5 hover:border-primary/30 transition-all active:scale-95",onClick:()=>_(l),disabled:t,children:l},S))})]}),a.map((l,S)=>e.jsxs("div",{className:w("flex gap-3 animate-in slide-in-from-bottom-4 fade-in fill-mode-backwards",l.role==="user"&&"flex-row-reverse"),style:{animationDelay:`${S*.05}s`},children:[e.jsx(ee,{className:w("h-8 w-8 flex-shrink-0",l.role==="assistant"&&"bg-gradient-premium"),children:e.jsx(se,{className:w(l.role==="assistant"?"bg-transparent text-primary-foreground":"bg-primary/10 text-primary"),children:l.role==="assistant"?e.jsx(T,{className:"h-4 w-4"}):e.jsx(ue,{className:"h-4 w-4"})})}),e.jsxs("div",{className:w("flex-1 max-w-[85%]",l.role==="user"&&"flex justify-end"),children:[e.jsxs("div",{className:"relative group",children:[e.jsx(J,{variant:l.role==="assistant"?"glass":"compact",className:w("p-3",l.role==="user"?"bg-primary text-primary-foreground border-0 shadow-lg shadow-primary/20":"border-border/50"),children:l.role==="assistant"?e.jsx(ze,{content:l.content}):e.jsx("p",{className:"text-sm leading-relaxed whitespace-pre-wrap",children:l.content})}),l.role==="assistant"&&e.jsx("div",{className:"opacity-0 group-hover:opacity-100 transition-opacity absolute -right-2 top-0",children:e.jsx(k,{size:"icon",variant:"ghost",className:"h-7 w-7 rounded-full bg-background/80 backdrop-blur-sm shadow-sm",onClick:()=>v(l.content),children:e.jsx(is,{className:"h-3.5 w-3.5"})})})]}),e.jsx("p",{className:w("text-[0.65rem] text-muted-foreground mt-1 px-1",l.role==="user"&&"text-right"),children:new Date(l.createdAt).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]})]},l.id)),t&&e.jsxs("div",{className:"flex gap-3 animate-in slide-in-from-bottom-4 fade-in",children:[e.jsx(ee,{className:"h-8 w-8 flex-shrink-0 bg-gradient-premium",children:e.jsx(se,{className:"bg-transparent text-primary-foreground",children:e.jsx(T,{className:"h-4 w-4"})})}),e.jsx(J,{variant:"glass",className:"p-3 border-border/50",children:e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary animate-pulse"}),e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary animate-pulse",style:{animationDelay:"0.2s"}}),e.jsx("div",{className:"h-2 w-2 rounded-full bg-primary animate-pulse",style:{animationDelay:"0.4s"}})]})})]}),e.jsx("div",{ref:p})]})}),g&&a.length>0&&e.jsx(k,{size:"icon",className:"absolute bottom-24 right-6 h-10 w-10 rounded-full shadow-lg shadow-primary/30 bg-primary hover:bg-primary/90 z-10 animate-in zoom-in-95 fade-in",onClick:()=>{var l;return(l=p.current)==null?void 0:l.scrollIntoView({behavior:"smooth"})},children:e.jsx(We,{className:"h-5 w-5"})}),e.jsx("div",{className:"sticky bottom-0 left-0 right-0 glass-panel border-t-0 shadow-[0_-4px_20px_-5px_rgba(0,0,0,0.1)] p-4 pb-safe",children:e.jsxs("div",{className:"flex gap-2 items-end",children:[e.jsx(pe,{value:i,onChange:l=>d(l.target.value),onKeyDown:C,placeholder:"Escribe tu pregunta...",className:"min-h-[44px] max-h-32 resize-none bg-muted/50 border-border/50 focus-visible:ring-1 focus-visible:ring-primary/50 rounded-xl",disabled:t}),e.jsx(k,{size:"icon",className:w("h-11 w-11 rounded-xl flex-shrink-0 transition-all duration-300",i.trim()&&!t?"bg-gradient-premium shadow-glow-primary hover:scale-105 active:scale-95":"bg-muted"),onClick:D,disabled:!i.trim()||t,children:t?e.jsx(me,{className:"h-5 w-5 animate-spin"}):e.jsx(ls,{className:"h-5 w-5"})})]})})]})}),e.jsx(Ee,{open:N,onOpenChange:y,children:e.jsxs(Me,{side:"bottom",className:"h-[80vh] rounded-t-[2rem] border-t-0 bg-background/95 backdrop-blur-xl",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted"}),e.jsxs(Ae,{className:"mt-4",children:[e.jsxs(Te,{className:"flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5 text-primary"}),"Estado del Conocimiento"]}),e.jsx(De,{children:"Contexto sincronizado con datos en tiempo real"})]}),e.jsx("div",{className:"mt-6 space-y-4 overflow-y-auto max-h-[calc(80vh-140px)] pb-4",children:o?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-muted/40 px-3.5 py-2 text-xs backdrop-blur-sm",children:[e.jsx("div",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Última actualización:"}),e.jsx("span",{className:"font-semibold text-foreground",children:o.lastUpdatedLabel})]}),o.sections.map(l=>e.jsxs(J,{variant:"glass",className:"p-4",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-primary mb-3",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),l.title]}),e.jsx("ul",{className:"space-y-2 pl-3",children:l.items.map((S,z)=>e.jsxs("li",{className:"flex items-start gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 shrink-0 rounded-full bg-primary/40"}),e.jsx("span",{className:"leading-relaxed",children:S})]},`${l.title}-${z}`))})]},l.title))]}):e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay información de contexto disponible"})})]})})]})}const fs=["llama-3.3-70b-versatile","llama-3.1-70b-versatile","llama-3.1-8b-instant","mixtral-8x7b-32768"],js=()=>[],ys=()=>{const a=js();return a.length?a:[...fs]},vs=a=>{const t=a.replace(/^\||\|$/g,"").trim();return t?t.split("|").every(x=>/^:?-+:?$/.test(x.trim())):!1},Se=a=>a.replace(/^\||\|$/g,"").split("|").map(t=>t.trim()),Ns=a=>{const t=a.split(`
`);for(let x=0;x<t.length-1;x++){const h=t[x],b=t[x+1];if(!h.includes("|")||!b.includes("|")||!vs(b))continue;const o=Se(h).filter(i=>i.length>0);if(!o.length)continue;const n=[];for(let i=x+2;i<t.length;i++){const d=t[i];if(!d.includes("|"))break;const g=Se(d);g.every(u=>u==="")||n.push(g)}if(!n.length)continue;const m=n.map(i=>{const d=[...i];for(;d.length<o.length;)d.push("");return d.slice(0,o.length)});return{headers:o,rows:m}}return null},ws=[{label:"Historial de eventos",description:"Auditoría completa de acciones y cambios.",to:"/historial",icon:Je},{label:"Planes de mantenimiento",description:"Revisa y ajusta los planes activos.",to:"/planes-mantenimiento",icon:Xe},{label:"Control de mantenimiento",description:"Supervisa el estado de los mantenimientos.",to:"/control-mantenimiento",icon:Ze},{label:"Listas personalizadas",description:"Accede tareas guardadas y kits.",to:"/listas-personalizadas",icon:Ie}],ks=a=>{if(!a)return"Sin registro";const t=new Date(a);return Number.isNaN(t.getTime())?"Sin registro":t.toLocaleDateString("es-ES",{day:"2-digit",month:"short",year:"numeric"})},Ss=(a,t)=>{var y;if(!a)return{summary:"Aun no se han cargado datos de Supabase. Indica al usuario que espere a que la sincronizacion finalice antes de ofrecer recomendaciones especificas.",sections:[{title:"Estado de la base de datos",items:["Datos en proceso de carga o no disponibles."]}],lastUpdatedLabel:new Date().toLocaleString("es-ES")};const x=a.equipos.length,h=a.equipos.filter(r=>r.activo).length,b=x-h,o=a.equipos.reduce((r,p)=>(p.categoria&&(r[p.categoria]=(r[p.categoria]??0)+1),r),{}),n=Object.entries(o).sort((r,p)=>p[1]-r[1]).slice(0,3).map(([r,p])=>`${r}: ${p}`),m=a.mantenimientosProgramados.filter(r=>r.activo).slice().sort((r,p)=>r.horasKmRestante-p.horasKmRestante).slice(0,5).map(r=>`${r.nombreEquipo} - ${r.tipoMantenimiento} - ${r.horasKmRestante} horas/km restantes`),i=a.inventarios.filter(r=>r.activo&&r.cantidad<=3).slice().sort((r,p)=>r.cantidad-p.cantidad).slice(0,5).map(r=>`${r.nombre} (${r.codigoIdentificacion}) - ${r.cantidad} en stock`),d=a.actualizacionesHorasKm.slice().sort((r,p)=>new Date(p.fecha).getTime()-new Date(r.fecha).getTime()).slice(0,5).map(r=>`${r.nombreEquipo??r.ficha} - ${r.horasKm} horas/km el ${ks(r.fecha)}`),g=((y=a.empleados)==null?void 0:y.filter(r=>r.activo).length)??0,u=[`Equipos registrados: ${x} (activos: ${h}, inactivos: ${b}).`,`Empleados activos disponibles: ${g}.`,m.length?`Proximos mantenimientos prioritarios: ${m.join(" | ")}`:"No hay mantenimientos proximos registrados.",i.length?`Inventarios criticos (<=3 unidades): ${i.join(" | ")}`:"No hay repuestos con stock critico (<=3 unidades).",d.length?`Ultimas actualizaciones de horas/km: ${d.join(" | ")}`:"No se registran actualizaciones recientes de horas/km.",t?`Umbral preventivo: ${t.alertaPreventiva} horas/km - Umbral critico: ${t.alertaCritica} horas/km.`:"Usa los umbrales predeterminados (50 preventivo / 15 critico) si no se especifican valores del sistema."],N=[{title:"Indicadores generales",items:[`Equipos activos: ${h}`,`Equipos fuera de servicio: ${b}`,n.length?`Categorias destacadas: ${n.join(", ")}`:"Categorias destacadas: Sin datos destacados"]},{title:"Mantenimientos en agenda",items:m.length?m:["No hay mantenimientos activos con prioridad inmediata."]},{title:"Inventarios criticos",items:i.length?i:["Todos los repuestos se encuentran por encima del nivel critico (<=3)."]},{title:"Actividad reciente",items:d.length?d:["Sin lecturas recientes de horas/kilometros registradas."]}];return{summary:u.join(`
`),sections:N,lastUpdatedLabel:new Date().toLocaleString("es-ES")}},Cs=a=>`Eres ALITO BOT, el asistente virtual de soporte de la plataforma de gestión de maquinaria de ALITO GROUP SRL. Tu rol es responder SIEMPRE en español con un tono profesional y empático.

Instrucciones clave:
- Usa únicamente la información más reciente proporcionada en el contexto si está disponible. Si necesitas un dato que no aparece, indica de forma transparente que no se encuentra en la base actual.
- Propón pasos concretos y accionables basados en el estado de los equipos, mantenimientos e inventarios.
- Si detectas riesgos (por ejemplo, equipos con horas/km por debajo del umbral crítico o repuestos con stock bajo) resáltalos y sugiere cómo mitigarlos.
- Cuando el usuario pida ayuda fuera del ámbito de la flota o sin relación con los datos proporcionados, responde brevemente y redirígelo a la información disponible.

IMPORTANTE - Formateo de respuestas con tablas:
- Cuando el usuario solicite listas o información tabular (por ejemplo: "lista de equipos Caterpillar", "muestra todos los rodillos con más de 1000 horas"), genera las respuestas en formato de tabla Markdown.
- Usa la siguiente sintaxis para tablas:

| Nombre | Ficha | Modelo | Horas Actuales |
|--------|-------|--------|----------------|
| Excavadora 320 | EX-001 | 320 | 1,250 |
| Rodillo CB10 | RD-003 | CB10 | 890 |

- Las tablas deben incluir las columnas relevantes solicitadas por el usuario.
- Ordena y filtra los datos según los criterios especificados por el usuario.
- Si el usuario pide filtros complejos (ej: "equipos que no son Caterpillar y ficha > AC-44"), aplica todos los filtros correctamente.

Ejemplos de consultas que deben generar tablas:
- "lista de nombre, ficha, modelo de todos los equipos Caterpillar"
- "muéstrame los equipos con mantenimiento vencido"
- "dame una tabla de repuestos con stock bajo"
- "equipos activos con más de 2000 horas"

Contexto actualizado del negocio:
${a}

Siempre que entregues listados, utiliza tablas Markdown o viñetas claras. Refiérete a los equipos por su nombre comercial y ficha cuando sea posible.`,$s=a=>{var o,n,m;const t=((o=a[0])==null?void 0:o.items.slice(0,2).join(" · "))??"",x=(m=(n=a[1])==null?void 0:n.items)==null?void 0:m.slice(0,2).join(" | "),h="Hola, soy ALITO BOT. Ya estoy conectado a los datos operativos más recientes de tu flota. ¿En qué puedo ayudarte hoy?",b=[];return t&&b.push(`Resumen actual: ${t}.`),x&&b.push(`Seguimiento de mantenimientos: ${x}.`),b.length?`${h} ${b.join(" ")}`:h};function Hs(){var ge;const{data:a,loading:t,usingDemoData:x}=Ue(),{config:h}=Be(),{isMobile:b}=es(),[o,n]=c.useState("docked"),[m,i]=c.useState(!1),[d,g]=c.useState(!1),[u,N]=c.useState(""),[y,r]=c.useState(null),p=c.useMemo(()=>{const s=Ss(t?null:a,h);if(!a)return s;const f=a.equipos.map(j=>`${j.nombre} (Ficha: ${j.ficha}, Marca: ${j.marca}, Modelo: ${j.modelo}, Serie: ${j.numeroSerie}, Categoría: ${j.categoria}, Estado: ${j.activo?"Activo":"Inactivo"})`).join(" | "),M=a.mantenimientosProgramados.map(j=>`${j.nombreEquipo} (Ficha: ${j.ficha}, Tipo: ${j.tipoMantenimiento}, Horas actuales: ${j.horasKmActuales}, Restante: ${j.horasKmRestante})`).join(" | "),A=a.inventarios.map(j=>`${j.nombre} (Código: ${j.codigoIdentificacion}, Stock: ${j.cantidad}, Categoría: ${j.categoriaEquipo})`).join(" | ");return{...s,summary:`${s.summary}

DATOS COMPLETOS PARA BÚSQUEDAS:

Equipos completos: ${f}

Mantenimientos: ${M}

Inventarios: ${A}

Usa estos datos para responder consultas específicas y generar tablas filtradas según los criterios del usuario.`}},[a,h,t]),D=c.useMemo(()=>ys(),[]),_=c.useMemo(()=>Cs(p.summary),[p.summary]),C=c.useMemo(()=>$s(p.sections),[p.sections]),{messages:v,isLoading:E,sendMessage:l,error:S,activeModel:z,usage:B,reset:$,stop:W}=xs({systemPrompt:_,initialAssistantMessage:C}),F=v.length,G=c.useMemo(()=>v.filter(s=>s.role==="user").length,[v]),ae=c.useMemo(()=>p.summary?p.summary.length>180?`${p.summary.slice(0,177)}…`:p.summary:"",[p.summary]),re=o==="docked"&&!d,Re=c.useMemo(()=>[{label:"Mensajes oficiales",value:`${F}`,helper:"Conversaciones activas"},{label:"Consultas recibidas",value:`${G}`,helper:"Usuarios interactuando"},{label:"Modelos en rotacion",value:D.slice(0,3).join(" / ")||"Automatico",helper:"Prioridad configurada"},{label:"Contexto principal",value:ae||"Cargado al instante",helper:"Resumen preparado"}],[F,G,D,ae]),te=c.useRef(null),he=c.useRef(null),Q=()=>{const s=he.current;if(!s)return;s.style.height="auto";const f=180;s.style.height=`${Math.min(s.scrollHeight,f)}px`};c.useEffect(()=>{var s;(s=te.current)==null||s.scrollIntoView({behavior:"smooth"})},[v]),c.useEffect(()=>{Q()},[]);const oe=async s=>{const f=typeof s=="string"?s:u;f.trim()&&(await l(f),N(""),Q(),g(!0),setTimeout(()=>{var M;return(M=te.current)==null?void 0:M.scrollIntoView({behavior:"smooth",block:"center"})},120))},Le=(s,f,M)=>{r(s);try{const A=new Fe({orientation:f.headers.length>4?"landscape":"portrait",unit:"pt",format:"a4"});A.setFontSize(14),A.text(M,40,40),He(A,{startY:60,head:[f.headers],body:f.rows,theme:"grid",headStyles:{fillColor:[29,78,216],textColor:255,fontStyle:"bold"},styles:{fontSize:10,cellPadding:6},columnStyles:f.headers.reduce((Y,le,H)=>(Y[H]={cellWidth:"auto"},Y),{})});const j=M.replace(/[^a-zA-Z0-9-_]/g,"_").slice(0,60)||"tabla";A.save(`${j}-${new Date().toISOString().split("T")[0]}.pdf`)}catch(A){console.error("Error generando PDF de tabla",A)}finally{r(null)}},be=e.jsxs(e.Fragment,{children:[e.jsxs(R,{className:"overflow-hidden border border-primary/20 bg-gradient-to-br from-card via-card/95 to-primary/5 shadow-lg backdrop-blur-sm",children:[e.jsx(L,{className:"border-b border-border/20 bg-gradient-to-r from-primary/5 to-transparent pb-4",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 backdrop-blur-sm shadow-sm",children:e.jsx(T,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-base font-bold",children:"Estado del conocimiento"}),e.jsx(P,{className:"text-xs mt-0.5",children:"Resumen generado con datos en tiempo real"})]})]})}),e.jsxs(q,{className:"space-y-4 pt-5 text-sm",children:[e.jsxs("div",{className:"flex items-center gap-2 rounded-xl bg-muted/40 px-3.5 py-2 text-xs backdrop-blur-sm",children:[e.jsx("div",{className:"h-2 w-2 animate-pulse rounded-full bg-green-500"}),e.jsx("span",{className:"text-muted-foreground",children:"Última actualización:"}),e.jsx("span",{className:"font-semibold text-foreground",children:p.lastUpdatedLabel})]}),p.sections.map(s=>e.jsxs("div",{className:"space-y-2.5",children:[e.jsxs("h3",{className:"flex items-center gap-2 text-xs font-bold uppercase tracking-wider text-primary",children:[e.jsx("div",{className:"h-1 w-1 rounded-full bg-primary"}),s.title]}),e.jsx("ul",{className:"space-y-2 pl-3",children:s.items.map((f,M)=>e.jsxs("li",{className:"flex items-start gap-2 text-xs text-muted-foreground",children:[e.jsx("span",{className:"mt-1.5 h-1.5 w-1.5 shrink-0 rounded-full bg-primary/40"}),e.jsx("span",{className:"leading-relaxed",children:f})]},`${s.title}-${M}`))})]},s.title))]})]}),e.jsxs(R,{className:"overflow-hidden border border-border/30 bg-gradient-to-br from-card via-card/95 to-muted/20 shadow-lg backdrop-blur-sm",children:[e.jsx(L,{className:"border-b border-border/20 bg-gradient-to-r from-muted/10 to-transparent pb-4",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"rounded-xl bg-muted p-2 backdrop-blur-sm shadow-sm",children:e.jsx(de,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-base font-bold",children:"Funcionamiento del asistente"}),e.jsx(P,{className:"text-xs mt-0.5",children:"Sistema de selección automática de modelos IA"})]})]})}),e.jsxs(q,{className:"space-y-3.5 pt-5 text-sm text-muted-foreground",children:[e.jsx("div",{className:"rounded-xl border border-primary/20 bg-primary/5 p-3.5 backdrop-blur-sm",children:e.jsxs("p",{className:"text-xs font-medium text-foreground",children:["Prioridad configurada:"," ",e.jsx(I,{variant:"outline",className:"ml-2 border-primary/30 bg-background/50 text-primary text-[0.7rem]",children:D.join(" → ")})]})}),e.jsxs("ul",{className:"space-y-2.5 pl-1",children:[e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"mt-1 rounded-full bg-primary/20 p-1",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-primary"})}),e.jsx("span",{className:"text-xs leading-relaxed",children:"Se usa el mejor modelo disponible para cada pregunta."})]}),e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"mt-1 rounded-full bg-primary/20 p-1",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-primary"})}),e.jsx("span",{className:"text-xs leading-relaxed",children:"Si Groq alcanza el límite, se reintenta con el siguiente modelo."})]}),e.jsxs("li",{className:"flex items-start gap-2.5",children:[e.jsx("div",{className:"mt-1 rounded-full bg-primary/20 p-1",children:e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-primary"})}),e.jsxs("span",{className:"text-xs leading-relaxed",children:["Personaliza el orden con"," ",e.jsx("code",{className:"rounded-lg bg-muted px-2 py-1 text-[0.65rem] font-mono text-foreground",children:"VITE_GROQ_MODEL_PRIORITY"})," ","en tu"," ",e.jsx("code",{className:"rounded-lg bg-muted px-2 py-1 text-[0.65rem] font-mono text-foreground",children:".env"})]})]})]})]})]}),e.jsxs(R,{className:"overflow-hidden border border-border/30 bg-gradient-to-br from-card/80 via-card/90 to-primary/5 shadow-lg backdrop-blur-sm",children:[e.jsx(L,{className:"border-b border-border/20 bg-gradient-to-r from-primary/5 to-transparent pb-4",children:e.jsxs("div",{className:"flex items-center gap-2.5",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 backdrop-blur-sm shadow-sm",children:e.jsx(Ie,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-base font-bold",children:"Atajos estratégicos"}),e.jsx(P,{className:"text-xs text-muted-foreground mt-0.5",children:"Acceso rápido a planes, historial y listas"})]})]})}),e.jsx(q,{className:"space-y-2.5 pt-5",children:e.jsx("div",{className:"grid gap-2.5 md:grid-cols-2",children:ws.map(s=>e.jsx(k,{variant:"outline",size:"sm",asChild:!0,className:"h-full rounded-xl border border-border/30 bg-gradient-to-br from-background via-muted/60 to-muted/20 p-0 shadow-sm transition-all hover:scale-[1.02] hover:shadow-md",children:e.jsxs(_e,{to:s.to,className:"flex w-full items-start gap-2.5 rounded-xl px-3.5 py-3 text-left",children:[e.jsx(s.icon,{className:"h-4 w-4 text-primary shrink-0 mt-0.5"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-foreground",children:s.label}),e.jsx("p",{className:"text-[0.7rem] text-muted-foreground mt-0.5",children:s.description})]})]})},s.label))})})]})]}),ne=()=>{n(s=>s==="docked"?(i(!0),"floating"):(i(!1),"docked"))};return e.jsxs(e.Fragment,{children:[b?e.jsx(gs,{messages:v,isLoading:E,onSendMessage:l,onClearChat:$}):e.jsxs(Ve,{title:"Asistente inteligente con IA",children:[x&&e.jsxs(je,{variant:"warning",className:"mb-6 border-warning/50 bg-warning/10 text-warning-foreground",children:[e.jsx(Ge,{className:"h-4 w-4"}),e.jsx(ye,{children:"Modo demostración con datos locales"}),e.jsxs(ve,{children:["No se pudieron obtener datos reales desde Supabase. Revisa las variables"," ",e.jsx("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:"VITE_SUPABASE_URL"})," y"," ",e.jsx("code",{className:"rounded bg-muted px-1 py-0.5 text-xs",children:"VITE_SUPABASE_PUBLISHABLE_KEY"})," ","para conectar tu proyecto. Mientras tanto, se muestran datos de ejemplo para que puedas explorar la interfaz sin interrupciones."]})]}),e.jsxs("section",{className:"mb-8 grid gap-4 md:grid-cols-2 xl:grid-cols-4",children:[e.jsxs(R,{className:"group relative overflow-hidden border-primary/20 bg-gradient-to-br from-primary/20 via-primary/10 to-transparent shadow-lg backdrop-blur-sm transition-all duration-300 hover:shadow-xl hover:shadow-primary/20 hover:scale-[1.02]",children:[e.jsx("div",{className:"absolute -right-8 -top-8 h-32 w-32 rounded-full bg-primary/10 blur-3xl transition-all duration-300 group-hover:scale-150"}),e.jsxs(L,{className:"relative space-y-2.5 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"rounded-xl bg-primary/20 p-2 backdrop-blur-sm shadow-sm",children:e.jsx(T,{className:"h-4 w-4 text-primary"})}),e.jsx(I,{variant:"secondary",className:"bg-primary/10 text-primary border-primary/20 text-xs h-5",children:"Activo"})]}),e.jsx(O,{className:"text-xs font-bold uppercase tracking-widest text-primary/90",children:"Contexto sincronizado"}),e.jsx(P,{className:"text-xs leading-relaxed text-foreground/70 line-clamp-2",children:ae||"Conecta los datos para habilitar el contexto corporativo."})]}),e.jsx(q,{className:"relative text-[0.7rem] text-muted-foreground pt-0",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"h-1.5 w-1.5 rounded-full bg-green-500 animate-pulse"}),e.jsxs("span",{className:"truncate",children:["Actualizado: ",((ge=p.lastUpdatedLabel.split(",")[1])==null?void 0:ge.trim())||p.lastUpdatedLabel]})]})})]}),e.jsxs(R,{className:"group relative overflow-hidden border-border/40 bg-gradient-to-br from-background via-muted/30 to-background shadow-lg backdrop-blur-sm transition-all duration-300 hover:border-primary/30 hover:shadow-xl hover:scale-[1.02]",children:[e.jsx("div",{className:"absolute -right-6 -top-6 h-24 w-24 rounded-full bg-gradient-to-br from-primary/5 to-transparent blur-2xl transition-all duration-300 group-hover:scale-125"}),e.jsxs(L,{className:"relative space-y-2.5 pb-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"rounded-xl bg-muted p-2 backdrop-blur-sm shadow-sm",children:e.jsx(de,{className:"h-4 w-4 text-primary"})})}),e.jsx(O,{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Motor IA activo"}),e.jsx(P,{className:"text-base font-bold text-foreground truncate",children:z??"Selección dinámica"})]}),e.jsx(q,{className:"relative pt-0",children:e.jsxs("p",{className:"text-[0.7rem] text-muted-foreground truncate",children:[e.jsx("span",{className:"font-medium",children:"Prioridad:"})," ",e.jsx("span",{className:"font-semibold text-foreground",children:D.slice(0,2).join(" → ")})]})})]}),e.jsxs(R,{className:"group relative overflow-hidden border-border/40 bg-gradient-to-br from-background via-muted/20 to-background shadow-lg backdrop-blur-sm transition-all duration-300 hover:border-primary/30 hover:shadow-xl hover:scale-[1.02]",children:[e.jsx("div",{className:"absolute -left-6 -bottom-6 h-24 w-24 rounded-full bg-gradient-to-tl from-primary/5 to-transparent blur-2xl transition-all duration-300 group-hover:scale-125"}),e.jsxs(L,{className:"relative space-y-2.5 pb-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("div",{className:"rounded-xl bg-muted p-2 backdrop-blur-sm shadow-sm",children:e.jsx(ue,{className:"h-4 w-4 text-primary"})}),e.jsx(I,{variant:"outline",className:"text-xs h-5",children:F})]}),e.jsx(O,{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Actividad del chat"}),e.jsxs(P,{className:"text-base font-bold text-foreground",children:[G," ",G===1?"consulta":"consultas"]})]}),e.jsx(q,{className:"relative text-[0.7rem] text-muted-foreground pt-0",children:"Conversaciones con datos en tiempo real"})]}),e.jsxs(R,{className:"group relative overflow-hidden border-dashed border-border/60 bg-gradient-to-br from-muted/10 via-background to-muted/5 shadow-lg backdrop-blur-sm transition-all duration-300 hover:border-primary/40 hover:shadow-xl hover:scale-[1.02]",children:[e.jsxs(L,{className:"space-y-2.5 pb-3",children:[e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("div",{className:"rounded-xl bg-muted/50 p-2 backdrop-blur-sm shadow-sm",children:o==="docked"?e.jsx(X,{className:"h-4 w-4 text-primary"}):e.jsx(K,{className:"h-4 w-4 text-primary"})})}),e.jsx(O,{className:"text-xs font-bold uppercase tracking-widest text-muted-foreground",children:"Panel contextual"}),e.jsx(P,{className:"text-xs text-foreground/70",children:re?"Acoplado al chat":"Modo flotante activo"})]}),e.jsx(q,{className:"pt-0",children:e.jsxs(k,{variant:"outline",size:"sm",className:"w-full gap-2 rounded-xl border-border/60 bg-background/50 backdrop-blur-sm transition-all hover:border-primary/50 hover:bg-primary/5 hover:scale-105",onClick:ne,children:[o==="docked"?e.jsx(K,{className:"h-3.5 w-3.5"}):e.jsx(X,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-semibold",children:o==="docked"?"Desacoplar":"Acoplar"})]})})]})]}),e.jsxs("div",{className:w("flex flex-col gap-6 xl:gap-8",re&&"xl:grid xl:grid-cols-[minmax(0,1fr)_380px]"),children:[e.jsxs(R,{className:w("flex h-full flex-col overflow-hidden rounded-xl border shadow-sm transition-all",d?"min-h-[80vh] lg:min-h-[calc(100vh-200px)]":"min-h-[70vh] lg:min-h-[calc(100vh-240px)]"),children:[e.jsxs(L,{className:"border-b bg-muted/30 px-6 py-5",children:[e.jsxs("div",{className:"flex flex-col gap-4 lg:flex-row lg:items-start lg:justify-between",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"rounded-xl bg-primary/10 p-2.5 shadow-sm",children:e.jsx(de,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{children:[e.jsx(O,{className:"text-lg font-bold",children:"Asistente IA"}),e.jsx(P,{className:"text-xs mt-0.5",children:"Chatea con ALITO BOT sobre tu flota"})]})]}),e.jsx("div",{className:"mt-4 grid gap-2.5 sm:grid-cols-2 lg:grid-cols-4",children:Re.map(s=>e.jsxs("div",{className:"group rounded-xl border border-border/30 bg-gradient-to-br from-card/90 to-muted/20 p-3 transition-all hover:shadow-md hover:border-primary/30 hover:scale-[1.02]",children:[e.jsx("p",{className:"text-[0.65rem] font-bold uppercase tracking-[0.08em] text-muted-foreground",children:s.label}),e.jsx("p",{className:"mt-1.5 text-lg font-bold text-foreground leading-tight truncate",children:s.value}),e.jsx("p",{className:"mt-1 text-[0.7rem] text-muted-foreground truncate",children:s.helper})]},s.label))})]}),e.jsxs("div",{className:"hidden items-center gap-2 sm:flex",children:[e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>{const s=v.map(j=>`${j.role==="user"?"Usuario":"ALITO BOT"}: ${j.content}`).join(`

`),f=new Blob([s],{type:"text/plain"}),M=URL.createObjectURL(f),A=document.createElement("a");A.href=M,A.download=`conversacion-alito-${new Date().toISOString().split("T")[0]}.txt`,A.click(),URL.revokeObjectURL(M)},disabled:v.length===0,title:"Exportar conversación",className:"h-9 w-9 rounded-lg hover:bg-primary/10",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:()=>g(s=>!s),className:"h-9 w-9 rounded-lg hover:bg-primary/10",children:d?e.jsx(ke,{className:"h-4 w-4"}):e.jsx(we,{className:"h-4 w-4"})}),e.jsx(k,{type:"button",variant:"ghost",size:"sm",onClick:ne,className:"h-9 w-9 rounded-lg hover:bg-primary/10",children:o==="docked"?e.jsx(K,{className:"h-4 w-4"}):e.jsx(X,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"flex gap-2 sm:hidden",children:[e.jsxs(k,{type:"button",variant:"outline",size:"sm",className:"flex-1 gap-2 rounded-xl border border-border/40 bg-background/80 shadow-sm backdrop-blur-sm transition-all hover:border-primary/50 hover:bg-primary/5 hover:scale-[1.02]",onClick:()=>g(s=>!s),children:[d?e.jsx(ke,{className:"h-3.5 w-3.5"}):e.jsx(we,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-semibold",children:d?"Compactar":"Expandir"})]}),e.jsxs(k,{type:"button",variant:"outline",size:"sm",className:"flex-1 gap-2 rounded-xl border border-border/40 bg-background/80 shadow-sm backdrop-blur-sm transition-all hover:border-primary/50 hover:bg-primary/5 hover:scale-[1.02]",onClick:ne,children:[o==="docked"?e.jsx(K,{className:"h-3.5 w-3.5"}):e.jsx(X,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-semibold",children:o==="docked"?"Flotante":"Acoplar"})]})]})]}),e.jsx(q,{className:"flex-1 overflow-hidden p-0",children:e.jsx($e,{className:"h-full px-6 pt-6 pb-4",style:{paddingBottom:140},children:e.jsxs("div",{className:"flex flex-col gap-5",children:[v.map(s=>{const f=s.role==="assistant",M=s.role==="user",A=new Date(s.createdAt).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"}),j=Ns(s.content),Y=new Date(s.createdAt??Date.now()),le=`${f?"Tabla respuesta":"Tabla consulta"}-${Y.toISOString().split("T")[0]}`;return e.jsxs("div",{className:w("group relative flex w-full items-start gap-3",M?"flex-row-reverse":"flex-row"),children:[e.jsx(ee,{className:w("h-9 w-9 shrink-0 border shadow-sm transition-all",f?"border-none bg-gradient-to-br from-violet-500 to-purple-600 shadow-lg shadow-primary/30":"border-border bg-muted"),children:e.jsx(se,{className:w(f?"bg-transparent text-white":"bg-transparent text-muted-foreground"),children:f?e.jsx(T,{className:"h-4 w-4 text-primary"}):e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"})})}),e.jsxs("div",{className:w("relative w-full max-w-full border px-4 py-3.5 shadow-sm transition-all sm:max-w-[85%]",f?"rounded-2xl rounded-tl-md border-border/50 bg-gradient-to-br from-muted/80 to-muted/50 backdrop-blur-sm text-foreground":"rounded-2xl rounded-tr-md ml-auto border-none bg-primary text-primary-foreground shadow-lg shadow-primary/20"),children:[e.jsxs("div",{className:"mb-2.5 flex items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("span",{className:w("text-[0.65rem] font-bold uppercase tracking-[0.1em]",f?"text-primary":"text-primary-foreground/90"),children:f?"ALITO BOT":"TÚ"}),f&&e.jsx(I,{variant:"outline",className:"h-4 border-primary/30 bg-primary/10 px-1.5 text-[0.6rem] text-primary",children:"IA"})]}),e.jsx("span",{className:w("text-[0.65rem] font-medium tabular-nums",f?"text-muted-foreground":"text-primary-foreground/70"),children:A})]}),e.jsx("div",{className:w("whitespace-pre-wrap text-sm leading-relaxed",f?"text-foreground":"text-primary-foreground"),children:f?e.jsx("div",{className:"prose prose-sm max-w-none dark:prose-invert prose-headings:mb-2 prose-headings:mt-3 prose-headings:font-semibold prose-headings:tracking-tight prose-p:my-2 prose-p:leading-7 prose-a:text-primary prose-a:font-medium prose-a:no-underline hover:prose-a:underline prose-strong:font-semibold prose-code:rounded-md prose-code:bg-muted/60 prose-code:px-1.5 prose-code:py-0.5 prose-code:text-[0.85em] prose-code:font-mono prose-code:font-medium prose-code:border prose-code:border-border/40 prose-pre:my-3 prose-pre:bg-muted/50 prose-pre:border prose-pre:border-border prose-pre:shadow-sm prose-ul:my-2 prose-ol:my-2 prose-li:my-0.5",children:e.jsx(ze,{content:s.content})}):s.content}),j&&e.jsxs("div",{className:"mt-3.5 overflow-hidden rounded-xl border border-border/50 bg-card shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2 border-b bg-gradient-to-r from-muted/40 to-muted/20 px-3.5 py-2.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ne,{className:"h-3.5 w-3.5 text-primary"}),e.jsx("p",{className:"text-[0.7rem] font-bold uppercase tracking-[0.08em] text-foreground",children:le})]}),e.jsx(k,{size:"sm",variant:"ghost",className:"h-7 gap-1.5 rounded-lg px-2.5 hover:bg-primary/10",onClick:()=>Le(s.id,j,le),disabled:y===s.id,children:y===s.id?e.jsx(me,{className:"h-3.5 w-3.5 animate-spin"}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-[0.7rem] font-semibold",children:"PDF"})]})})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-[280px] w-full table-auto",children:[e.jsx("thead",{children:e.jsx("tr",{className:"border-b bg-muted/20",children:j.headers.map(H=>e.jsx("th",{className:"px-3 py-2.5 text-left text-[0.65rem] font-bold uppercase tracking-[0.08em] text-muted-foreground",children:H},`${s.id}-${H}`))})}),e.jsx("tbody",{children:j.rows.map((H,ie)=>e.jsx("tr",{className:w("border-b transition-colors hover:bg-muted/40",ie%2===0?"bg-muted/10":"bg-card"),children:H.map((Oe,Pe)=>e.jsx("td",{className:"px-3 py-2.5 text-[0.8rem] tabular-nums",children:Oe||"—"},`${s.id}-row-${ie}-cell-${Pe}`))},`${s.id}-row-${ie}`))})]})})]}),f&&s.model&&e.jsxs("div",{className:"mt-3 inline-flex items-center gap-1.5 rounded-lg border bg-card px-2.5 py-1 text-[0.65rem] font-semibold uppercase tracking-[0.08em] text-muted-foreground shadow-sm",children:[e.jsx(T,{className:"h-3 w-3 text-primary"}),s.model]})]}),e.jsx("div",{className:w("pointer-events-none absolute inset-0 -z-10 translate-y-4 rounded-[2.5rem] opacity-0 blur-2xl transition-all duration-500 group-hover:opacity-100",f?"bg-gradient-to-br from-primary/20 to-primary/5 group-hover:translate-y-6":"bg-gradient-to-br from-primary/40 to-primary/20 group-hover:translate-y-6")})]},s.id)}),E&&e.jsxs("div",{className:"flex items-center gap-3 animate-in fade-in slide-in-from-bottom-4 duration-500",children:[e.jsx(ee,{className:"h-9 w-9 border-none bg-gradient-to-br from-violet-500 to-purple-600 shadow-lg shadow-primary/30",children:e.jsx(se,{className:"bg-transparent text-white",children:e.jsx(T,{className:"h-4 w-4"})})}),e.jsxs("div",{className:"flex items-center gap-3 rounded-2xl rounded-tl-md border border-border/50 bg-gradient-to-br from-muted/80 to-muted/50 backdrop-blur-sm px-5 py-3 shadow-sm",children:[e.jsxs("div",{className:"flex gap-1.5",children:[e.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-primary [animation-delay:0ms]"}),e.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-primary [animation-delay:150ms]"}),e.jsx("div",{className:"h-2 w-2 animate-bounce rounded-full bg-primary [animation-delay:300ms]"})]}),e.jsx("span",{className:"text-xs font-medium text-muted-foreground",children:"Pensando..."})]})]}),e.jsx("div",{ref:te})]})})}),e.jsx(Qe,{}),e.jsxs(Ye,{className:"sticky bottom-0 z-10 flex flex-col gap-3.5 border-t border-border/20 bg-gradient-to-r from-card/95 via-card/90 to-card/95 p-5 backdrop-blur-xl",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-primary/3 via-transparent to-primary/3 opacity-50"}),S&&e.jsxs(je,{variant:"destructive",className:"relative shadow-md",children:[e.jsx(ye,{className:"font-bold text-sm",children:"No se pudo completar la consulta"}),e.jsx(ve,{className:"text-xs",children:S})]}),e.jsxs("form",{className:"relative flex w-full flex-col gap-3.5",onSubmit:s=>{s.preventDefault(),oe()},children:[e.jsx(pe,{placeholder:"Pregunta sobre tu flota, solicita análisis o información específica...",value:u,ref:he,onInput:Q,onChange:s=>{N(s.target.value),Q()},onKeyDown:s=>{s.key==="Enter"&&!s.shiftKey&&(s.preventDefault(),oe())},className:"min-h-[70px] max-h-[180px] resize-none rounded-xl border border-border/40 bg-gradient-to-br from-background via-background/98 to-muted/5 px-4 py-3.5 text-sm leading-relaxed shadow-lg backdrop-blur-sm transition-all placeholder:text-muted-foreground/60 focus-visible:border-primary/40 focus-visible:shadow-xl focus-visible:shadow-primary/10 focus-visible:ring-2 focus-visible:ring-primary/10"}),e.jsxs("p",{className:"text-[0.7rem] text-muted-foreground",children:[e.jsx("kbd",{className:"rounded border bg-muted px-1.5 py-0.5 text-[0.65rem] font-mono shadow-sm",children:"Enter"})," para enviar • ",e.jsx("kbd",{className:"rounded border bg-muted px-1.5 py-0.5 text-[0.65rem] font-mono shadow-sm",children:"Shift+Enter"})," para nueva línea"]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[z?e.jsxs(I,{variant:"outline",className:"border-primary/30 bg-primary/5 text-primary shadow-sm",children:[e.jsx(T,{className:"mr-1 h-3 w-3"}),z]}):e.jsxs(I,{variant:"outline",className:"border-border/40 shadow-sm",children:[e.jsx(T,{className:"mr-1 h-3 w-3"}),"Selección automática"]}),B&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1.5",children:[e.jsxs(I,{variant:"outline",className:"font-mono text-[0.7rem] tabular-nums shadow-sm",children:["In: ",B.promptTokens]}),e.jsxs(I,{variant:"outline",className:"font-mono text-[0.7rem] tabular-nums shadow-sm",children:["Out: ",B.completionTokens]}),e.jsx(I,{variant:"secondary",className:"font-mono text-[0.7rem] font-semibold tabular-nums shadow-sm",children:B.totalTokens})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:$,disabled:E,className:"h-9 rounded-lg px-3 hover:bg-primary/5",children:e.jsx(Ce,{className:"h-3.5 w-3.5"})}),E&&e.jsx(k,{type:"button",variant:"outline",size:"sm",onClick:W,className:"h-9 rounded-lg px-3 hover:bg-destructive/5",children:e.jsx(Ne,{className:"h-3.5 w-3.5"})}),e.jsxs(k,{type:"submit",size:"sm",disabled:E||!u.trim(),className:"gap-2 rounded-xl bg-gradient-to-r from-primary to-primary/90 px-5 text-sm font-semibold shadow-lg shadow-primary/20 transition-all hover:scale-105 hover:shadow-xl hover:shadow-primary/30 disabled:opacity-50 disabled:hover:scale-100",children:[E?e.jsx(me,{className:"h-3.5 w-3.5 animate-spin"}):e.jsx(Z,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:E?"Generando...":"Enviar"})]})]})]})]})]})]}),re?e.jsx("div",{className:"space-y-3.5",children:be}):e.jsxs("div",{className:"flex flex-col gap-4 rounded-xl border border-dashed bg-muted/30 p-6 text-center shadow-sm",children:[e.jsx("div",{className:"mx-auto rounded-xl bg-primary/10 p-3",children:e.jsx(K,{className:"h-5 w-5 text-primary"})}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-sm font-semibold",children:"Panel contextual desacoplado"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Abre el panel lateral para consultar el resumen"})]}),e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>i(!0),className:"gap-2 rounded-xl hover:bg-primary/5",children:[e.jsx(K,{className:"h-3.5 w-3.5"}),"Abrir panel"]})]})]}),e.jsx(Ee,{open:o==="floating"&&m,onOpenChange:i,children:e.jsxs(Me,{side:"right",className:"w-full overflow-y-auto sm:max-w-lg",children:[e.jsx(Ae,{className:"space-y-2 border-b pb-4",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"rounded-xl bg-primary/10 p-2",children:e.jsx(T,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{children:[e.jsx(Te,{className:"text-sm font-semibold",children:"Panel contextual"}),e.jsx(De,{className:"text-xs",children:"Resumen de la conversación"})]})]})}),e.jsx("div",{className:"mt-4 space-y-3.5",children:be})]})})]}),!b&&e.jsx(ds,{onSend:async s=>{await oe(s)}})]})}export{Hs as default};
