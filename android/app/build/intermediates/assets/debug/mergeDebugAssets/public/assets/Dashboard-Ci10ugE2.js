import{c as me,u as xe,r as d,j as e,a as F,b as fe,L as X}from"./index-C_D-5Bfv.js";import{R as ge,T as M,B as h,C as he,S as pe,W as Ne,H as ve,E as v,a as G,b as J,c as Q,d as Y,e as ee,f as be,P as we,g as u,h as j,i as P,L as se,j as g,k,l as N,m as _}from"./card-BIr-PJK2.js";import{u as ke}from"./useDeviceDetection-CShWnkOv.js";import{M as ye,Z as Ce}from"./MobileLayout-CV04gzFk.js";import{M as D}from"./MobileCard-DMSzGukU.js";import{B as m}from"./index-BtotK06U.js";import{S as L}from"./sparkles-CBL8q4dG.js";import{T as Me}from"./trending-up-Hw4Rtp_f.js";import{A as W}from"./activity-DZxii9vr.js";import{C as ue}from"./select-3Jn5ARjr.js";import{C as Z}from"./clock-Chbx4_2l.js";import{C as qe}from"./circle-check-DUwGofyK.js";import{T as ae,a as re,b as $,c as y,d as te,e as C}from"./table-CQA1OK80.js";import{A as ie,a as ne,b as le}from"./alert-O3FLJu-w.js";import{E as oe}from"./EquipoDetalleUnificado-BkhxSrqD.js";import{f as ce,g as Ee}from"./maintenanceUtils-fNWGA9SH.js";import{U as Re}from"./users-7pFWpLN8.js";import"./chevron-right-fj5H7AOZ.js";import"./useHistorial-CCPwivlN.js";import"./tabs-KnLULWOS.js";import"./index-APdQY6Km.js";import"./label-CqFCS6R-.js";import"./accordion-CavA7SNR.js";import"./useCaterpillarData-DbqCupgf.js";import"./caterpillarMaintenance-Dg_xV4Xi.js";import"./usePlanes-D-d8Ujwc.js";import"./format-B1dMESlT.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B=me("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=me("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);function Ae({equiposActivos:t,mantenimientosVencidos:l,mantenimientosProgramados:q,inventarioBajo:H,actualizacionesRecientes:b=[],mantenimientosRecientes:R=[],mantenimientosVencidosList:x=[],mantenimientosProximosList:c=[],onVerEquipo:o,onRefresh:I}){const i=xe(),[S,A]=d.useState(!1),[E,z]=d.useState(!1),[T,w]=d.useState(!1),[a,r]=d.useState(!1),f=async()=>{A(!0);try{I?await I():await new Promise(s=>setTimeout(s,1e3))}finally{A(!1)}},O=s=>{if(!s)return"Sin registro";const p=new Date(s);return Number.isNaN(p.getTime())?"Sin registro":p.toLocaleDateString("es-ES",{day:"2-digit",month:"short"})},K=(s,p="horas")=>{const n=Math.round(s);return n<0?`${Math.abs(n)} ${p} venc.`:`${n} ${p} rest.`},V=[{label:"Equipos activos",value:t,icon:be,color:"text-emerald-600 dark:text-emerald-400",bgColor:"bg-emerald-500/10",borderColor:"border-emerald-500/20",gradient:"from-emerald-500/5 to-emerald-500/10",trend:"+5%",trendUp:!0,path:"/equipos"},{label:"Mant. vencidos",value:l,icon:M,color:"text-red-600 dark:text-red-400",bgColor:"bg-red-500/10",borderColor:"border-red-500/20",gradient:"from-red-500/5 to-red-500/10",urgent:l>0,onClick:()=>w(!0)},{label:"Programados",value:q,icon:Z,color:"text-blue-600 dark:text-blue-400",bgColor:"bg-blue-500/10",borderColor:"border-blue-500/20",gradient:"from-blue-500/5 to-blue-500/10",onClick:()=>r(!0)},{label:"Stock bajo",value:H,icon:we,color:"text-amber-600 dark:text-amber-400",bgColor:"bg-amber-500/10",borderColor:"border-amber-500/20",gradient:"from-amber-500/5 to-amber-500/10",path:"/inventario"}];return e.jsxs(e.Fragment,{children:[e.jsx(ye,{title:"Dashboard",headerActions:e.jsx(m,{variant:"ghost",size:"icon",className:"h-9 w-9 rounded-full hover:bg-primary/10 active:scale-95 transition-all",onClick:f,disabled:S,children:e.jsx(ge,{className:F("h-5 w-5 transition-transform text-primary",S&&"animate-spin")})}),children:e.jsxs("div",{className:"space-y-5 pb-20",children:[e.jsxs("div",{className:"relative overflow-hidden rounded-xl sm:rounded-2xl bg-gradient-to-br from-primary/90 to-primary p-4 sm:p-5 text-primary-foreground shadow-lg",children:[e.jsx("div",{className:"absolute -right-10 -top-10 h-40 w-40 rounded-full bg-white/10 blur-3xl"}),e.jsx("div",{className:"absolute -left-10 -bottom-10 h-32 w-32 rounded-full bg-white/10 blur-2xl"}),e.jsxs("div",{className:"relative z-10",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 opacity-90",children:[e.jsx(L,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs font-medium uppercase tracking-wider",children:"Resumen Ejecutivo"})]}),e.jsx("h2",{className:"text-xl sm:text-2xl font-bold tracking-tight",children:"Hola, Bienvenido"}),e.jsx("p",{className:"text-xs sm:text-sm opacity-90 mt-1",children:"Aquí tienes el estado actual de tu flota."})]})]}),l>0&&e.jsx("div",{className:"animate-in fade-in slide-in-from-top-4 duration-500",children:e.jsx("div",{className:"relative overflow-hidden rounded-xl border border-red-200 bg-red-50/80 p-4 shadow-sm backdrop-blur-sm dark:border-red-900/30 dark:bg-red-900/10",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"rounded-full bg-red-100 p-2 dark:bg-red-900/30",children:e.jsx(M,{className:"h-5 w-5 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-red-900 dark:text-red-200",children:"Atención Requerida"}),e.jsxs("p",{className:"text-sm text-red-700 dark:text-red-300 mt-1",children:["Tienes ",e.jsx("span",{className:"font-bold",children:l})," mantenimientos vencidos que necesitan revisión inmediata."]}),e.jsx(m,{size:"sm",variant:"ghost",className:"mt-2 h-8 px-0 text-red-700 hover:text-red-800 hover:bg-transparent dark:text-red-300 dark:hover:text-red-200 font-medium",onClick:()=>i("/control-mantenimiento"),children:"Ver detalles →"})]})]})})}),e.jsx("div",{className:"grid grid-cols-2 gap-2 sm:gap-3",children:V.map((s,p)=>e.jsxs("div",{onClick:()=>s.onClick?s.onClick():s.path&&i(s.path),className:F("group relative overflow-hidden rounded-xl sm:rounded-2xl border p-3 sm:p-4 transition-all active:scale-95 cursor-pointer shadow-sm hover:shadow-md","bg-gradient-to-br backdrop-blur-sm",s.gradient,s.borderColor,s.urgent&&"ring-2 ring-red-500/20 border-red-500/30"),children:[e.jsxs("div",{className:"flex items-start justify-between mb-3",children:[e.jsx("div",{className:F("rounded-xl p-2.5 shadow-sm transition-transform group-hover:scale-110","bg-background/60 backdrop-blur-md"),children:e.jsx(s.icon,{className:F("h-5 w-5",s.color)})}),s.trend&&e.jsxs("div",{className:F("flex items-center gap-0.5 text-[10px] font-bold px-1.5 py-0.5 rounded-full",s.trendUp?"bg-emerald-100 text-emerald-700 dark:bg-emerald-900/30 dark:text-emerald-400":"bg-red-100 text-red-700"),children:[s.trendUp?e.jsx(Me,{className:"h-3 w-3"}):e.jsx(Se,{className:"h-3 w-3"}),s.trend]})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{className:"text-2xl sm:text-3xl font-bold tracking-tight text-foreground",children:s.value}),e.jsx("p",{className:"text-[0.65rem] sm:text-xs font-medium text-muted-foreground uppercase tracking-wide",children:s.label})]})]},p))}),(b.length>0||R.length>0)&&e.jsxs(D,{variant:"glass",className:"p-0 overflow-hidden",children:[e.jsxs("button",{onClick:()=>z(!E),className:"w-full p-4 flex items-center justify-between hover:bg-muted/30 transition-colors active:bg-muted/50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-semibold text-sm",children:"Actividad Reciente"}),e.jsx(h,{variant:"secondary",className:"text-xs",children:b.length+R.length})]}),E?e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"}):e.jsx(he,{className:"h-4 w-4 text-muted-foreground"})]}),E&&e.jsx("div",{className:"border-t border-border/50 animate-in slide-in-from-top-2 fade-in",children:e.jsxs("div",{className:"p-4 space-y-4",children:[b.length>0&&e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold text-muted-foreground uppercase mb-2 flex items-center gap-2",children:[e.jsx(Z,{className:"h-3 w-3"})," Actualizaciones de Horas/Km"]}),e.jsx("div",{className:"space-y-2",children:b.slice(0,5).map(s=>e.jsx("div",{className:"rounded-lg border border-border/30 p-2 bg-muted/20",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium truncate",children:s.nombreEquipo||`Ficha ${s.ficha}`}),e.jsxs("p",{className:"text-[0.65rem] text-muted-foreground mt-0.5",children:[s.horasKm," (",s.incremento>=0?"+":"",s.incremento,")"]})]}),e.jsx("span",{className:"text-[0.65rem] text-muted-foreground whitespace-nowrap ml-2",children:O(s.fecha)})]})},s.id))})]}),R.length>0&&e.jsxs(e.Fragment,{children:[b.length>0&&e.jsx(pe,{}),e.jsxs("div",{children:[e.jsxs("h4",{className:"text-xs font-bold text-muted-foreground uppercase mb-2 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-3 w-3"})," Mantenimientos Realizados"]}),e.jsx("div",{className:"space-y-2",children:R.slice(0,5).map(s=>e.jsx("div",{className:"rounded-lg border border-border/30 p-2 bg-muted/20",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-xs font-medium truncate",children:s.nombreEquipo||`Ficha ${s.ficha}`}),e.jsxs("p",{className:"text-[0.65rem] text-muted-foreground mt-0.5",children:[s.horasKmAlMomento," horas/km"]})]}),e.jsx("span",{className:"text-[0.65rem] text-muted-foreground whitespace-nowrap ml-2",children:O(s.fechaMantenimiento)})]})},s.id))})]})]}),e.jsxs(m,{variant:"outline",size:"sm",className:"w-full gap-2",onClick:()=>i("/historial"),children:[e.jsx(ve,{className:"h-3.5 w-3.5"}),"Ver historial completo"]})]})})]}),x.length>0&&e.jsxs(D,{variant:"glass",className:"p-0 overflow-hidden border-red-500/30",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-border/50 bg-gradient-to-r from-red-500/5 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-red-500/10 p-2",children:e.jsx(M,{className:"h-4 w-4 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"font-semibold text-xs sm:text-sm text-red-900 dark:text-red-200 block truncate",children:"Mantenimientos Vencidos"}),e.jsx("p",{className:"text-[0.65rem] sm:text-xs text-red-700 dark:text-red-300 hidden xs:block",children:"Requieren atención inmediata"})]})]}),e.jsx(h,{variant:"destructive",className:"shadow-sm",children:x.length})]})}),e.jsx("div",{className:"p-3 space-y-2",children:x.slice(0,5).map(s=>e.jsx("button",{onClick:()=>{o&&o(s.ficha)},className:"w-full rounded-xl border border-red-500/20 bg-red-500/5 p-3 hover:bg-red-500/10 transition-all active:scale-98 text-left",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate text-foreground",children:s.nombreEquipo||"Equipo sin nombre"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ficha ",s.ficha]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.tipoMantenimiento})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:e.jsx(h,{variant:"destructive",className:"text-[0.65rem] max-w-[120px] truncate",children:K(s.horasKmRestante,s.tipoMantenimiento==="Kilómetros"?"km":"horas")})})]})},s.id))}),x.length>5&&e.jsx("div",{className:"p-3 pt-0",children:e.jsxs(m,{variant:"outline",size:"sm",className:"w-full gap-2 border-red-500/30 text-red-700 dark:text-red-300 hover:bg-red-500/10",onClick:()=>w(!0),children:["Ver todos (",x.length,")",e.jsx(v,{className:"h-3.5 w-3.5"})]})})]}),c.length>0&&e.jsxs(D,{variant:"glass",className:"p-0 overflow-hidden border-primary/30",children:[e.jsx("div",{className:"p-3 sm:p-4 border-b border-border/50 bg-gradient-to-r from-primary/5 to-transparent",children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"rounded-full bg-primary/10 p-2",children:e.jsx(B,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"min-w-0 flex-1",children:[e.jsx("span",{className:"font-semibold text-xs sm:text-sm block truncate",children:"Mantenimientos Próximos"}),e.jsx("p",{className:"text-[0.65rem] sm:text-xs text-muted-foreground hidden xs:block",children:"Próximas intervenciones"})]})]}),e.jsx(h,{variant:"secondary",className:"shadow-sm",children:c.length})]})}),e.jsx("div",{className:"p-3 space-y-2",children:c.slice(0,5).map(s=>e.jsx("button",{onClick:()=>{o&&o(s.ficha)},className:"w-full rounded-xl border border-primary/20 bg-primary/5 p-3 hover:bg-primary/10 transition-all active:scale-98 text-left",children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate text-foreground",children:s.nombreEquipo||"Equipo sin nombre"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ficha ",s.ficha]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.tipoMantenimiento})]}),e.jsx("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:e.jsx(h,{variant:"outline",className:"text-[0.65rem] border-primary/30 text-primary max-w-[120px] truncate",children:K(s.horasKmRestante,s.tipoMantenimiento==="Kilómetros"?"km":"horas")})})]})},s.id))}),c.length>5&&e.jsx("div",{className:"p-3 pt-0",children:e.jsxs(m,{variant:"outline",size:"sm",className:"w-full gap-2 border-primary/30 text-primary hover:bg-primary/10",onClick:()=>r(!0),children:["Ver todos (",c.length,")",e.jsx(v,{className:"h-3.5 w-3.5"})]})})]}),e.jsx("div",{className:"grid grid-cols-1 gap-3",children:e.jsxs(D,{variant:"glass",className:"p-0 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-border/50",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-semibold text-sm",children:"Acceso Rápido"})]})})}),e.jsxs("div",{className:"grid grid-cols-3 divide-x divide-border/50 text-center",children:[e.jsxs("button",{onClick:()=>i("/asistente"),className:"flex flex-col items-center justify-center gap-1.5 p-3 hover:bg-muted/50 transition-colors active:bg-muted",children:[e.jsx(L,{className:"h-4 w-4 text-purple-500"}),e.jsx("span",{className:"text-[0.6rem] sm:text-[0.65rem] font-medium",children:"Asistente IA"})]}),e.jsxs("button",{onClick:()=>i("/reportes"),className:"flex flex-col items-center justify-center gap-1.5 p-3 hover:bg-muted/50 transition-colors active:bg-muted",children:[e.jsx(Ce,{className:"h-4 w-4 text-amber-500"}),e.jsx("span",{className:"text-[0.65rem] font-medium",children:"Reportes"})]}),e.jsxs("button",{onClick:()=>i("/listas-personalizadas"),className:"flex flex-col items-center justify-center gap-1.5 p-3 hover:bg-muted/50 transition-colors active:bg-muted",children:[e.jsx(qe,{className:"h-4 w-4 text-green-500"}),e.jsx("span",{className:"text-[0.65rem] font-medium",children:"Listas"})]})]})]})})]})}),e.jsx(G,{open:T,onOpenChange:w,children:e.jsxs(J,{side:"bottom",className:"h-[80vh] rounded-t-[2rem] border-t-0 bg-background/95 backdrop-blur-xl",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted"}),e.jsxs(Q,{className:"mt-4",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(M,{className:"h-5 w-5"}),"Mantenimientos Vencidos (",x.length,")"]}),e.jsx(ee,{children:"Equipos con horas/km excedidas que requieren atención inmediata"})]}),e.jsx("div",{className:"mt-6 space-y-3 overflow-y-auto max-h-[calc(80vh-140px)] pb-4",children:x.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay mantenimientos vencidos"}):x.map(s=>e.jsx(D,{variant:"compact",className:"border-red-500/30 bg-red-500/5 cursor-pointer hover:bg-red-500/10 transition-colors",onClick:()=>{o&&(o(s.ficha),w(!1))},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:s.nombreEquipo||"Equipo sin nombre"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ficha ",s.ficha]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.tipoMantenimiento})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[e.jsx(h,{variant:"destructive",className:"text-[0.65rem] max-w-[120px] truncate",children:K(s.horasKmRestante,s.tipoMantenimiento==="Kilómetros"?"km":"horas")}),e.jsx(v,{className:"h-3.5 w-3.5 text-muted-foreground"})]})]})},s.id))}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(m,{className:"w-full",onClick:()=>{i("/control-mantenimiento"),w(!1)},children:"Ver módulo completo"})})]})}),e.jsx(G,{open:a,onOpenChange:r,children:e.jsxs(J,{side:"bottom",className:"h-[80vh] rounded-t-[2rem] border-t-0 bg-background/95 backdrop-blur-xl",children:[e.jsx("div",{className:"mx-auto mt-2 h-1 w-12 rounded-full bg-muted"}),e.jsxs(Q,{className:"mt-4",children:[e.jsxs(Y,{className:"flex items-center gap-2 text-primary",children:[e.jsx(B,{className:"h-5 w-5"}),"Mantenimientos Próximos (",c.length,")"]}),e.jsx(ee,{children:"Próximas intervenciones programadas"})]}),e.jsx("div",{className:"mt-6 space-y-3 overflow-y-auto max-h-[calc(80vh-140px)] pb-4",children:c.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No hay mantenimientos próximos"}):c.map(s=>e.jsx(D,{variant:"compact",className:"border-primary/30 bg-primary/5 cursor-pointer hover:bg-primary/10 transition-colors",onClick:()=>{o&&(o(s.ficha),r(!1))},children:e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-semibold text-sm truncate",children:s.nombreEquipo||"Equipo sin nombre"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Ficha ",s.ficha]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.tipoMantenimiento})]}),e.jsxs("div",{className:"flex flex-col items-end gap-1 flex-shrink-0",children:[e.jsx(h,{variant:"outline",className:"text-[0.65rem] border-primary/30 text-primary max-w-[120px] truncate",children:K(s.horasKmRestante,s.tipoMantenimiento==="Kilómetros"?"km":"horas")}),e.jsx(v,{className:"h-3.5 w-3.5 text-muted-foreground"})]})]})},s.id))}),e.jsx("div",{className:"pt-4 border-t",children:e.jsx(m,{className:"w-full",onClick:()=>{i("/planificador"),r(!1)},children:"Ver módulo completo"})})]})})]})}const Te=100,de=10,Ke=10,U=t=>{if(!t)return"Sin registro";const l=new Date(t);return Number.isNaN(l.getTime())?"Sin registro":l.toLocaleDateString()},De=(t,l)=>t&&l?`${t} (Ficha ${l})`:l?`Ficha ${l}`:t??"Equipo sin ficha";function os(){var w;const{data:t,loading:l}=fe(),q=xe(),{isMobile:H}=ke(),[b,R]=d.useState(null),[x,c]=d.useState(!1),[o,I]=d.useState(!1),i=d.useMemo(()=>{var p;const a=t.equipos.filter(n=>n.activo).length,r=t.equipos.length-a,f=new Set(t.equipos.filter(n=>n.activo).map(n=>n.ficha)),O=t.mantenimientosProgramados.filter(n=>n.horasKmRestante<=50&&f.has(n.ficha)).length,K=t.mantenimientosProgramados.filter(n=>n.horasKmRestante<0&&f.has(n.ficha)).length,V=[...t.mantenimientosProgramados].filter(n=>n.activo&&f.has(n.ficha)).sort((n,je)=>n.horasKmRestante-je.horasKmRestante)[0],s=((p=t.inventarios)==null?void 0:p.filter(n=>n.cantidad<n.stockMinimo).length)||0;return{equiposActivos:a,equiposInactivos:r,mantenimientosPendientes:O,mantenimientosVencidos:K,proximoMantenimiento:V,inventarioBajo:s}},[t.equipos,t.mantenimientosProgramados,t.inventarios]),S=d.useMemo(()=>{const a=new Set(t.equipos.filter(r=>r.activo).map(r=>r.ficha));return t.mantenimientosProgramados.filter(r=>r.horasKmRestante<=0&&a.has(r.ficha)).sort((r,f)=>r.horasKmRestante-f.horasKmRestante)},[t.mantenimientosProgramados,t.equipos]),A=d.useMemo(()=>{const a=new Set(t.equipos.filter(r=>r.activo).map(r=>r.ficha));return t.mantenimientosProgramados.filter(r=>r.horasKmRestante>0&&r.horasKmRestante<=Te&&a.has(r.ficha)).sort((r,f)=>r.horasKmRestante-f.horasKmRestante).slice(0,Ke)},[t.mantenimientosProgramados,t.equipos]),E=d.useMemo(()=>[...t.actualizacionesHorasKm].sort((a,r)=>new Date(r.fecha).getTime()-new Date(a.fecha).getTime()).slice(0,de),[t.actualizacionesHorasKm]),z=d.useMemo(()=>[...t.mantenimientosRealizados].sort((a,r)=>new Date(r.fechaMantenimiento).getTime()-new Date(a.fechaMantenimiento).getTime()).slice(0,de),[t.mantenimientosRealizados]),T=a=>{R(a),c(!0)};return l?H?e.jsx("div",{className:"flex h-screen flex-col bg-background p-4",children:e.jsx("div",{className:"space-y-4",children:Array.from({length:4}).map((a,r)=>e.jsx(u,{children:e.jsxs(j,{children:[e.jsx(P,{className:"h-4 w-32"}),e.jsx(P,{className:"h-6 w-16 mt-2"})]})},r))})}):e.jsx(se,{title:"Resumen ejecutivo",children:e.jsx("div",{className:"grid gap-6 md:grid-cols-2 xl:grid-cols-4",children:Array.from({length:4}).map((a,r)=>e.jsxs(u,{children:[e.jsxs(j,{className:"space-y-2",children:[e.jsx(P,{className:"h-4 w-24"}),e.jsx(P,{className:"h-8 w-16"})]}),e.jsx(g,{children:e.jsx(P,{className:"h-6 w-full"})})]},r))})}):H?e.jsxs(e.Fragment,{children:[e.jsx(Ae,{equiposActivos:i.equiposActivos,mantenimientosVencidos:i.mantenimientosVencidos,mantenimientosProgramados:i.mantenimientosPendientes,inventarioBajo:i.inventarioBajo,actualizacionesRecientes:E,mantenimientosRecientes:z,mantenimientosVencidosList:S,mantenimientosProximosList:A,onVerEquipo:T,onRefresh:async()=>{window.location.reload()}}),e.jsx(oe,{ficha:b,open:x,onOpenChange:c})]}):e.jsxs(se,{title:"Resumen ejecutivo",children:[e.jsxs("div",{className:"space-y-6 lg:space-y-8",children:[e.jsxs(u,{className:"border-primary/30 bg-primary/5",children:[e.jsxs(j,{className:"pb-3 cursor-pointer hover:bg-primary/5 transition-colors rounded-t-lg",onClick:()=>I(!o),children:[e.jsxs(k,{className:"flex items-center justify-between gap-2 text-primary text-lg sm:text-xl",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"h-5 w-5 sm:h-6 sm:w-6"}),"Novedades del módulo de mantenimiento inteligente"]}),o?e.jsx(ue,{className:"h-5 w-5 shrink-0"}):e.jsx(he,{className:"h-5 w-5 shrink-0"})]}),!o&&e.jsx(N,{className:"text-sm",children:"Clic para ver las nuevas funcionalidades disponibles"})]}),o&&e.jsx(e.Fragment,{children:e.jsxs(g,{className:"space-y-3 text-sm pt-0",children:[e.jsx(N,{className:"text-sm",children:"Accede rápidamente a los kits Caterpillar sugeridos, crea listas personalizadas y abre la ficha del equipo desde el tablero."}),e.jsxs("div",{className:"flex flex-col gap-2.5",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"mt-0.5 h-4 w-4 text-primary shrink-0"}),e.jsxs("span",{className:"text-sm",children:["Consulta los kits recomendados y tareas clave desde la ficha del equipo en ",e.jsx("strong",{children:"Equipos > Ver detalle"}),"."]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"mt-0.5 h-4 w-4 text-primary shrink-0"}),e.jsxs("span",{className:"text-sm",children:["Utiliza el nuevo ",e.jsx("strong",{children:"constructor de listas personalizadas"})," para elegir columnas, filtros y exportar reportes en PDF/Excel."]})]}),e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_,{className:"mt-0.5 h-4 w-4 text-primary shrink-0"}),e.jsx("span",{className:"text-sm",children:"Desde este dashboard, haz clic en los indicadores para abrir listas filtradas y revisar los equipos con alerta."})]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:flex-wrap items-stretch sm:items-center gap-2 sm:gap-3 pt-2",children:[e.jsx(m,{variant:"default",size:"sm",asChild:!0,className:"w-full sm:w-auto",children:e.jsx(X,{to:"/equipos",children:"Abrir gestión de equipos"})}),e.jsx(m,{variant:"outline",size:"sm",asChild:!0,className:"w-full sm:w-auto",children:e.jsx(X,{to:"/listas-personalizadas",children:"Listas personalizadas"})}),e.jsx(m,{variant:"ghost",size:"sm",onClick:()=>q("/asistente"),className:"text-primary w-full sm:w-auto",children:"Asistente IA"})]})]})})]}),i.mantenimientosVencidos>0&&e.jsxs(ie,{variant:"destructive",children:[e.jsx(M,{className:"h-4 w-4 shrink-0"}),e.jsx(ne,{children:"Mantenimientos vencidos"}),e.jsxs(le,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("span",{className:"text-sm",children:[i.mantenimientosVencidos," equipo",i.mantenimientosVencidos>1?"s tienen":" tiene"," mantenimientos vencidos que requieren atención inmediata."]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>q("/mantenimiento"),className:"w-full sm:w-auto sm:ml-4 shrink-0",children:["Ver detalles ",e.jsx(v,{className:"ml-2 h-3 w-3"})]})]})]}),i.proximoMantenimiento&&i.proximoMantenimiento.horasKmRestante>0&&i.proximoMantenimiento.horasKmRestante<=25&&e.jsxs(ie,{variant:"warning",className:"border-warning/50",children:[e.jsx(M,{className:"h-4 w-4 shrink-0"}),e.jsx(ne,{children:"Próximo mantenimiento crítico"}),e.jsxs(le,{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("span",{className:"text-sm",children:[De(i.proximoMantenimiento.nombreEquipo,i.proximoMantenimiento.ficha)," requiere intervención en ",i.proximoMantenimiento.horasKmRestante," horas/km restantes."]}),e.jsxs(m,{variant:"outline",size:"sm",onClick:()=>T(i.proximoMantenimiento.ficha),className:"w-full sm:w-auto sm:ml-4 shrink-0",children:["Ver equipo ",e.jsx(v,{className:"ml-2 h-3 w-3"})]})]})]}),e.jsxs("section",{className:"grid gap-3 sm:gap-4 grid-cols-2 lg:grid-cols-4",children:[e.jsxs(u,{className:"group cursor-pointer transition-all duration-300 hover:shadow-xl hover:scale-[1.02] hover:border-success/50",onClick:()=>q("/equipos"),children:[e.jsxs(j,{className:"p-3 sm:p-4 pb-2",children:[e.jsx(N,{className:"text-[0.65rem] sm:text-xs font-medium uppercase tracking-wide truncate",children:"Equipos activos"}),e.jsxs(k,{className:"text-2xl sm:text-3xl lg:text-4xl font-bold flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 sm:h-6 sm:w-6 lg:h-7 lg:w-7 text-success transition-transform group-hover:scale-110 shrink-0"}),e.jsx("span",{className:"truncate",children:i.equiposActivos})]})]}),e.jsx(g,{className:"p-3 sm:p-4 pt-0",children:e.jsxs("p",{className:"text-[0.65rem] sm:text-xs lg:text-sm text-muted-foreground flex items-center gap-1 group-hover:text-foreground transition-colors",children:[e.jsx("span",{className:"truncate",children:"Operativos"}),e.jsx(v,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})})]}),e.jsxs(u,{className:"group cursor-pointer transition-all duration-300 hover:shadow-xl hover:scale-[1.02] hover:border-warning/50",onClick:()=>q("/equipos"),children:[e.jsxs(j,{className:"p-3 sm:p-4 pb-2",children:[e.jsx(N,{className:"text-[0.65rem] sm:text-xs font-medium uppercase tracking-wide truncate",children:"Fuera de servicio"}),e.jsxs(k,{className:"text-2xl sm:text-3xl lg:text-4xl font-bold flex items-center gap-2",children:[e.jsx(M,{className:"h-5 w-5 sm:h-6 sm:w-6 lg:h-7 lg:w-7 text-warning transition-transform group-hover:scale-110 shrink-0"}),e.jsx("span",{className:"truncate",children:i.equiposInactivos})]})]}),e.jsx(g,{className:"p-3 sm:p-4 pt-0",children:e.jsxs("p",{className:"text-[0.65rem] sm:text-xs lg:text-sm text-muted-foreground flex items-center gap-1 group-hover:text-foreground transition-colors",children:[e.jsx("span",{className:"truncate",children:"Requieren revisión"}),e.jsx(v,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})})]}),e.jsxs(u,{className:"group cursor-pointer transition-all duration-300 hover:shadow-xl hover:scale-[1.02] hover:border-primary/50",onClick:()=>q("/mantenimiento"),children:[e.jsxs(j,{className:"p-3 sm:p-4 pb-2",children:[e.jsx(N,{className:"text-[0.65rem] sm:text-xs font-medium uppercase tracking-wide truncate",children:"Mant. próximos"}),e.jsxs(k,{className:"text-2xl sm:text-3xl lg:text-4xl font-bold flex items-center gap-2",children:[e.jsx(B,{className:"h-5 w-5 sm:h-6 sm:w-6 lg:h-7 lg:w-7 text-primary transition-transform group-hover:scale-110 shrink-0"}),e.jsx("span",{className:"truncate",children:i.mantenimientosPendientes})]})]}),e.jsx(g,{className:"p-3 sm:p-4 pt-0",children:e.jsxs("p",{className:"text-[0.65rem] sm:text-xs lg:text-sm text-muted-foreground flex items-center gap-1 group-hover:text-foreground transition-colors truncate",children:[i.mantenimientosVencidos>0?e.jsxs("span",{className:"truncate",children:["Vencidos: ",e.jsx("span",{className:"font-semibold text-destructive",children:i.mantenimientosVencidos})]}):e.jsx("span",{className:"truncate",children:"<50 hrs restantes"}),e.jsx(v,{className:"h-3 w-3 opacity-0 group-hover:opacity-100 transition-opacity shrink-0"})]})})]}),e.jsxs(u,{className:"group transition-all duration-300 hover:shadow-xl hover:scale-[1.02] hover:border-info/50",children:[e.jsxs(j,{className:"p-3 sm:p-4 pb-2",children:[e.jsx(N,{className:"text-[0.65rem] sm:text-xs font-medium uppercase tracking-wide truncate",children:"Técnicos"}),e.jsxs(k,{className:"text-2xl sm:text-3xl lg:text-4xl font-bold flex items-center gap-2",children:[e.jsx(Re,{className:"h-5 w-5 sm:h-6 sm:w-6 lg:h-7 lg:w-7 text-info transition-transform group-hover:scale-110 shrink-0"}),e.jsx("span",{className:"truncate",children:((w=t.empleados)==null?void 0:w.length)??0})]})]}),e.jsx(g,{className:"p-3 sm:p-4 pt-0",children:e.jsx("p",{className:"text-[0.65rem] sm:text-xs lg:text-sm text-muted-foreground group-hover:text-foreground transition-colors truncate",children:"Personal disponible"})})]})]}),e.jsxs("section",{className:"hidden sm:grid gap-6 xl:grid-cols-2",children:[e.jsxs(u,{className:"flex flex-col",children:[e.jsxs(j,{children:[e.jsxs(k,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(M,{className:"h-5 w-5"})," Mantenimientos vencidos"]}),e.jsx(N,{children:"Equipos con horas/km excedidas. Haz clic para abrir la ficha y tomar acción inmediata."})]}),e.jsx(g,{className:"flex-1",children:S.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay mantenimientos vencidos en este momento."}):e.jsxs(ae,{className:"w-full min-w-[720px]",children:[e.jsx(re,{children:e.jsxs($,{children:[e.jsx(y,{children:"Equipo / Ficha"}),e.jsx(y,{children:"Tipo"}),e.jsx(y,{className:"text-right",children:"Horas/km vencidas"}),e.jsx(y,{children:"Última actualización"})]})}),e.jsx(te,{children:S.map(a=>e.jsxs($,{className:"cursor-pointer transition-colors hover:bg-destructive/10 group",onClick:()=>T(a.ficha),children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.nombreEquipo??"Equipo sin nombre"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.ficha?`Ficha ${a.ficha}`:"Sin ficha registrada"})]})}),e.jsx(C,{children:a.tipoMantenimiento}),e.jsx(C,{className:"text-right",children:e.jsx(h,{variant:"destructive",children:ce(a.horasKmRestante,a.tipoMantenimiento==="Kilómetros"?"km":"horas")})}),e.jsx(C,{children:U(a.fechaUltimaActualizacion)})]},`${a.id}-vencido`))})]})})]}),e.jsxs(u,{className:"flex flex-col",children:[e.jsxs(j,{children:[e.jsxs(k,{className:"flex items-center gap-2 text-primary",children:[e.jsx(B,{className:"h-5 w-5"})," Mantenimientos próximos"]}),e.jsx(N,{children:"Próximas intervenciones con la misma estructura para comparar con los vencidos."})]}),e.jsx(g,{className:"flex-1",children:A.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:"No hay mantenimientos próximos registrados."}):e.jsxs(ae,{className:"w-full min-w-[720px]",children:[e.jsx(re,{children:e.jsxs($,{children:[e.jsx(y,{children:"Equipo / Ficha"}),e.jsx(y,{children:"Tipo"}),e.jsx(y,{className:"text-right",children:"Horas/km restantes"}),e.jsx(y,{children:"Última actualización"})]})}),e.jsx(te,{children:A.map(a=>e.jsxs($,{className:"cursor-pointer transition-colors hover:bg-primary/10 group",onClick:()=>T(a.ficha),children:[e.jsx(C,{className:"font-medium",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:a.nombreEquipo??"Equipo sin nombre"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:a.ficha?`Ficha ${a.ficha}`:"Sin ficha registrada"})]})}),e.jsx(C,{children:a.tipoMantenimiento}),e.jsx(C,{className:"text-right",children:e.jsx(h,{variant:Ee(a.horasKmRestante),children:ce(a.horasKmRestante,a.tipoMantenimiento==="Kilómetros"?"km":"horas")})}),e.jsx(C,{children:U(a.fechaUltimaActualizacion)})]},`${a.id}-proximo`))})]})})]})]}),e.jsx("section",{className:"grid gap-6 xl:grid-cols-2",children:e.jsxs(u,{className:"flex flex-col",children:[e.jsxs(j,{children:[e.jsx(k,{children:"Actividad reciente"}),e.jsx(N,{children:"Últimas lecturas y mantenimientos registrados"})]}),e.jsx(g,{className:"flex-1",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-muted-foreground mb-3 flex items-center gap-2",children:[e.jsx(Z,{className:"h-4 w-4"})," Actualizaciones de horas/km"]}),e.jsxs("div",{className:"space-y-3",children:[E.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Aún no hay lecturas registradas."}),E.map(a=>e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.nombreEquipo??"Equipo sin nombre"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.ficha?`Ficha ${a.ficha}`:"Sin ficha registrada"})]}),e.jsx(h,{variant:"outline",children:U(a.fecha)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Nueva lectura: ",a.horasKm," (",a.incremento>=0?"+":"",a.incremento,")"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Responsable: ",a.usuarioResponsable]})]},a.id))]})]}),e.jsx(pe,{}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-muted-foreground mb-3",children:"Mantenimientos realizados"}),e.jsxs("div",{className:"space-y-3",children:[z.length===0&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"Todavía no hay mantenimientos registrados."}),z.map(a=>e.jsxs("div",{className:"rounded-md border p-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:a.nombreEquipo??"Equipo sin nombre"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:a.ficha?`Ficha ${a.ficha}`:"Sin ficha registrada"})]}),e.jsx(h,{variant:"outline",children:U(a.fechaMantenimiento)})]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["Horas/km al momento: ",a.horasKmAlMomento]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Responsable: ",a.usuarioResponsable]})]},a.id))]})]})]})})]})})]}),e.jsx(oe,{ficha:b,open:x,onOpenChange:c})]})}export{os as default};
