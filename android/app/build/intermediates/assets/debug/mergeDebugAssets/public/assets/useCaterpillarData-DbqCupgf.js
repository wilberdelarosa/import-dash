import{r as d,s as p}from"./index-C_D-5Bfv.js";import{g}from"./caterpillarMaintenance-Dg_xV4Xi.js";function j(i,a){const[E,f]=d.useState({modelo:null,intervalos:[],piezasPorIntervalo:{},tareasPorIntervalo:{},mantenimientosEspeciales:[]}),[z,l]=d.useState(!0);return d.useEffect(()=>{(async()=>{if(!i){l(!1);return}try{l(!0);const e=g(i),{data:o,error:m}=await p.from("cat_modelos").select("*").eq("modelo",i).order("id");if(m)throw m;let t=null;if(o&&o.length>0){if(a&&o.length>1){for(const r of o)if(r.serie_desde&&a>=r.serie_desde&&(!r.serie_hasta||a<=r.serie_hasta)){t=r;break}}t||(t=o[0])}else e!=null&&e.modelo&&(t=e.modelo);const{data:I,error:v}=await p.from("cat_intervalos_mantenimiento").select("*").order("horas_intervalo");if(v)throw v;let c=I||[];!c.length&&(e!=null&&e.intervalos)&&(c=e.intervalos);const s={};if(t){const{data:r,error:h}=await p.from("cat_modelo_intervalo_piezas").select(`
              *,
              pieza:pieza_id(id, numero_parte, descripcion, tipo),
              intervalo:intervalo_id(id, codigo, nombre, horas_intervalo, descripcion)
            `).eq("modelo_id",t.id);if(h)throw h;r&&r.forEach(_=>{var u;const n=(u=_.intervalo)==null?void 0:u.codigo;n&&(s[n]||(s[n]=[]),s[n].push(_))})}const P=Object.keys(s).length?s:(e==null?void 0:e.piezasPorIntervalo)??{},w=(e==null?void 0:e.tareasPorIntervalo)??{},C=(e==null?void 0:e.mantenimientosEspeciales)??[];f({modelo:t??(e==null?void 0:e.modelo)??null,intervalos:c,piezasPorIntervalo:P,tareasPorIntervalo:w,mantenimientosEspeciales:C})}catch(e){console.error("Error fetching Caterpillar data:",e);const o=g(i);o&&f(o)}finally{l(!1)}})()},[i,a]),{data:E,loading:z}}export{j as u};
